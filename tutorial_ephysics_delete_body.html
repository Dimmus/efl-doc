<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>EPhysics - Delete Body</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EPhysics - Delete Body </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this example is to demonstrate the EPhysics Callbacks usage - The code adds two balls, one with impulse and the second with a collision detection callback, to delete the body.</p>
<p>For this example we'll have an EPhysics_World and two basic EPhysics_Bodys, we'll apply an impulse in one of then and the other will be stopped "waiting" for a collision.</p>
<p>The basic concepts like - initializing an EPhysics_World, render geometry, physics limiting boundaries, add an EPhysics_Body, associate it to evas objects, change restitution, friction and impulse properties, were already covered in <a class="el" href="tutorial_ephysics_bouncing_ball.html">EPhysics - Bouncing Ball</a></p>
<h1><a class="anchor" id="autotoc_md15"></a>
Adding Callbacks</h1>
<p></p>
<p>Calling <a class="el" href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067" title="Register a callback to a type of physics body event.">ephysics_body_event_callback_add()</a> registers a callback to a given EPhysics_Body event type.</p>
<p>We'll use two types:</p>
<p><a class="el" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277cab8f46f167ee3872ea35fe645bf14a5d2">EPHYSICS_CALLBACK_BODY_DEL</a> : called when a body deletion has been issued and just before the deletion actually happens. In other words, to know that body has been marked for deletion. Typically to free some data associated with the body.</p>
<div class="fragment"><div class="line">   <a class="code" href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067">ephysics_body_event_callback_add</a>(sphere_body1,</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gada176f4748a4c2fc4ba2042021ea7067"><div class="ttname"><a href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067">ephysics_body_event_callback_add</a></div><div class="ttdeci">EAPI void ephysics_body_event_callback_add(EPhysics_Body *body, EPhysics_Callback_Body_Type type, EPhysics_Body_Event_Cb func, const void *data)</div><div class="ttdoc">Register a callback to a type of physics body event.</div></div>
<div class="line">                                    <a class="code" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277cab8f46f167ee3872ea35fe645bf14a5d2">EPHYSICS_CALLBACK_BODY_DEL</a>,</div>
<div class="line">                                    _del_cb, collision_data);</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gga904d0d1462e71c1f32cb27f540b5277cab8f46f167ee3872ea35fe645bf14a5d2"><div class="ttname"><a href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277cab8f46f167ee3872ea35fe645bf14a5d2">EPHYSICS_CALLBACK_BODY_DEL</a></div><div class="ttdeci">@ EPHYSICS_CALLBACK_BODY_DEL</div><div class="ttdoc">Body being deleted (called before free)</div><div class="ttdef"><b>Definition:</b> EPhysics.h:2265</div></div>
</div><!-- fragment --><p> The callback function will receive the collision_data and free some data associated with the body.</p>
<p></p>
<div class="fragment"><div class="line">_del_cb(<span class="keywordtype">void</span> *data, <a class="code" href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a> *body, <span class="keywordtype">void</span> *event_info __UNUSED__)</div>
<div class="line">{</div>
<div class="line">   Collision_Data *collision_data = data;</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *obj, *shadow;</div>
<div class="line"> </div>
<div class="line">   obj = <a class="code" href="group__EPhysics__Body.html#ga47ea07534cc809cd5d132495ebf2793a">ephysics_body_evas_object_get</a>(body);</div>
<div class="line">   shadow = <a class="code" href="group__Evas__Object__Group__Extras.html#ga2c207e9b215bc73f16c70b5387b3385b">evas_object_data_get</a>(obj, <span class="stringliteral">&quot;shadow&quot;</span>);</div>
<div class="line"> </div>
<div class="line">   collision_data-&gt;base.evas_objs = <a class="code" href="group__Eina__List__Group.html#gaca308c4367d3f79f6823d5b463132b31">eina_list_remove</a>(</div>
<div class="line">      collision_data-&gt;base.evas_objs, shadow);</div>
<div class="line">   collision_data-&gt;base.evas_objs = <a class="code" href="group__Eina__List__Group.html#gaca308c4367d3f79f6823d5b463132b31">eina_list_remove</a>(</div>
<div class="line">      collision_data-&gt;base.evas_objs, obj);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Basic.html#ga9217cf1d90690dbd1960db155d1c7476">evas_object_del</a>(shadow);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Basic.html#ga9217cf1d90690dbd1960db155d1c7476">evas_object_del</a>(obj);</div>
<div class="line"> </div>
<div class="line">   collision_data-&gt;sphere = NULL;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__EPhysics__Body_html_ga47ea07534cc809cd5d132495ebf2793a"><div class="ttname"><a href="group__EPhysics__Body.html#ga47ea07534cc809cd5d132495ebf2793a">ephysics_body_evas_object_get</a></div><div class="ttdeci">EAPI Evas_Object * ephysics_body_evas_object_get(const EPhysics_Body *body)</div><div class="ttdoc">Get the evas object associated to a physics body.</div></div>
<div class="ttc" id="agroup__EPhysics__Body_html_gaf39ad724f8a2f81f9139c63263900bf1"><div class="ttname"><a href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a></div><div class="ttdeci">struct _EPhysics_Body EPhysics_Body</div><div class="ttdoc">Body handle, represents an object on EPhysics world.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:655</div></div>
<div class="ttc" id="agroup__Eina__List__Group_html_gaca308c4367d3f79f6823d5b463132b31"><div class="ttname"><a href="group__Eina__List__Group.html#gaca308c4367d3f79f6823d5b463132b31">eina_list_remove</a></div><div class="ttdeci">EINA_API Eina_List * eina_list_remove(Eina_List *list, const void *data)</div><div class="ttdoc">Removes the first instance of the specified data from the given list.</div><div class="ttdef"><b>Definition:</b> eina_list.c:773</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Basic_html_ga9217cf1d90690dbd1960db155d1c7476"><div class="ttname"><a href="group__Evas__Object__Group__Basic.html#ga9217cf1d90690dbd1960db155d1c7476">evas_object_del</a></div><div class="ttdeci">EVAS_API void evas_object_del(Evas_Object *obj)</div><div class="ttdoc">Marks the given Evas object for deletion (when Evas will free its memory).</div><div class="ttdef"><b>Definition:</b> evas_object_main.c:928</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Extras_html_ga2c207e9b215bc73f16c70b5387b3385b"><div class="ttname"><a href="group__Evas__Object__Group__Extras.html#ga2c207e9b215bc73f16c70b5387b3385b">evas_object_data_get</a></div><div class="ttdeci">EVAS_API void * evas_object_data_get(const Evas_Object *obj, const char *key)</div><div class="ttdoc">Return an attached data pointer on an Evas object by its given string key.</div><div class="ttdef"><b>Definition:</b> evas_data.c:12</div></div>
<div class="ttc" id="agroup__Evas__Object__Group_html_ga9e19e6dd1f517a0ba437c0114d3e7c97"><div class="ttname"><a href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a></div><div class="ttdeci">Efl_Canvas_Object Evas_Object</div><div class="ttdoc">An Evas Object handle.</div><div class="ttdef"><b>Definition:</b> Evas_Common.h:185</div></div>
</div><!-- fragment --><p> <a class="el" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277caa002e2d26e86261221dc643f19071754">EPHYSICS_CALLBACK_BODY_COLLISION</a> : called just after the collision has been actually processed by the physics engine. In other words, to be notified about a collision between two physical bodies.</p>
<div class="fragment"><div class="line">   <a class="code" href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067">ephysics_body_event_callback_add</a>(collision_data-&gt;sphere,</div>
<div class="line">                                    <a class="code" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277caa002e2d26e86261221dc643f19071754">EPHYSICS_CALLBACK_BODY_COLLISION</a>,</div>
<div class="line">                                    _collision_cb, collision_data);</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gga904d0d1462e71c1f32cb27f540b5277caa002e2d26e86261221dc643f19071754"><div class="ttname"><a href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277caa002e2d26e86261221dc643f19071754">EPHYSICS_CALLBACK_BODY_COLLISION</a></div><div class="ttdeci">@ EPHYSICS_CALLBACK_BODY_COLLISION</div><div class="ttdoc">Body collided with other body.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:2264</div></div>
</div><!-- fragment --><p> The callback function will get the collision body and check if its body is equal to which we want to delete.</p>
<p></p>
<div class="fragment"><div class="line">_collision_cb(<span class="keywordtype">void</span> *data, <a class="code" href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a> *body, <span class="keywordtype">void</span> *event_info)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group__EPhysics__Body.html#ga454052288e957641ff40f79ca3c72792">EPhysics_Body_Collision</a> *collision = event_info;</div>
<div class="line">   Collision_Data *collision_data = data;</div>
<div class="line">   <a class="code" href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a> *contact_body;</div>
<div class="line"> </div>
<div class="line">   contact_body = <a class="code" href="group__EPhysics__Body.html#gae94b1bd402657e11208cc90c5c3bbba4">ephysics_body_collision_contact_body_get</a>(collision);</div>
<div class="line">   <span class="keywordflow">if</span> (contact_body != collision_data-&gt;sphere2) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">   collision_data-&gt;base.bodies = <a class="code" href="group__Eina__List__Group.html#gaca308c4367d3f79f6823d5b463132b31">eina_list_remove</a>(collision_data-&gt;base.bodies,</div>
<div class="line">                                                  body);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__File__Group.html#gaa0bb6435252613b1a74175af3d60045f">INF</a>(<span class="stringliteral">&quot;Collision Detected&quot;</span>);</div>
<div class="line">   <a class="code" href="group__EPhysics__Body.html#ga9f47ada6fe8ee0abb234bc4aaab7dd1c">ephysics_body_del</a>(body);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__EPhysics__Body_html_ga454052288e957641ff40f79ca3c72792"><div class="ttname"><a href="group__EPhysics__Body.html#ga454052288e957641ff40f79ca3c72792">EPhysics_Body_Collision</a></div><div class="ttdeci">struct _EPhysics_Body_Collision EPhysics_Body_Collision</div><div class="ttdoc">Body collision wraps collision informations.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:2247</div></div>
<div class="ttc" id="agroup__EPhysics__Body_html_ga9f47ada6fe8ee0abb234bc4aaab7dd1c"><div class="ttname"><a href="group__EPhysics__Body.html#ga9f47ada6fe8ee0abb234bc4aaab7dd1c">ephysics_body_del</a></div><div class="ttdeci">EAPI void ephysics_body_del(EPhysics_Body *body)</div><div class="ttdoc">Delete a physics body.</div></div>
<div class="ttc" id="agroup__EPhysics__Body_html_gae94b1bd402657e11208cc90c5c3bbba4"><div class="ttname"><a href="group__EPhysics__Body.html#gae94b1bd402657e11208cc90c5c3bbba4">ephysics_body_collision_contact_body_get</a></div><div class="ttdeci">EAPI EPhysics_Body * ephysics_body_collision_contact_body_get(const EPhysics_Body_Collision *collision)</div><div class="ttdoc">Get the body's collision contact body.</div></div>
<div class="ttc" id="agroup__Eina__File__Group_html_gaa0bb6435252613b1a74175af3d60045f"><div class="ttname"><a href="group__Eina__File__Group.html#gaa0bb6435252613b1a74175af3d60045f">INF</a></div><div class="ttdeci">#define INF(...)</div><div class="ttdoc">Macro for logging Eina info messages.</div><div class="ttdef"><b>Definition:</b> eina_file_common.h:173</div></div>
</div><!-- fragment --><p> See <a class="el" href="group__EPhysics__Body.html#ga904d0d1462e71c1f32cb27f540b5277c">_EPhysics_Callback_Body_Type</a> for more event types.</p>
<p>Here we finish the example. The full source code can be found at <a class="el" href="test_delete_c.html">test_delete.c</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:39</span>
  </p>
</div>
</body>
</html>
