<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>Ecore_Thread - API overview</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ecore_Thread - API overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Working with threads is hard.</p>
<p>Ecore helps to do so a bit easier, but as the example in <a class="el" href="ecore_thread_example_8c-example.html">ecore_thread_example.c</a> shows, there's a lot to consider even when doing the most simple things.</p>
<p>We'll be going through this thorough example now, showing how the differents aspects of <a class="el" href="group__Ecore__Thread__Group.html#ga0c2e1f8d562ccf80ecc0009ada72496f">Ecore_Thread</a> are used, but users are encourage to avoid threads unless it's really the only option, as they always add more complexity than the program usually requires.</p>
<p>Ecore Threads come in two flavors, short jobs and feedback jobs. Short jobs just run the given function and are more commonly used for small tasks where the main loop does not need to know how the work is going in between. The short job in our example is so short we had to artificially enlarge it with <code>sleep()</code>. Other than that, it also uses threads local data to keep the data we are working with persistent across different jobs ran by the same system thread. This data will be freed when the no more jobs are pending and the thread is terminated. If the data doesn't exist in the thread's storage, we create it and save it there for future jobs to find it. If creation fails, we cancel ourselves, so the main loop knows that we didn't just exit normally, meaning the job could not be done. The main part of the function checks in each iteration if it was canceled by the main loop, and if it was, it stops processing and clears the data from the storage (we assume <code>cancel</code> means no one else will need this, but this is really application dependent).  </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">_local_data_free(<span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">   Thread_Data *td = data;</div>
<div class="line">   <span class="keywordtype">char</span> *str;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__List__Group.html#gae27a2c686a0a11693f9b06957c9bba83">EINA_LIST_FREE</a>(td-&gt;list, str)</div>
<div class="line">     {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Freeing string: %s\n&quot;</span>, str);</div>
<div class="line">        free(str);</div>
<div class="line">     }</div>
<div class="line">   free(td);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">_short_job(<span class="keywordtype">void</span> *data <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <a class="code" href="group__Ecore__Thread__Group.html#ga0c2e1f8d562ccf80ecc0009ada72496f">Ecore_Thread</a> *th)</div>
<div class="line">{</div>
<div class="line">   Thread_Data *td;</div>
<div class="line">   <span class="keywordtype">int</span> i;</div>
<div class="line"> </div>
<div class="line">   td = <a class="code" href="group__Ecore__Thread__Group.html#ga1a937d674f1a20162b31b95d0ed100ad">ecore_thread_local_data_find</a>(th, <span class="stringliteral">&quot;data&quot;</span>);</div>
<div class="line">   <span class="keywordflow">if</span> (!td)</div>
<div class="line">     {</div>
<div class="line">        td = calloc(1, <span class="keyword">sizeof</span>(Thread_Data));</div>
<div class="line">        <span class="keywordflow">if</span> (!td)</div>
<div class="line">          {</div>
<div class="line">             <a class="code" href="group__Ecore__Thread__Group.html#gae9b9b20e1ed53c62c51617b55aed2511">ecore_thread_cancel</a>(th);</div>
<div class="line">             <span class="keywordflow">return</span>;</div>
<div class="line">          }</div>
<div class="line">        <a class="code" href="group__Ecore__Thread__Group.html#ga6878f550a9bcc8002c0c709b4b4dca66">ecore_thread_local_data_add</a>(th, <span class="stringliteral">&quot;data&quot;</span>, td, _local_data_free,</div>
<div class="line">                                    <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>);</div>
<div class="line">     }</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">for</span> (i = 0; i &lt; 10; i++)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">char</span> buf[200];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group__Ecore__Thread__Group.html#ga792471a7ed00718b71d58b791ddbd08d">ecore_thread_check</a>(th))</div>
<div class="line">          {</div>
<div class="line">             <a class="code" href="group__Ecore__Thread__Group.html#gad3c1d51a24772b885b26486be86c2779">ecore_thread_local_data_del</a>(th, <span class="stringliteral">&quot;data&quot;</span>);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="line"> </div>
<div class="line">        snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;Thread %p: String number %d&quot;</span>, th, i);</div>
<div class="line">        td-&gt;list = <a class="code" href="group__Eina__List__Group.html#gaa4ff7ace0fcf8c3dc0d931068069a521">eina_list_append</a>(td-&gt;list, strdup(buf));</div>
<div class="line">        sleep(1);</div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga0c2e1f8d562ccf80ecc0009ada72496f"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga0c2e1f8d562ccf80ecc0009ada72496f">Ecore_Thread</a></div><div class="ttdeci">struct _Ecore_Thread Ecore_Thread</div><div class="ttdoc">A handle for threaded jobs.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:1729</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga1a937d674f1a20162b31b95d0ed100ad"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga1a937d674f1a20162b31b95d0ed100ad">ecore_thread_local_data_find</a></div><div class="ttdeci">void * ecore_thread_local_data_find(Ecore_Thread *thread, const char *key)</div><div class="ttdoc">Gets data stored in the hash local to the given thread.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1333</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga6878f550a9bcc8002c0c709b4b4dca66"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga6878f550a9bcc8002c0c709b4b4dca66">ecore_thread_local_data_add</a></div><div class="ttdeci">Eina_Bool ecore_thread_local_data_add(Ecore_Thread *thread, const char *key, void *value, Eina_Free_Cb cb, Eina_Bool direct)</div><div class="ttdoc">Adds some data to a hash local to the thread.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1254</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga792471a7ed00718b71d58b791ddbd08d"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga792471a7ed00718b71d58b791ddbd08d">ecore_thread_check</a></div><div class="ttdeci">Eina_Bool ecore_thread_check(Ecore_Thread *thread)</div><div class="ttdoc">Checks if a thread is pending cancellation.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:892</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_gad3c1d51a24772b885b26486be86c2779"><div class="ttname"><a href="group__Ecore__Thread__Group.html#gad3c1d51a24772b885b26486be86c2779">ecore_thread_local_data_del</a></div><div class="ttdeci">Eina_Bool ecore_thread_local_data_del(Ecore_Thread *thread, const char *key)</div><div class="ttdoc">Deletes from the thread's hash the data corresponding to the given key.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1354</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_gae9b9b20e1ed53c62c51617b55aed2511"><div class="ttname"><a href="group__Ecore__Thread__Group.html#gae9b9b20e1ed53c62c51617b55aed2511">ecore_thread_cancel</a></div><div class="ttdeci">Eina_Bool ecore_thread_cancel(Ecore_Thread *thread)</div><div class="ttdoc">Cancels a running thread.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:741</div></div>
<div class="ttc" id="agroup__Eina__List__Group_html_gaa4ff7ace0fcf8c3dc0d931068069a521"><div class="ttname"><a href="group__Eina__List__Group.html#gaa4ff7ace0fcf8c3dc0d931068069a521">eina_list_append</a></div><div class="ttdeci">EINA_API Eina_List * eina_list_append(Eina_List *list, const void *data)</div><div class="ttdoc">Appends the given data to the given linked list.</div><div class="ttdef"><b>Definition:</b> eina_list.c:584</div></div>
<div class="ttc" id="agroup__Eina__List__Group_html_gae27a2c686a0a11693f9b06957c9bba83"><div class="ttname"><a href="group__Eina__List__Group.html#gae27a2c686a0a11693f9b06957c9bba83">EINA_LIST_FREE</a></div><div class="ttdeci">#define EINA_LIST_FREE(list, data)</div><div class="ttdoc">Definition for the macro to remove each list node while having access to each node's data.</div><div class="ttdef"><b>Definition:</b> eina_list.h:1629</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga1feb115f8e9913e806e090d9bd5a7301"><div class="ttname"><a href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a></div><div class="ttdeci">#define EINA_FALSE</div><div class="ttdoc">boolean value FALSE (numerical value 0)</div><div class="ttdef"><b>Definition:</b> eina_types.h:533</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga82d751be730f849719ca292f9558be87"><div class="ttname"><a href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a></div><div class="ttdeci">#define EINA_UNUSED</div><div class="ttdoc">Used to indicate that a function parameter is purposely unused.</div><div class="ttdef"><b>Definition:</b> eina_types.h:339</div></div>
<div class="line">     }</div>
<div class="line">}</div>
</div><!-- fragment --><p> Feedback jobs, on the other hand, run tasks that will inform back to the main loop its progress, send partial data as is processed, just ping saying it's still alive and processing, or anything that needs the thread to talk back to the main loop. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">_feedback_job(<span class="keywordtype">void</span> *data <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <a class="code" href="group__Ecore__Thread__Group.html#ga0c2e1f8d562ccf80ecc0009ada72496f">Ecore_Thread</a> *th)</div>
<div class="line">{</div>
<div class="line">   time_t t;</div>
<div class="line">   <span class="keywordtype">int</span> i, count;</div>
<div class="line">   Feedback_Thread_Data *ftd = NULL;</div>
<div class="line">   <a class="code" href="struct__Eina__Iterator.html">Eina_Iterator</a> *it;</div>
<div class="line">   App_Msg *msg;</div>
<div class="line">   <span class="keywordtype">char</span> *name;</div>
<div class="line"> </div>
<div class="line">   count = (int)(uintptr_t)<a class="code" href="group__Ecore__Thread__Group.html#ga011eeb2f99aaa950089ddc6ea989da29">ecore_thread_global_data_find</a>(<span class="stringliteral">&quot;count&quot;</span>);</div>
<div class="line">   <span class="keywordflow">for</span> (i = 0; i &lt; count; i++)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">char</span> buf[32];</div>
<div class="line">        snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;data%d&quot;</span>, i);</div>
<div class="line">        ftd = <a class="code" href="group__Ecore__Thread__Group.html#ga011eeb2f99aaa950089ddc6ea989da29">ecore_thread_global_data_find</a>(buf);</div>
<div class="line">        <span class="keywordflow">if</span> (!ftd)</div>
<div class="line">          <span class="keywordflow">continue</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group__Eina__Lock__Group.html#ga13c8270c1589bfd4770ee4cd43977bc5">eina_lock_take_try</a>(&amp;ftd-&gt;mutex))</div>
<div class="line">          <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          ftd = NULL;</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">if</span> (!ftd)</div>
<div class="line">     <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">   it = <a class="code" href="group__Eina__File__Group.html#ga64527e0d95e38a0399897b9fc0a81e49">eina_file_ls</a>(ftd-&gt;base);</div>
<div class="line">   <span class="keywordflow">if</span> (!it)</div>
<div class="line">     <span class="keywordflow">goto</span> the_end;</div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga011eeb2f99aaa950089ddc6ea989da29"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga011eeb2f99aaa950089ddc6ea989da29">ecore_thread_global_data_find</a></div><div class="ttdeci">void * ecore_thread_global_data_find(const char *key)</div><div class="ttdoc">Gets data stored in the hash shared by all threads.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1451</div></div>
<div class="ttc" id="agroup__Eina__File__Group_html_ga64527e0d95e38a0399897b9fc0a81e49"><div class="ttname"><a href="group__Eina__File__Group.html#ga64527e0d95e38a0399897b9fc0a81e49">eina_file_ls</a></div><div class="ttdeci">EINA_API Eina_Iterator * eina_file_ls(const char *dir)</div><div class="ttdoc">Gets an iterator to list the content of a directory.</div><div class="ttdef"><b>Definition:</b> eina_file_posix.c:631</div></div>
<div class="ttc" id="agroup__Eina__Lock__Group_html_ga13c8270c1589bfd4770ee4cd43977bc5"><div class="ttname"><a href="group__Eina__Lock__Group.html#ga13c8270c1589bfd4770ee4cd43977bc5">eina_lock_take_try</a></div><div class="ttdeci">static Eina_Lock_Result eina_lock_take_try(Eina_Lock *mutex)</div><div class="ttdoc">Attempts to take a lock if possible.</div></div>
<div class="ttc" id="astruct__Eina__Iterator_html"><div class="ttname"><a href="struct__Eina__Iterator.html">_Eina_Iterator</a></div><div class="ttdoc">structure of an iterator</div><div class="ttdef"><b>Definition:</b> eina_iterator.h:159</div></div>
<div class="line"> </div>
<div class="line">   msg = calloc(1, <span class="keyword">sizeof</span>(App_Msg));</div>
<div class="line"> </div>
<div class="line">   t = time(NULL);</div>
<div class="line">   <a class="code" href="group__Eina__Iterator__Group.html#gac7314580e18868ef229f5d2814562794">EINA_ITERATOR_FOREACH</a>(it, name)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordflow">if</span> (time(NULL) &gt;= (t + 2))</div>
<div class="line">          {</div>
<div class="line">             <a class="code" href="group__Eina__Stringshare__Group.html#ga5538b4a134987b8a01744fad1a845ba4">eina_stringshare_del</a>(name);</div>
<div class="line">             <span class="keywordflow">break</span>;</div>
<div class="line">          }</div>
<div class="ttc" id="agroup__Eina__Iterator__Group_html_gac7314580e18868ef229f5d2814562794"><div class="ttname"><a href="group__Eina__Iterator__Group.html#gac7314580e18868ef229f5d2814562794">EINA_ITERATOR_FOREACH</a></div><div class="ttdeci">#define EINA_ITERATOR_FOREACH(itr, data)</div><div class="ttdoc">Definition for the macro to iterate over all elements easily.</div><div class="ttdef"><b>Definition:</b> eina_iterator.h:448</div></div>
<div class="ttc" id="agroup__Eina__Stringshare__Group_html_ga5538b4a134987b8a01744fad1a845ba4"><div class="ttname"><a href="group__Eina__Stringshare__Group.html#ga5538b4a134987b8a01744fad1a845ba4">eina_stringshare_del</a></div><div class="ttdeci">EINA_API void eina_stringshare_del(Eina_Stringshare *str)</div><div class="ttdoc">Notes that the given string has lost an instance.</div><div class="ttdef"><b>Definition:</b> eina_stringshare.c:533</div></div>
</div><!-- fragment --><p> Finally, one more feedback job, but this one will be running outside of Ecore's pool, so we can use the pool for real work and keep this very light function unchecked. All it does is check if some condition is met and send a message to the main loop telling it it's time to close. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">_out_of_pool_job(<span class="keywordtype">void</span> *data, <a class="code" href="group__Ecore__Thread__Group.html#ga0c2e1f8d562ccf80ecc0009ada72496f">Ecore_Thread</a> *th)</div>
<div class="line">{</div>
<div class="line">   App_Data *ad = data;</div>
<div class="line">   App_Msg *msg;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">while</span> (1)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">int</span> msgs;</div>
<div class="line">        <a class="code" href="group__Eina__Lock__Group.html#ga149f387d5f18c469c365147ffbd4dc2c">eina_condition_wait</a>(&amp;ad-&gt;condition);</div>
<div class="line">        msgs = ad-&gt;msgs_received;</div>
<div class="line">        <a class="code" href="group__Eina__Lock__Group.html#ga469476cfe8d8ca4dfdc46469fb9e31e5">eina_lock_release</a>(&amp;ad-&gt;mutex);</div>
<div class="line">        <span class="keywordflow">if</span> (msgs == ad-&gt;max_msgs)</div>
<div class="line">          {</div>
<div class="line">             msg = calloc(1, <span class="keyword">sizeof</span>(App_Msg));</div>
<div class="line">             msg-&gt;all_done = 1;</div>
<div class="line">             <a class="code" href="group__Ecore__Thread__Group.html#ga8fadd19caae011ab1483665f09ce4d91">ecore_thread_feedback</a>(th, msg);</div>
<div class="line">             <span class="keywordflow">return</span>;</div>
<div class="line">          }</div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga8fadd19caae011ab1483665f09ce4d91"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga8fadd19caae011ab1483665f09ce4d91">ecore_thread_feedback</a></div><div class="ttdeci">Eina_Bool ecore_thread_feedback(Ecore_Thread *thread, const void *msg_data)</div><div class="ttdoc">Sends data from the worker thread to the main loop.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1037</div></div>
<div class="ttc" id="agroup__Eina__Lock__Group_html_ga149f387d5f18c469c365147ffbd4dc2c"><div class="ttname"><a href="group__Eina__Lock__Group.html#ga149f387d5f18c469c365147ffbd4dc2c">eina_condition_wait</a></div><div class="ttdeci">static Eina_Bool eina_condition_wait(Eina_Condition *cond)</div><div class="ttdoc">Causes a thread to wait until signaled by the condition.</div></div>
<div class="ttc" id="agroup__Eina__Lock__Group_html_ga469476cfe8d8ca4dfdc46469fb9e31e5"><div class="ttname"><a href="group__Eina__Lock__Group.html#ga469476cfe8d8ca4dfdc46469fb9e31e5">eina_lock_release</a></div><div class="ttdeci">static Eina_Lock_Result eina_lock_release(Eina_Lock *mutex)</div><div class="ttdoc">Releases a lock.</div></div>
<div class="line">     }</div>
<div class="line">}</div>
</div><!-- fragment --><p> Every now and then the program prints its status, counting threads running and pending jobs. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">_print_status(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">int</span> active, pending_total, pending_feedback, pending_short, available;</div>
<div class="line"> </div>
<div class="line">   active = <a class="code" href="group__Ecore__Thread__Group.html#gad7a28588dc26d6af8b6db8abc3ef37ce">ecore_thread_active_get</a>();</div>
<div class="line">   pending_total = <a class="code" href="group__Ecore__Thread__Group.html#gaeaa014287d578a200d41cca861bceac3">ecore_thread_pending_total_get</a>();</div>
<div class="line">   pending_feedback = <a class="code" href="group__Ecore__Thread__Group.html#gaa5c56445198f7b03c1f080039499689a">ecore_thread_pending_feedback_get</a>();</div>
<div class="line">   pending_short = <a class="code" href="group__Ecore__Thread__Group.html#ga3e32f650cfe811e69bba7825c71b9070">ecore_thread_pending_get</a>();</div>
<div class="line">   available = <a class="code" href="group__Ecore__Thread__Group.html#ga6e7703b3013d9c872449f6e2ec093b53">ecore_thread_available_get</a>();</div>
<div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Status:\n\t* Active threads: %d\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;\t* Available threads: %d\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;\t* Pending short jobs: %d\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;\t* Pending feedback jobs: %d\n&quot;</span></div>
<div class="line">          <span class="stringliteral">&quot;\t* Pending total: %d\n&quot;</span>, active, available, pending_short,</div>
<div class="line">          pending_feedback, pending_total);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga3e32f650cfe811e69bba7825c71b9070"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga3e32f650cfe811e69bba7825c71b9070">ecore_thread_pending_get</a></div><div class="ttdeci">int ecore_thread_pending_get(void)</div><div class="ttdoc">Gets the number of short jobs waiting for a thread to run.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1169</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga6e7703b3013d9c872449f6e2ec093b53"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga6e7703b3013d9c872449f6e2ec093b53">ecore_thread_available_get</a></div><div class="ttdeci">int ecore_thread_available_get(void)</div><div class="ttdoc">Gets the number of threads available for running tasks.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1230</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_gaa5c56445198f7b03c1f080039499689a"><div class="ttname"><a href="group__Ecore__Thread__Group.html#gaa5c56445198f7b03c1f080039499689a">ecore_thread_pending_feedback_get</a></div><div class="ttdeci">int ecore_thread_pending_feedback_get(void)</div><div class="ttdoc">Gets the number of feedback jobs waiting for a thread to run.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1181</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_gad7a28588dc26d6af8b6db8abc3ef37ce"><div class="ttname"><a href="group__Ecore__Thread__Group.html#gad7a28588dc26d6af8b6db8abc3ef37ce">ecore_thread_active_get</a></div><div class="ttdeci">int ecore_thread_active_get(void)</div><div class="ttdoc">Gets the number of active threads running jobs.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1162</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_gaeaa014287d578a200d41cca861bceac3"><div class="ttname"><a href="group__Ecore__Thread__Group.html#gaeaa014287d578a200d41cca861bceac3">ecore_thread_pending_total_get</a></div><div class="ttdeci">int ecore_thread_pending_total_get(void)</div><div class="ttdoc">Gets the total number of pending jobs.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1193</div></div>
</div><!-- fragment --><p> In our main loop, we'll be receiving messages from our feedback jobs using the same callback for both of them. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">_feedback_job_msg_cb(<span class="keywordtype">void</span> *data, <a class="code" href="group__Ecore__Thread__Group.html#ga0c2e1f8d562ccf80ecc0009ada72496f">Ecore_Thread</a> *th, <span class="keywordtype">void</span> *msg_data)</div>
<div class="line">{</div>
<div class="line">   App_Data *ad = data;</div>
<div class="line">   App_Msg *msg = msg_data;</div>
<div class="line">   <span class="keywordtype">char</span> *str;</div>
</div><!-- fragment --><p> The light job running out of the pool will let us know when we can exit our program. </p><div class="fragment"><div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (msg-&gt;all_done)</div>
<div class="line">     {</div>
<div class="line">        <a class="code" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a>();</div>
<div class="line">        free(msg);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">     }</div>
<div class="ttc" id="agroup__Ecore__Main__Loop__Group_html_ga95cf8e97dff0716433c2c5474d606a98"><div class="ttname"><a href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a></div><div class="ttdeci">void ecore_main_loop_quit(void)</div><div class="ttdoc">Quits the main loop once all the events currently on the queue have been processed.</div><div class="ttdef"><b>Definition:</b> ecore_main.c:1321</div></div>
</div><!-- fragment --><p> Next comes the handling of data sent from the actual worker threads, always remembering that the data belongs to us now, and not the thread, so it's our responsibility to free it. </p><div class="fragment"><div class="line"> </div>
<div class="line">   _print_status();</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (!msg-&gt;list)</div>
<div class="line">     printf(<span class="stringliteral">&quot;Received an empty list from thread %p\n&quot;</span>, th);</div>
<div class="line">   <span class="keywordflow">else</span></div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">int</span> i = 0;</div>
<div class="line">        printf(<span class="stringliteral">&quot;Received %d elements from threads %p (printing first 5):\n&quot;</span>,</div>
<div class="line">               <a class="code" href="group__Eina__List__Group.html#ga301729054a498a2df09a5f1dd760697e">eina_list_count</a>(msg-&gt;list), th);</div>
<div class="line">        <a class="code" href="group__Eina__List__Group.html#gae27a2c686a0a11693f9b06957c9bba83">EINA_LIST_FREE</a>(msg-&gt;list, str)</div>
<div class="line">          {</div>
<div class="line">             <span class="keywordflow">if</span> (i &lt;= 5)</div>
<div class="line">               printf(<span class="stringliteral">&quot;\t%s\n&quot;</span>, str);</div>
<div class="line">             free(str);</div>
<div class="line">             i++;</div>
<div class="line">          }</div>
<div class="ttc" id="agroup__Eina__List__Group_html_ga301729054a498a2df09a5f1dd760697e"><div class="ttname"><a href="group__Eina__List__Group.html#ga301729054a498a2df09a5f1dd760697e">eina_list_count</a></div><div class="ttdeci">static unsigned int eina_list_count(const Eina_List *list)</div><div class="ttdoc">Gets the count of the number of items in a list.</div></div>
<div class="line">     }</div>
</div><!-- fragment --><p> Last, the condition to exit is given by how many messages we want to handle, so we need to count them and inform the condition checking thread that the value changed. </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Lock__Group.html#ga2ad27b83cf8562a41fe67557d8d2d753">eina_lock_take</a>(&amp;ad-&gt;mutex);</div>
<div class="line">   ad-&gt;msgs_received++;</div>
<div class="line">   <a class="code" href="group__Eina__Lock__Group.html#ga42cfdc4920e74fd7ba99527a6a99cd7d">eina_condition_signal</a>(&amp;ad-&gt;condition);</div>
<div class="line">   <a class="code" href="group__Eina__Lock__Group.html#ga469476cfe8d8ca4dfdc46469fb9e31e5">eina_lock_release</a>(&amp;ad-&gt;mutex);</div>
<div class="line"> </div>
<div class="line">   free(msg);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Eina__Lock__Group_html_ga2ad27b83cf8562a41fe67557d8d2d753"><div class="ttname"><a href="group__Eina__Lock__Group.html#ga2ad27b83cf8562a41fe67557d8d2d753">eina_lock_take</a></div><div class="ttdeci">static Eina_Lock_Result eina_lock_take(Eina_Lock *mutex)</div><div class="ttdoc">Attempts to take a lock.</div></div>
<div class="ttc" id="agroup__Eina__Lock__Group_html_ga42cfdc4920e74fd7ba99527a6a99cd7d"><div class="ttname"><a href="group__Eina__Lock__Group.html#ga42cfdc4920e74fd7ba99527a6a99cd7d">eina_condition_signal</a></div><div class="ttdeci">static Eina_Bool eina_condition_signal(Eina_Condition *cond)</div><div class="ttdoc">Signals a thread waiting for a condition.</div></div>
</div><!-- fragment --><p> When a thread finishes its job or gets canceled, the main loop is notified through the callbacks set when creating the task. In this case, we just print what happen and keep track of one of them used to exemplify canceling. Here we are pretending one of our short jobs has a timeout, so if it doesn't finish before a timer is triggered, it will be canceled. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">_thread_end_cb(<span class="keywordtype">void</span> *data, <a class="code" href="group__Ecore__Thread__Group.html#ga0c2e1f8d562ccf80ecc0009ada72496f">Ecore_Thread</a> *th)</div>
<div class="line">{</div>
<div class="line">   App_Data *ad = data;</div>
<div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Normal termination for thread %p.\n&quot;</span>, th);</div>
<div class="line">   <span class="keywordflow">if</span> (th == ad-&gt;thread_3)</div>
<div class="line">     ad-&gt;thread_3 = NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">_thread_cancel_cb(<span class="keywordtype">void</span> *data, <a class="code" href="group__Ecore__Thread__Group.html#ga0c2e1f8d562ccf80ecc0009ada72496f">Ecore_Thread</a> *th)</div>
<div class="line">{</div>
<div class="line">   App_Data *ad = data;</div>
<div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Thread %p got cancelled.\n&quot;</span>, th);</div>
<div class="line">   <span class="keywordflow">if</span> (th == ad-&gt;thread_3)</div>
<div class="line">     ad-&gt;thread_3 = NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_cancel_timer_cb(<span class="keywordtype">void</span> *data)</div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga3fe0caf72e93b1bab1ca8ee3ccf3f226"><div class="ttname"><a href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div><div class="ttdeci">unsigned char Eina_Bool</div><div class="ttdoc">Type to mimic a boolean.</div><div class="ttdef"><b>Definition:</b> eina_types.h:527</div></div>
<div class="line">{</div>
<div class="line">   App_Data *ad = data;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (ad-&gt;thread_3 &amp;&amp; !<a class="code" href="group__Ecore__Thread__Group.html#ga792471a7ed00718b71d58b791ddbd08d">ecore_thread_check</a>(ad-&gt;thread_3))</div>
<div class="line">     <a class="code" href="group__Ecore__Thread__Group.html#gae9b9b20e1ed53c62c51617b55aed2511">ecore_thread_cancel</a>(ad-&gt;thread_3);</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p> The main function does some setup that includes reading parameters from the command line to change its behaviour and test different results. These are: </p><ul>
<li>-t &lt;some_num&gt; maximum number of threads to run at the same time. </li>
<li>-p &lt;some_path&gt; adds <code>some_path</code> to the list used by the feedback jobs. This parameter can be used multiple times. </li>
<li>-m &lt;some_num&gt; the number of messages to process before the program is signalled to exit.</li>
</ul>
<p>Skipping some bits, we init Ecore and our application data. </p><div class="fragment"><div class="line">   <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();</div>
<div class="line"> </div>
<div class="line">   i = <a class="code" href="group__Ecore__Thread__Group.html#gabad7972818b7fb1346ae7a098cd47220">ecore_thread_max_get</a>();</div>
<div class="line">   printf(<span class="stringliteral">&quot;Initial max threads: %d\n&quot;</span>, i);</div>
<div class="line"> </div>
<div class="line">   memset(&amp;appdata, 0, <span class="keyword">sizeof</span>(App_Data));</div>
<div class="line">   appdata.max_msgs = 1;</div>
<div class="ttc" id="agroup__Ecore__Init__Group_html_ga77757609684a2c922dc5ec398274751b"><div class="ttname"><a href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a></div><div class="ttdeci">EAPI int ecore_init(void)</div><div class="ttdoc">Sets up connections, signal handlers, sockets etc.</div><div class="ttdef"><b>Definition:</b> ecore.c:230</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_gabad7972818b7fb1346ae7a098cd47220"><div class="ttname"><a href="group__Ecore__Thread__Group.html#gabad7972818b7fb1346ae7a098cd47220">ecore_thread_max_get</a></div><div class="ttdeci">int ecore_thread_max_get(void)</div><div class="ttdoc">Gets the maximum number of threads that can run simultaneously.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1205</div></div>
</div><!-- fragment --><p> If any paths for the feedback jobs were given, we use them, otherwise we fallback to some defaults. Always initializing the proper mutexes used by the threaded job. </p><div class="fragment"><div class="line">   <span class="keywordflow">if</span> (!path_list)</div>
<div class="line">     {</div>
<div class="line">        Feedback_Thread_Data *ftd;</div>
<div class="line">        <a class="code" href="group__Ecore__Thread__Group.html#ga4e9de7492f8400e19ddd157d8cc21811">ecore_thread_global_data_add</a>(<span class="stringliteral">&quot;count&quot;</span>, (<span class="keywordtype">void</span> *)3, NULL, <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>);</div>
<div class="line">        ftd = calloc(1, <span class="keyword">sizeof</span>(Feedback_Thread_Data));</div>
<div class="line">        ftd-&gt;name = strdup(<span class="stringliteral">&quot;data0&quot;</span>);</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">        ftd-&gt;base = strdup(<span class="stringliteral">&quot;c:/windows/System32&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        ftd-&gt;base = strdup(<span class="stringliteral">&quot;/usr/bin&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <a class="code" href="group__Eina__Lock__Group.html#ga8dda398c1db315582a80640c7f78f648">eina_lock_new</a>(&amp;ftd-&gt;mutex);</div>
<div class="line">        <a class="code" href="group__Ecore__Thread__Group.html#ga4e9de7492f8400e19ddd157d8cc21811">ecore_thread_global_data_add</a>(ftd-&gt;name, ftd, NULL, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);</div>
<div class="line">        ftd = calloc(1, <span class="keyword">sizeof</span>(Feedback_Thread_Data));</div>
<div class="line">        ftd-&gt;name = strdup(<span class="stringliteral">&quot;data1&quot;</span>);</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">        ftd-&gt;base = strdup(<span class="stringliteral">&quot;c:/windows/Fonts&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        ftd-&gt;base = strdup(<span class="stringliteral">&quot;/usr/lib&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <a class="code" href="group__Eina__Lock__Group.html#ga8dda398c1db315582a80640c7f78f648">eina_lock_new</a>(&amp;ftd-&gt;mutex);</div>
<div class="line">        <a class="code" href="group__Ecore__Thread__Group.html#ga4e9de7492f8400e19ddd157d8cc21811">ecore_thread_global_data_add</a>(ftd-&gt;name, ftd, NULL, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);</div>
<div class="line">        ftd = calloc(1, <span class="keyword">sizeof</span>(Feedback_Thread_Data));</div>
<div class="line">        ftd-&gt;name = strdup(<span class="stringliteral">&quot;data2&quot;</span>);</div>
<div class="line"><span class="preprocessor">#ifdef _WIN32</span></div>
<div class="line">        ftd-&gt;base = strdup(<span class="stringliteral">&quot;c:/windows/Help&quot;</span>);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        ftd-&gt;base = strdup(<span class="stringliteral">&quot;/usr/lib&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <a class="code" href="group__Eina__Lock__Group.html#ga8dda398c1db315582a80640c7f78f648">eina_lock_new</a>(&amp;ftd-&gt;mutex);</div>
<div class="line">        <a class="code" href="group__Ecore__Thread__Group.html#ga4e9de7492f8400e19ddd157d8cc21811">ecore_thread_global_data_add</a>(ftd-&gt;name, ftd, NULL, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span></div>
<div class="line">     {</div>
<div class="line">        Feedback_Thread_Data *ftd;</div>
<div class="line">        <span class="keywordtype">char</span> *str;</div>
<div class="line">        <a class="code" href="group__Ecore__Thread__Group.html#ga4e9de7492f8400e19ddd157d8cc21811">ecore_thread_global_data_add</a>(<span class="stringliteral">&quot;count&quot;</span>,</div>
<div class="line">                                     (<span class="keywordtype">void</span> *)(uintptr_t)<a class="code" href="group__Eina__List__Group.html#ga301729054a498a2df09a5f1dd760697e">eina_list_count</a>(path_list), NULL,</div>
<div class="line">                                     <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>);</div>
<div class="line">        i = 0;</div>
<div class="line">        <a class="code" href="group__Eina__List__Group.html#gae27a2c686a0a11693f9b06957c9bba83">EINA_LIST_FREE</a>(path_list, str)</div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga4e9de7492f8400e19ddd157d8cc21811"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga4e9de7492f8400e19ddd157d8cc21811">ecore_thread_global_data_add</a></div><div class="ttdeci">Eina_Bool ecore_thread_global_data_add(const char *key, void *value, Eina_Free_Cb cb, Eina_Bool direct)</div><div class="ttdoc">Adds some data to a hash shared by all threads.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:1373</div></div>
<div class="ttc" id="agroup__Eina__Lock__Group_html_ga8dda398c1db315582a80640c7f78f648"><div class="ttname"><a href="group__Eina__Lock__Group.html#ga8dda398c1db315582a80640c7f78f648">eina_lock_new</a></div><div class="ttdeci">static Eina_Bool eina_lock_new(Eina_Lock *mutex)</div><div class="ttdoc">Initializes a new Eina_Lock.</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga05c12dacc8b4058994df842b41be85fc"><div class="ttname"><a href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a></div><div class="ttdeci">#define EINA_TRUE</div><div class="ttdoc">boolean value TRUE (numerical value 1)</div><div class="ttdef"><b>Definition:</b> eina_types.h:539</div></div>
<div class="line">          {</div>
<div class="line">             <span class="keywordtype">char</span> buf[32];</div>
<div class="line">             snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;data%d&quot;</span>, i);</div>
<div class="line">             ftd = calloc(1, <span class="keyword">sizeof</span>(Feedback_Thread_Data));</div>
<div class="line">             ftd-&gt;name = strdup(buf);</div>
<div class="line">             ftd-&gt;base = strdup(str);</div>
<div class="line">             <a class="code" href="group__Eina__Lock__Group.html#ga8dda398c1db315582a80640c7f78f648">eina_lock_new</a>(&amp;ftd-&gt;mutex);</div>
<div class="line">             <a class="code" href="group__Ecore__Thread__Group.html#ga4e9de7492f8400e19ddd157d8cc21811">ecore_thread_global_data_add</a>(ftd-&gt;name, ftd, NULL, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);</div>
<div class="line">             free(str);</div>
<div class="line">             i++;</div>
<div class="line">          }</div>
<div class="line">     }</div>
</div><!-- fragment --><p> Initialize the mutex needed for the condition checking thread </p><div class="fragment"><div class="line">   <a class="code" href="group__Eina__Lock__Group.html#ga8dda398c1db315582a80640c7f78f648">eina_lock_new</a>(&amp;appdata.mutex);</div>
<div class="line">   <a class="code" href="group__Eina__Lock__Group.html#gaab2b734db1cbdaffe79559f6716ac793">eina_condition_new</a>(&amp;appdata.condition, &amp;appdata.mutex);</div>
<div class="ttc" id="agroup__Eina__Lock__Group_html_gaab2b734db1cbdaffe79559f6716ac793"><div class="ttname"><a href="group__Eina__Lock__Group.html#gaab2b734db1cbdaffe79559f6716ac793">eina_condition_new</a></div><div class="ttdeci">static Eina_Bool eina_condition_new(Eina_Condition *cond, Eina_Lock *mutex)</div><div class="ttdoc">Initializes a new condition variable.</div></div>
</div><!-- fragment --><p> And start our tasks. </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Thread__Group.html#ga4bde6b50e177f26ab5b2688aa99e3878">ecore_thread_feedback_run</a>(_out_of_pool_job, _feedback_job_msg_cb, NULL,</div>
<div class="line">                             NULL, &amp;appdata, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Thread__Group.html#gaac9c9933ef0a90ba86f8fd0247e9c7ef">ecore_thread_run</a>(_short_job, _thread_end_cb, _thread_cancel_cb, &amp;appdata);</div>
<div class="line">   <a class="code" href="group__Ecore__Thread__Group.html#ga4bde6b50e177f26ab5b2688aa99e3878">ecore_thread_feedback_run</a>(_feedback_job, _feedback_job_msg_cb,</div>
<div class="line">                             _thread_end_cb, _thread_cancel_cb, &amp;appdata,</div>
<div class="line">                             <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>);</div>
<div class="line">   appdata.thread_3 = <a class="code" href="group__Ecore__Thread__Group.html#gaac9c9933ef0a90ba86f8fd0247e9c7ef">ecore_thread_run</a>(_short_job, _thread_end_cb,</div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_ga4bde6b50e177f26ab5b2688aa99e3878"><div class="ttname"><a href="group__Ecore__Thread__Group.html#ga4bde6b50e177f26ab5b2688aa99e3878">ecore_thread_feedback_run</a></div><div class="ttdeci">Ecore_Thread * ecore_thread_feedback_run(Ecore_Thread_Cb func_heavy, Ecore_Thread_Notify_Cb func_notify, Ecore_Thread_Cb func_end, Ecore_Thread_Cb func_cancel, const void *data, Eina_Bool try_no_queue)</div><div class="ttdoc">Launches a thread to run a task that can talk back to the main thread.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:911</div></div>
<div class="ttc" id="agroup__Ecore__Thread__Group_html_gaac9c9933ef0a90ba86f8fd0247e9c7ef"><div class="ttname"><a href="group__Ecore__Thread__Group.html#gaac9c9933ef0a90ba86f8fd0247e9c7ef">ecore_thread_run</a></div><div class="ttdeci">Ecore_Thread * ecore_thread_run(Ecore_Thread_Cb func_blocking, Ecore_Thread_Cb func_end, Ecore_Thread_Cb func_cancel, const void *data)</div><div class="ttdoc">Schedules a task to run in a parallel thread to avoid locking the main loop.</div><div class="ttdef"><b>Definition:</b> ecore_thread.c:658</div></div>
<div class="line">                                       _thread_cancel_cb, &amp;appdata);</div>
<div class="line">   <a class="code" href="group__Ecore__Thread__Group.html#ga4bde6b50e177f26ab5b2688aa99e3878">ecore_thread_feedback_run</a>(_feedback_job, _feedback_job_msg_cb,</div>
<div class="line">                             _thread_end_cb, _thread_cancel_cb, &amp;appdata,</div>
<div class="line">                             <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>);</div>
</div><!-- fragment --><p> To finalize, set a timer to cancel one of the tasks if it doesn't end before the timeout, one more timer for status report and get into the main loop. Once we are out, destroy our mutexes and finish the program. </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a>(1.0, _cancel_timer_cb, &amp;appdata);</div>
<div class="line">   <a class="code" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a>(2.0, _status_timer_cb, NULL);</div>
<div class="ttc" id="agroup__Ecore__Timer__Group_html_ga7b9cb9d24ecebfdbb957436e2e669402"><div class="ttname"><a href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a></div><div class="ttdeci">Ecore_Timer * ecore_timer_add(double in, Ecore_Task_Cb func, const void *data)</div><div class="ttdoc">Creates a timer to call the given function in the given period of time.</div><div class="ttdef"><b>Definition:</b> ecore_timer.c:189</div></div>
<div class="line"> </div>
<div class="line">   _print_status();</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Lock__Group.html#ga838e1e7dfc8bbf114634a7de67de8956">eina_condition_free</a>(&amp;appdata.condition);</div>
<div class="line">   <a class="code" href="group__Eina__Lock__Group.html#gaf8d1c4e3aff3bd26fc85d81ed8c4e71a">eina_lock_free</a>(&amp;appdata.mutex);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a>();</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Ecore__Init__Group_html_ga768298b932f18d7e7593a447493e5cde"><div class="ttname"><a href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a></div><div class="ttdeci">EAPI int ecore_shutdown(void)</div><div class="ttdoc">Shuts down connections, signal handlers sockets etc.</div><div class="ttdef"><b>Definition:</b> ecore.c:371</div></div>
<div class="ttc" id="agroup__Ecore__Main__Loop__Group_html_gaf103b9f668bb3e4fed12e52c6180132d"><div class="ttname"><a href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a></div><div class="ttdeci">void ecore_main_loop_begin(void)</div><div class="ttdoc">Runs the application main loop.</div><div class="ttdef"><b>Definition:</b> ecore_main.c:1311</div></div>
<div class="ttc" id="agroup__Eina__Lock__Group_html_ga838e1e7dfc8bbf114634a7de67de8956"><div class="ttname"><a href="group__Eina__Lock__Group.html#ga838e1e7dfc8bbf114634a7de67de8956">eina_condition_free</a></div><div class="ttdeci">static void eina_condition_free(Eina_Condition *cond)</div><div class="ttdoc">Deallocates a condition variable.</div></div>
<div class="ttc" id="agroup__Eina__Lock__Group_html_gaf8d1c4e3aff3bd26fc85d81ed8c4e71a"><div class="ttname"><a href="group__Eina__Lock__Group.html#gaf8d1c4e3aff3bd26fc85d81ed8c4e71a">eina_lock_free</a></div><div class="ttdeci">static void eina_lock_free(Eina_Lock *mutex)</div><div class="ttdoc">Deallocates an Eina_Lock.</div></div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:35</span>
  </p>
</div>
</body>
</html>
