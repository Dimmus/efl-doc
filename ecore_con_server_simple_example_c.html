<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>Ecore_Con - Creating a server</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ecore_Con - Creating a server </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this example we are going to create a server that listens for connections from clients through a TCP port.</p>
<p>You can get the full source code at <a class="el" href="ecore_con_server_simple_example_8c-example.html">ecore_con_server_simple_example.c</a>.</p>
<p>We begin our example in the main function, to demonstrate how to setup things, and then go to the callbacks that are needed for it to run properly.</p>
<p>In the <code>main</code> function, after initializing the libraries, we use <a class="el" href="group__Ecore__Con__Server__Group.html#ga8993f75b5a4948b6b3975575d807fb21" title="Creates a server to listen for connections.">ecore_con_server_add()</a> to startup the server. Look at the reference documentation of this function: it supports many types of server, and we are going to use #ECORE_CON_REMOTE_TCP (a TCP based server). Other arguments to this function are the address where we are listening on, the port, and a data pointer that will associate that data with the server:</p>
 <div class="fragment"><div class="line">main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group__Ecore__Con__Server__Group.html#ga80f90f9716013d6104624c2e606f8915">Ecore_Con_Server</a> *svr;</div>
<div class="line">   <a class="code" href="group__Ecore__Con__Client__Group.html#gae9afe250f5420f4731d1a94050275756">Ecore_Con_Client</a> *cl;</div>
<div class="line">   <span class="keyword">const</span> <a class="code" href="struct__Eina__List.html">Eina_List</a> *clients, *l;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Main__Group.html#ga81b8137665b8a4d2cb38ca50017d4c74">eina_init</a>();</div>
<div class="line">   <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();</div>
<div class="line">   <a class="code" href="group__Ecore__Con__Lib__Group.html#ga8a20f47372627a03e86a8705a6f8a82d">ecore_con_init</a>();</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (!(svr = <a class="code" href="group__Ecore__Con__Server__Group.html#ga8993f75b5a4948b6b3975575d807fb21">ecore_con_server_add</a>(ECORE_CON_REMOTE_TCP, <span class="stringliteral">&quot;127.0.0.1&quot;</span>, 8080, NULL)))</div>
<div class="line">     exit(1);</div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_gae9afe250f5420f4731d1a94050275756"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#gae9afe250f5420f4731d1a94050275756">Ecore_Con_Client</a></div><div class="ttdeci">struct _Ecore_Con_Client Ecore_Con_Client</div><div class="ttdoc">Used to provide legacy API/ABI compatibility with non-Eo applications.</div><div class="ttdef"><b>Definition:</b> Ecore_Con.h:308</div></div>
<div class="ttc" id="agroup__Ecore__Con__Lib__Group_html_ga8a20f47372627a03e86a8705a6f8a82d"><div class="ttname"><a href="group__Ecore__Con__Lib__Group.html#ga8a20f47372627a03e86a8705a6f8a82d">ecore_con_init</a></div><div class="ttdeci">ECORE_CON_API int ecore_con_init(void)</div><div class="ttdoc">Initializes the Ecore_Con library.</div><div class="ttdef"><b>Definition:</b> ecore_con.c:68</div></div>
<div class="ttc" id="agroup__Ecore__Con__Server__Group_html_ga80f90f9716013d6104624c2e606f8915"><div class="ttname"><a href="group__Ecore__Con__Server__Group.html#ga80f90f9716013d6104624c2e606f8915">Ecore_Con_Server</a></div><div class="ttdeci">struct _Ecore_Con_Server Ecore_Con_Server</div><div class="ttdoc">Used to provide legacy API/ABI compatibility with non-Eo applications.</div><div class="ttdef"><b>Definition:</b> Ecore_Con.h:294</div></div>
<div class="ttc" id="agroup__Ecore__Con__Server__Group_html_ga8993f75b5a4948b6b3975575d807fb21"><div class="ttname"><a href="group__Ecore__Con__Server__Group.html#ga8993f75b5a4948b6b3975575d807fb21">ecore_con_server_add</a></div><div class="ttdeci">ECORE_CON_API Ecore_Con_Server * ecore_con_server_add(Ecore_Con_Type type, const char *name, int port, const void *data)</div><div class="ttdoc">Creates a server to listen for connections.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:1696</div></div>
<div class="ttc" id="agroup__Ecore__Init__Group_html_ga77757609684a2c922dc5ec398274751b"><div class="ttname"><a href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a></div><div class="ttdeci">EAPI int ecore_init(void)</div><div class="ttdoc">Sets up connections, signal handlers, sockets etc.</div><div class="ttdef"><b>Definition:</b> ecore.c:230</div></div>
<div class="ttc" id="agroup__Eina__Main__Group_html_ga81b8137665b8a4d2cb38ca50017d4c74"><div class="ttname"><a href="group__Eina__Main__Group.html#ga81b8137665b8a4d2cb38ca50017d4c74">eina_init</a></div><div class="ttdeci">EINA_API int eina_init(void)</div><div class="ttdoc">Initializes the Eina library.</div><div class="ttdef"><b>Definition:</b> eina_main.c:291</div></div>
<div class="ttc" id="astruct__Eina__List_html"><div class="ttname"><a href="struct__Eina__List.html">_Eina_List</a></div><div class="ttdoc">Type for a generic double linked list.</div><div class="ttdef"><b>Definition:</b> eina_list.h:318</div></div>
</div><!-- fragment --><p> Notice that we are listening only on 127.0.0.1, which is the internal loopback interface. If the server needs to listening on all of its ips, use 0.0.0.0 instead.</p>
<p>We also need to set event handlers to be called when we receive any data from the clients, when a new client connects to our server, or when a client disconnects. These callbacks are:</p>
<div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62">ecore_event_handler_add</a>(<a class="code" href="group__Ecore__Con__Events__Group.html#ga4757b5128fed6457910b996a65577111">ECORE_CON_EVENT_CLIENT_ADD</a>, (<a class="code" href="group__Ecore__Event__Group.html#ga64b4df04cbafda481593d0bc29617c6d">Ecore_Event_Handler_Cb</a>)_add, NULL);</div>
<div class="line">   <a class="code" href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62">ecore_event_handler_add</a>(<a class="code" href="group__Ecore__Con__Events__Group.html#gab6a527ae1614876cddf4630ff03ae1dc">ECORE_CON_EVENT_CLIENT_DEL</a>, (<a class="code" href="group__Ecore__Event__Group.html#ga64b4df04cbafda481593d0bc29617c6d">Ecore_Event_Handler_Cb</a>)_del, NULL);</div>
<div class="line">   <a class="code" href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62">ecore_event_handler_add</a>(<a class="code" href="group__Ecore__Con__Events__Group.html#gaf909435b89ab32078adc52f0a18c70c7">ECORE_CON_EVENT_CLIENT_DATA</a>, (<a class="code" href="group__Ecore__Event__Group.html#ga64b4df04cbafda481593d0bc29617c6d">Ecore_Event_Handler_Cb</a>)_data, NULL);</div>
<div class="ttc" id="agroup__Ecore__Con__Events__Group_html_ga4757b5128fed6457910b996a65577111"><div class="ttname"><a href="group__Ecore__Con__Events__Group.html#ga4757b5128fed6457910b996a65577111">ECORE_CON_EVENT_CLIENT_ADD</a></div><div class="ttdeci">ECORE_CON_API int ECORE_CON_EVENT_CLIENT_ADD</div><div class="ttdoc">A client has connected to the server.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:157</div></div>
<div class="ttc" id="agroup__Ecore__Con__Events__Group_html_gab6a527ae1614876cddf4630ff03ae1dc"><div class="ttname"><a href="group__Ecore__Con__Events__Group.html#gab6a527ae1614876cddf4630ff03ae1dc">ECORE_CON_EVENT_CLIENT_DEL</a></div><div class="ttdeci">ECORE_CON_API int ECORE_CON_EVENT_CLIENT_DEL</div><div class="ttdoc">A client has disconnected from the server.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:158</div></div>
<div class="ttc" id="agroup__Ecore__Con__Events__Group_html_gaf909435b89ab32078adc52f0a18c70c7"><div class="ttname"><a href="group__Ecore__Con__Events__Group.html#gaf909435b89ab32078adc52f0a18c70c7">ECORE_CON_EVENT_CLIENT_DATA</a></div><div class="ttdeci">ECORE_CON_API int ECORE_CON_EVENT_CLIENT_DATA</div><div class="ttdoc">A client connected to the server has sent data.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:166</div></div>
<div class="ttc" id="agroup__Ecore__Event__Group_html_ga64b4df04cbafda481593d0bc29617c6d"><div class="ttname"><a href="group__Ecore__Event__Group.html#ga64b4df04cbafda481593d0bc29617c6d">Ecore_Event_Handler_Cb</a></div><div class="ttdeci">Eina_Bool(* Ecore_Event_Handler_Cb)(void *data, int type, void *event)</div><div class="ttdoc">A callback used by the main loop to handle events of a specified type.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:603</div></div>
<div class="ttc" id="agroup__Ecore__Event__Group_html_gae75b0b1b2c50e73b8e42afc628b00a62"><div class="ttname"><a href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62">ecore_event_handler_add</a></div><div class="ttdeci">Ecore_Event_Handler * ecore_event_handler_add(int type, Ecore_Event_Handler_Cb func, const void *data)</div><div class="ttdoc">Adds an event handler.</div><div class="ttdef"><b>Definition:</b> ecore_events.c:13</div></div>
</div><!-- fragment --><p> More details about what these callbacks do will be given later.</p>
<p>Now, before running the main loop, we also want to set some limits to our server. To avoid it to be overloaded with too many connections to handle, we are going to set a maximum of 3 clients connected at the same time. This number is used just to demonstrate the API. A good number to be used here would need to be determined by tests done on the server, to check the load supported by it.</p>
<p>Any other client trying to connect to this server, after the limit is reached, will wait until one of the connected clients disconnect and the server accepts the new connection.</p>
<p>Another important thing to do is setting a timeout, to avoid that a client hold a connection for too long without doing anything. This timeout will disconnect the idle client, allowing that other clients that may be waiting to connect finally can do it.</p>
<p>Then we just start the main loop:</p>
<div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Con__Server__Group.html#ga82e6c66eef006a627468f2ca4e619641">ecore_con_server_timeout_set</a>(svr, 10);</div>
<div class="line">   <a class="code" href="group__Ecore__Con__Server__Group.html#ga6188bbadcdc4dc2f1878dd3fe18f6fb8">ecore_con_server_client_limit_set</a>(svr, 3, 0);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();</div>
<div class="ttc" id="agroup__Ecore__Con__Server__Group_html_ga6188bbadcdc4dc2f1878dd3fe18f6fb8"><div class="ttname"><a href="group__Ecore__Con__Server__Group.html#ga6188bbadcdc4dc2f1878dd3fe18f6fb8">ecore_con_server_client_limit_set</a></div><div class="ttdeci">ECORE_CON_API void ecore_con_server_client_limit_set(Ecore_Con_Server *svr, int client_limit, char reject_excess_clients)</div><div class="ttdoc">Sets a limit on the number of clients that can be handled concurrently by the given server,...</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:2267</div></div>
<div class="ttc" id="agroup__Ecore__Con__Server__Group_html_ga82e6c66eef006a627468f2ca4e619641"><div class="ttname"><a href="group__Ecore__Con__Server__Group.html#ga82e6c66eef006a627468f2ca4e619641">ecore_con_server_timeout_set</a></div><div class="ttdeci">ECORE_CON_API void ecore_con_server_timeout_set(Ecore_Con_Server *svr, double timeout)</div><div class="ttdoc">Sets the default time after which an inactive client will be disconnected.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:2284</div></div>
<div class="ttc" id="agroup__Ecore__Main__Loop__Group_html_gaf103b9f668bb3e4fed12e52c6180132d"><div class="ttname"><a href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a></div><div class="ttdeci">void ecore_main_loop_begin(void)</div><div class="ttdoc">Runs the application main loop.</div><div class="ttdef"><b>Definition:</b> ecore_main.c:1311</div></div>
</div><!-- fragment --><p> After exiting the main loop, we print the list of connected clients, and also free the data associated with each respective client. This data was previously associated using <a class="el" href="group__Ecore__Con__Client__Group.html#gabe69c02ac5c0ef03e322a5d34904f858" title="Sets the data associated with the given client to data.">ecore_con_client_data_set()</a>:</p>
<div class="fragment"><div class="line"> </div>
<div class="line">   clients = <a class="code" href="group__Ecore__Con__Server__Group.html#ga688ddcc88a17c527a6ea772a66bf53d6">ecore_con_server_clients_get</a>(svr);</div>
<div class="line">   printf(<span class="stringliteral">&quot;Clients connected to this server when exiting: %d\n&quot;</span>,</div>
<div class="line">          <a class="code" href="group__Eina__List__Group.html#ga301729054a498a2df09a5f1dd760697e">eina_list_count</a>(clients));</div>
<div class="line">   <a class="code" href="group__Eina__List__Group.html#gac6efafc19f526d916cdb9757240a8773">EINA_LIST_FOREACH</a>(clients, l, cl)</div>
<div class="line">     {</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="group__Ecore__Con__Client__Group.html#gab02f9ae8613aca1de53996239dd5f7ea">ecore_con_client_ip_get</a>(cl));</div>
<div class="line">        free(<a class="code" href="group__Ecore__Con__Client__Group.html#gadacc90bc2f169308e67a3efadfa49820">ecore_con_client_data_get</a>(cl));</div>
<div class="line">     }</div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_gab02f9ae8613aca1de53996239dd5f7ea"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#gab02f9ae8613aca1de53996239dd5f7ea">ecore_con_client_ip_get</a></div><div class="ttdeci">ECORE_CON_API const char * ecore_con_client_ip_get(const Ecore_Con_Client *cl)</div><div class="ttdoc">Gets the IP address of a client that has connected.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:739</div></div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_gadacc90bc2f169308e67a3efadfa49820"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#gadacc90bc2f169308e67a3efadfa49820">ecore_con_client_data_get</a></div><div class="ttdeci">ECORE_CON_API void * ecore_con_client_data_get(Ecore_Con_Client *cl)</div><div class="ttdoc">Retrieves the data associated with the given client.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:732</div></div>
<div class="ttc" id="agroup__Ecore__Con__Server__Group_html_ga688ddcc88a17c527a6ea772a66bf53d6"><div class="ttname"><a href="group__Ecore__Con__Server__Group.html#ga688ddcc88a17c527a6ea772a66bf53d6">ecore_con_server_clients_get</a></div><div class="ttdeci">ECORE_CON_API const Eina_List * ecore_con_server_clients_get(const Ecore_Con_Server *svr)</div><div class="ttdoc">Retrieves the current list of clients.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:2277</div></div>
<div class="ttc" id="agroup__Eina__List__Group_html_ga301729054a498a2df09a5f1dd760697e"><div class="ttname"><a href="group__Eina__List__Group.html#ga301729054a498a2df09a5f1dd760697e">eina_list_count</a></div><div class="ttdeci">static unsigned int eina_list_count(const Eina_List *list)</div><div class="ttdoc">Gets the count of the number of items in a list.</div></div>
<div class="ttc" id="agroup__Eina__List__Group_html_gac6efafc19f526d916cdb9757240a8773"><div class="ttname"><a href="group__Eina__List__Group.html#gac6efafc19f526d916cdb9757240a8773">EINA_LIST_FOREACH</a></div><div class="ttdeci">#define EINA_LIST_FOREACH(list, l, _data)</div><div class="ttdoc">Definition for the macro to iterate over a list.</div><div class="ttdef"><b>Definition:</b> eina_list.h:1415</div></div>
</div><!-- fragment --><p> Then before exiting we show the total uptime of the server:</p>
<div class="fragment"><div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Server was up for %0.3f seconds\n&quot;</span>,</div>
<div class="line">          <a class="code" href="group__Ecore__Con__Server__Group.html#ga048038c956602aa0b6a0a4d2490ce11f">ecore_con_server_uptime_get</a>(svr));</div>
<div class="ttc" id="agroup__Ecore__Con__Server__Group_html_ga048038c956602aa0b6a0a4d2490ce11f"><div class="ttname"><a href="group__Ecore__Con__Server__Group.html#ga048038c956602aa0b6a0a4d2490ce11f">ecore_con_server_uptime_get</a></div><div class="ttdeci">ECORE_CON_API double ecore_con_server_uptime_get(const Ecore_Con_Server *svr)</div><div class="ttdoc">Checks how long a server has been connected.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:2405</div></div>
</div><!-- fragment --><p> Now let's go back to the used callbacks.</p>
<p>The first callback, <code>_add</code>, is registered to the event <a class="el" href="group__Ecore__Con__Events__Group.html#ga4757b5128fed6457910b996a65577111" title="A client has connected to the server.">ECORE_CON_EVENT_CLIENT_ADD</a>, which will be called whenever a client connects to the server.</p>
<p>This callback will associate a data structure to this client, that will be used to count how many bytes were received from it. It also prints some info about the client, and send a welcome string to it. <a class="el" href="group__Ecore__Con__Client__Group.html#ga8eeeb449d9af80885a26309471330de9" title="Flushes all pending data to the given client.">ecore_con_client_flush()</a> is used to ensure that the string is sent immediately, instead of being buffered.</p>
<p>A timeout for idle specific for this client is also set, to demonstrate that it is independent of the general timeout of the server.</p>
<p>Before exiting, the callback will display a list of all clients still connected to this server. The code for this callback follows:</p>
 <div class="fragment"><div class="line"><a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_add(<span class="keywordtype">void</span> *data <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keywordtype">int</span> type <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <a class="code" href="struct__Ecore__Con__Event__Client__Add.html">Ecore_Con_Event_Client_Add</a> *ev)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">char</span> welcome[] = <span class="stringliteral">&quot;hello! - sent from the server&quot;</span>;</div>
<div class="line">   <a class="code" href="group__Ecore__Con__Server__Group.html#ga80f90f9716013d6104624c2e606f8915">Ecore_Con_Server</a> *srv;</div>
<div class="line">   <a class="code" href="group__Ecore__Con__Client__Group.html#gae9afe250f5420f4731d1a94050275756">Ecore_Con_Client</a> *cl;</div>
<div class="line">   <span class="keyword">const</span> <a class="code" href="struct__Eina__List.html">Eina_List</a> *clients, *l;</div>
<div class="line"> </div>
<div class="line">   <span class="keyword">struct </span>_Client *client = malloc(<span class="keyword">sizeof</span>(*client));</div>
<div class="line">   client-&gt;sdata = 0;</div>
<div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Client with ip %s, port %d, connected = %d!\n&quot;</span>,</div>
<div class="line">          <a class="code" href="group__Ecore__Con__Client__Group.html#gab02f9ae8613aca1de53996239dd5f7ea">ecore_con_client_ip_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Add.html#a9877727e79213077e8592dfca5895cbe">client</a>),</div>
<div class="line">          <a class="code" href="group__Ecore__Con__Client__Group.html#ga8aac792bcc08647c91e346255723ecdc">ecore_con_client_port_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Add.html#a9877727e79213077e8592dfca5895cbe">client</a>),</div>
<div class="line">          <a class="code" href="group__Ecore__Con__Client__Group.html#ga9f668e92d167f19ed81d3e70c060219f">ecore_con_client_connected_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Add.html#a9877727e79213077e8592dfca5895cbe">client</a>));</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Con__Client__Group.html#ga89f79f973aeea2505078d87cb7b045b3">ecore_con_client_send</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Add.html#a9877727e79213077e8592dfca5895cbe">client</a>, welcome, <span class="keyword">sizeof</span>(welcome));</div>
<div class="line">   <a class="code" href="group__Ecore__Con__Client__Group.html#ga8eeeb449d9af80885a26309471330de9">ecore_con_client_flush</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Add.html#a9877727e79213077e8592dfca5895cbe">client</a>);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Con__Client__Group.html#ga02e595c6d808c590822abd7c8e2109aa">ecore_con_client_timeout_set</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Add.html#a9877727e79213077e8592dfca5895cbe">client</a>, 6);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Con__Client__Group.html#gabe69c02ac5c0ef03e322a5d34904f858">ecore_con_client_data_set</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Add.html#a9877727e79213077e8592dfca5895cbe">client</a>, client);</div>
<div class="line"> </div>
<div class="line">   srv = <a class="code" href="group__Ecore__Con__Client__Group.html#ga70d6fe610ac62b88d14dc91ec5671bab">ecore_con_client_server_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Add.html#a9877727e79213077e8592dfca5895cbe">client</a>);</div>
<div class="line">   printf(<span class="stringliteral">&quot;Clients connected to this server:\n&quot;</span>);</div>
<div class="line">   clients = <a class="code" href="group__Ecore__Con__Server__Group.html#ga688ddcc88a17c527a6ea772a66bf53d6">ecore_con_server_clients_get</a>(srv);</div>
<div class="line">   <a class="code" href="group__Eina__List__Group.html#gac6efafc19f526d916cdb9757240a8773">EINA_LIST_FOREACH</a>(clients, l, cl)</div>
<div class="line">     printf(<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="group__Ecore__Con__Client__Group.html#gab02f9ae8613aca1de53996239dd5f7ea">ecore_con_client_ip_get</a>(cl));</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a>;</div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_ga02e595c6d808c590822abd7c8e2109aa"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#ga02e595c6d808c590822abd7c8e2109aa">ecore_con_client_timeout_set</a></div><div class="ttdeci">ECORE_CON_API void ecore_con_client_timeout_set(Ecore_Con_Client *cl, double timeout)</div><div class="ttdoc">Sets the time after which the client will be disconnected when inactive.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:697</div></div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_ga70d6fe610ac62b88d14dc91ec5671bab"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#ga70d6fe610ac62b88d14dc91ec5671bab">ecore_con_client_server_get</a></div><div class="ttdeci">ECORE_CON_API Ecore_Con_Server * ecore_con_client_server_get(const Ecore_Con_Client *cl)</div><div class="ttdoc">The server the client is connected to.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:753</div></div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_ga89f79f973aeea2505078d87cb7b045b3"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#ga89f79f973aeea2505078d87cb7b045b3">ecore_con_client_send</a></div><div class="ttdeci">ECORE_CON_API int ecore_con_client_send(Ecore_Con_Client *cl, const void *data, int size)</div><div class="ttdoc">Sends the given data to the given client.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:668</div></div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_ga8aac792bcc08647c91e346255723ecdc"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#ga8aac792bcc08647c91e346255723ecdc">ecore_con_client_port_get</a></div><div class="ttdeci">ECORE_CON_API int ecore_con_client_port_get(const Ecore_Con_Client *cl)</div><div class="ttdoc">Returns the port that the client has connected to.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:746</div></div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_ga8eeeb449d9af80885a26309471330de9"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#ga8eeeb449d9af80885a26309471330de9">ecore_con_client_flush</a></div><div class="ttdeci">ECORE_CON_API void ecore_con_client_flush(Ecore_Con_Client *cl)</div><div class="ttdoc">Flushes all pending data to the given client.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:767</div></div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_ga9f668e92d167f19ed81d3e70c060219f"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#ga9f668e92d167f19ed81d3e70c060219f">ecore_con_client_connected_get</a></div><div class="ttdeci">ECORE_CON_API Eina_Bool ecore_con_client_connected_get(const Ecore_Con_Client *cl)</div><div class="ttdoc">Returns whether the client is still connected.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:690</div></div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_gabe69c02ac5c0ef03e322a5d34904f858"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#gabe69c02ac5c0ef03e322a5d34904f858">ecore_con_client_data_set</a></div><div class="ttdeci">ECORE_CON_API void ecore_con_client_data_set(Ecore_Con_Client *cl, const void *data)</div><div class="ttdoc">Sets the data associated with the given client to data.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:724</div></div>
<div class="ttc" id="agroup__Ecore__Main__Loop__Group_html_ga1ee9db07f9a46a8b20fb83e1c6dbed09"><div class="ttname"><a href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a></div><div class="ttdeci">#define ECORE_CALLBACK_RENEW</div><div class="ttdoc">Return value to keep a callback.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:153</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga3fe0caf72e93b1bab1ca8ee3ccf3f226"><div class="ttname"><a href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div><div class="ttdeci">unsigned char Eina_Bool</div><div class="ttdoc">Type to mimic a boolean.</div><div class="ttdef"><b>Definition:</b> eina_types.h:527</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga82d751be730f849719ca292f9558be87"><div class="ttname"><a href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a></div><div class="ttdeci">#define EINA_UNUSED</div><div class="ttdoc">Used to indicate that a function parameter is purposely unused.</div><div class="ttdef"><b>Definition:</b> eina_types.h:339</div></div>
<div class="ttc" id="astruct__Ecore__Con__Event__Client__Add_html"><div class="ttname"><a href="struct__Ecore__Con__Event__Client__Add.html">_Ecore_Con_Event_Client_Add</a></div><div class="ttdoc">Used as the data param for the ECORE_CON_EVENT_CLIENT_ADD event.</div><div class="ttdef"><b>Definition:</b> Ecore_Con.h:442</div></div>
<div class="ttc" id="astruct__Ecore__Con__Event__Client__Add_html_a9877727e79213077e8592dfca5895cbe"><div class="ttname"><a href="struct__Ecore__Con__Event__Client__Add.html#a9877727e79213077e8592dfca5895cbe">_Ecore_Con_Event_Client_Add::client</a></div><div class="ttdeci">Ecore_Con_Client * client</div><div class="ttdoc">the client that connected</div><div class="ttdef"><b>Definition:</b> Ecore_Con.h:443</div></div>
<div class="line">}</div>
</div><!-- fragment --><p> The second callback is <code>_del</code>. It is associated with <a class="el" href="group__Ecore__Con__Events__Group.html#gab6a527ae1614876cddf4630ff03ae1dc" title="A client has disconnected from the server.">ECORE_CON_EVENT_CLIENT_DEL</a>, and is called whenever a client disconnects from this server.</p>
<p>It will just print some information about the client, free the associated data structure, and call <a class="el" href="group__Ecore__Con__Client__Group.html#gab961e9decd8dc44e4c04f2ceb0ce2e68" title="Closes the connection and free memory allocated to the given client.">ecore_con_client_del()</a> on it before exiting the callback. Here's its code:</p>
<div class="fragment"><div class="line"> </div>
<div class="line"><a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_del(<span class="keywordtype">void</span> *data <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keywordtype">int</span> type <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <a class="code" href="struct__Ecore__Con__Event__Client__Del.html">Ecore_Con_Event_Client_Del</a> *ev)</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">struct </span>_Client *client;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (!ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Del.html#a47278613bc4acaf1d9f3e8c217fd2035">client</a>)</div>
<div class="line">     <span class="keywordflow">return</span> <a class="code" href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a>;</div>
<div class="ttc" id="astruct__Ecore__Con__Event__Client__Del_html"><div class="ttname"><a href="struct__Ecore__Con__Event__Client__Del.html">_Ecore_Con_Event_Client_Del</a></div><div class="ttdoc">Used as the data param for the ECORE_CON_EVENT_CLIENT_DEL event.</div><div class="ttdef"><b>Definition:</b> Ecore_Con.h:461</div></div>
<div class="ttc" id="astruct__Ecore__Con__Event__Client__Del_html_a47278613bc4acaf1d9f3e8c217fd2035"><div class="ttname"><a href="struct__Ecore__Con__Event__Client__Del.html#a47278613bc4acaf1d9f3e8c217fd2035">_Ecore_Con_Event_Client_Del::client</a></div><div class="ttdeci">Ecore_Con_Client * client</div><div class="ttdoc">the client that was lost</div><div class="ttdef"><b>Definition:</b> Ecore_Con.h:462</div></div>
<div class="line"> </div>
<div class="line">   client = <a class="code" href="group__Ecore__Con__Client__Group.html#gadacc90bc2f169308e67a3efadfa49820">ecore_con_client_data_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Del.html#a47278613bc4acaf1d9f3e8c217fd2035">client</a>);</div>
<div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Lost client with ip %s!\n&quot;</span>, <a class="code" href="group__Ecore__Con__Client__Group.html#gab02f9ae8613aca1de53996239dd5f7ea">ecore_con_client_ip_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Del.html#a47278613bc4acaf1d9f3e8c217fd2035">client</a>));</div>
<div class="line">   <span class="keywordflow">if</span> (client)</div>
<div class="line">     {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Total data received from this client: %d\n&quot;</span>, client-&gt;sdata);</div>
<div class="line">        free(client);</div>
<div class="line">     }</div>
</div><!-- fragment --><p> The last callback will print any data received by this server from its clients. It also increments the "bytes received" counter, sdata, in the data structure associated with this client. The callback code follows:</p>
<div class="fragment"><div class="line">   printf(<span class="stringliteral">&quot;Client was connected for %0.3f seconds.\n&quot;</span>,</div>
<div class="line">          <a class="code" href="group__Ecore__Con__Client__Group.html#gaa2a166c0e95b48ab214a5d5ea52e9cce">ecore_con_client_uptime_get</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Del.html#a47278613bc4acaf1d9f3e8c217fd2035">client</a>));</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Con__Client__Group.html#gab961e9decd8dc44e4c04f2ceb0ce2e68">ecore_con_client_del</a>(ev-&gt;<a class="code" href="struct__Ecore__Con__Event__Client__Del.html#a47278613bc4acaf1d9f3e8c217fd2035">client</a>);</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a>;</div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_gaa2a166c0e95b48ab214a5d5ea52e9cce"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#gaa2a166c0e95b48ab214a5d5ea52e9cce">ecore_con_client_uptime_get</a></div><div class="ttdeci">ECORE_CON_API double ecore_con_client_uptime_get(const Ecore_Con_Client *cl)</div><div class="ttdoc">Checks how long a client has been connected.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:760</div></div>
<div class="ttc" id="agroup__Ecore__Con__Client__Group_html_gab961e9decd8dc44e4c04f2ceb0ce2e68"><div class="ttname"><a href="group__Ecore__Con__Client__Group.html#gab961e9decd8dc44e4c04f2ceb0ce2e68">ecore_con_client_del</a></div><div class="ttdeci">ECORE_CON_API void * ecore_con_client_del(Ecore_Con_Client *cl)</div><div class="ttdoc">Closes the connection and free memory allocated to the given client.</div><div class="ttdef"><b>Definition:</b> ecore_con_legacy.c:711</div></div>
<div class="line">}</div>
</div><!-- fragment --><p> The important parts of this example were described above. If you need to see the full source code for it, there's a link to the code in the beginning of this page.</p>
<p>This example will start a server and start accepting connections from clients, as demonstrated in the following diagram:</p>
 <div class="image">
<img src="ecore_con-client-server-example.png" alt=""/>
</div>
 <dl class="section note"><dt>Note</dt><dd>This example contains a serious security flaw: it doesn't check for the size of data being received, thus allowing to the string to be exploited in some way. However, it is left like this to make the code simpler and just demonstrate the API usage. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:35</span>
  </p>
</div>
</body>
</html>
