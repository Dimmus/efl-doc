<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>EPhysics - Camera</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EPhysics - Camera </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this example is to demonstrate the EPhysics_Camera usage.</p>
<p>The EPhysics_Camera facilitates the usage of scenarios bigger than the viewport, that's because the EPhysics handles the position of objects which has control.</p>
<div class="image">
<img src="camera.png" alt=""/>
</div>
 <p>For this example we'll have an EPhysics_World, two distant EPhysics_Bodys, one with an impulse to collide each other and an EPhysics_Camera that follows the moving body using an animator.</p>
<p>The basic concepts like - initializing an EPhysics_World, render geometry, physics limiting boundaries, add an Ephysics_Body, associate it to evas objects, change restitution, friction and impulse properties, were already covered in <a class="el" href="tutorial_ephysics_bouncing_ball.html">EPhysics - Bouncing Ball</a></p>
<h1><a class="anchor" id="add-camstruct"></a>
Camera Data Struct</h1>
<p></p>
<p>While in this example we'll be working with a struct to hold some objects in our code. For clarity sake we present you the struct declaration in the following block.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>_Camera_Data {</div>
<div class="line">     Test_Data base;</div>
<div class="line">     <a class="code" href="structEcore__Animator.html">Ecore_Animator</a> *animator;</div>
<div class="line">     <span class="keywordtype">int</span> old_x;</div>
<div class="line">};</div>
<div class="ttc" id="astructEcore__Animator_html"><div class="ttname"><a href="structEcore__Animator.html">Ecore_Animator</a></div><div class="ttdoc">Opaque handle to manage Ecore Animator objects.</div></div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md5"></a>
Adding a Camera</h1>
<p>To move the camera in this example, we'll use an animator.</p>
<div class="fragment"><div class="line">   camera_data-&gt;animator = <a class="code" href="group__Ecore__Animator__Group.html#gaa1e33b8be9117a26918823c535e429ea">ecore_animator_add</a>(_camera_move_cb, camera_data);</div>
<div class="ttc" id="agroup__Ecore__Animator__Group_html_gaa1e33b8be9117a26918823c535e429ea"><div class="ttname"><a href="group__Ecore__Animator__Group.html#gaa1e33b8be9117a26918823c535e429ea">ecore_animator_add</a></div><div class="ttdeci">Ecore_Animator * ecore_animator_add(Ecore_Task_Cb func, const void *data)</div><div class="ttdoc">Adds an animator to call func at every animation tick during main loop execution.</div><div class="ttdef"><b>Definition:</b> ecore_anim.c:537</div></div>
</div><!-- fragment --><p> In the animators function, we'll have to create a specific type of variable: <a class="el" href="group__EPhysics__Camera.html">EPhysics Camera</a> And also get the worlds rendered area width to define a limit to the camera.</p>
<p></p>
<div class="fragment"><div class="line">_camera_move_cb(<span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">   Camera_Data *camera_data = data;</div>
<div class="line">   <a class="code" href="group__EPhysics__Camera.html#ga945948dcbf4d98beb457c77b6537116f">EPhysics_Camera</a> *camera;</div>
<div class="line">   <span class="keywordtype">int</span> x, y, w;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__EPhysics__World.html#ga6bc905b2f56aa2a6c567d9a1575f9075">ephysics_world_render_geometry_get</a>(camera_data-&gt;base.world,</div>
<div class="line">                                      NULL, NULL, NULL, &amp;w, NULL, NULL);</div>
<div class="ttc" id="agroup__EPhysics__Camera_html_ga945948dcbf4d98beb457c77b6537116f"><div class="ttname"><a href="group__EPhysics__Camera.html#ga945948dcbf4d98beb457c77b6537116f">EPhysics_Camera</a></div><div class="ttdeci">struct _EPhysics_Camera EPhysics_Camera</div><div class="ttdoc">Camera handle, used to change the position of the frame to be rendered.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:673</div></div>
<div class="ttc" id="agroup__EPhysics__World_html_ga6bc905b2f56aa2a6c567d9a1575f9075"><div class="ttname"><a href="group__EPhysics__World.html#ga6bc905b2f56aa2a6c567d9a1575f9075">ephysics_world_render_geometry_get</a></div><div class="ttdeci">EAPI void ephysics_world_render_geometry_get(const EPhysics_World *world, Evas_Coord *x, Evas_Coord *y, Evas_Coord *z, Evas_Coord *w, Evas_Coord *h, Evas_Coord *d)</div><div class="ttdoc">Get dimensions of rendered area to be take on account by default updates.</div></div>
</div><!-- fragment --><p> Every world has a camera, so here we get this camera used by our EPhysics_World.</p>
<div class="fragment"><div class="line">   camera = <a class="code" href="group__EPhysics__World.html#ga97fe0c2a98a7998f29f7390cea868ff0">ephysics_world_camera_get</a>(camera_data-&gt;base.world);</div>
<div class="ttc" id="agroup__EPhysics__World_html_ga97fe0c2a98a7998f29f7390cea868ff0"><div class="ttname"><a href="group__EPhysics__World.html#ga97fe0c2a98a7998f29f7390cea868ff0">ephysics_world_camera_get</a></div><div class="ttdeci">EAPI EPhysics_Camera * ephysics_world_camera_get(const EPhysics_World *world)</div><div class="ttdoc">Get the camera used by an ephysics world.</div></div>
</div><!-- fragment --><p> Here we get the cameras position to after set the position based on previous.</p>
<div class="fragment"><div class="line">   <a class="code" href="group__EPhysics__Camera.html#ga5e549e85d0d98a878dc636b6463645d6">ephysics_camera_position_get</a>(camera, &amp;x, &amp;y);</div>
<div class="ttc" id="agroup__EPhysics__Camera_html_ga5e549e85d0d98a878dc636b6463645d6"><div class="ttname"><a href="group__EPhysics__Camera.html#ga5e549e85d0d98a878dc636b6463645d6">ephysics_camera_position_get</a></div><div class="ttdeci">EAPI void ephysics_camera_position_get(const EPhysics_Camera *camera, Evas_Coord *x, Evas_Coord *y)</div><div class="ttdoc">Get camera's position.</div></div>
</div><!-- fragment --><p> Here we check if the camera reached the end of scenario (define the limit to the camera) then we stop the animator, else we move the camera + 2 pixel positions to the right.</p>
<div class="fragment"><div class="line">   <span class="keywordflow">if</span> (x + w &gt; WIDTH * 2)</div>
<div class="line">     {</div>
<div class="line">        camera_data-&gt;animator = NULL;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;</div>
<div class="line">     }</div>
<div class="line"> </div>
<div class="line">   x += 2;</div>
<div class="line">   <a class="code" href="group__EPhysics__Camera.html#gaed0ba3e4daecc66fca5dc399031da530">ephysics_camera_position_set</a>(camera, x, y);</div>
<div class="ttc" id="agroup__EPhysics__Camera_html_gaed0ba3e4daecc66fca5dc399031da530"><div class="ttname"><a href="group__EPhysics__Camera.html#gaed0ba3e4daecc66fca5dc399031da530">ephysics_camera_position_set</a></div><div class="ttdeci">EAPI void ephysics_camera_position_set(EPhysics_Camera *camera, Evas_Coord x, Evas_Coord y)</div><div class="ttdoc">Set camera's position.</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga1feb115f8e9913e806e090d9bd5a7301"><div class="ttname"><a href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a></div><div class="ttdeci">#define EINA_FALSE</div><div class="ttdoc">boolean value FALSE (numerical value 0)</div><div class="ttdef"><b>Definition:</b> eina_types.h:533</div></div>
<div class="line">}</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md6"></a>
Updating the floor</h1>
<p>Here we'll use 2 floor images to give the impression of an infinite ground.</p>
<p>Calling <a class="el" href="group__EPhysics__World.html#ga2b621ffb39920e4619fe2ec2e5508073" title="Register a callback to a type of physics world event.">ephysics_world_event_callback_add()</a> will register a callback to a type of physics world event.</p>
<p><a class="el" href="group__EPhysics__World.html#gga0b0aff31f415be24679d4ab703674619aa5f6adbd98bc6599221d12ecfeb1cbc6">EPHYSICS_CALLBACK_WORLD_CAMERA_MOVED</a> : called if the camera position changed on physics simulation tick.</p>
<div class="fragment"><div class="line">   <a class="code" href="group__EPhysics__World.html#ga2b621ffb39920e4619fe2ec2e5508073">ephysics_world_event_callback_add</a>(world,</div>
<div class="line">                                     <a class="code" href="group__EPhysics__World.html#gga0b0aff31f415be24679d4ab703674619aa5f6adbd98bc6599221d12ecfeb1cbc6">EPHYSICS_CALLBACK_WORLD_CAMERA_MOVED</a>,</div>
<div class="line">                                     _camera_moved_cb, camera_data);</div>
<div class="ttc" id="agroup__EPhysics__World_html_ga2b621ffb39920e4619fe2ec2e5508073"><div class="ttname"><a href="group__EPhysics__World.html#ga2b621ffb39920e4619fe2ec2e5508073">ephysics_world_event_callback_add</a></div><div class="ttdeci">EAPI void ephysics_world_event_callback_add(EPhysics_World *world, EPhysics_Callback_World_Type type, EPhysics_World_Event_Cb func, const void *data)</div><div class="ttdoc">Register a callback to a type of physics world event.</div></div>
<div class="ttc" id="agroup__EPhysics__World_html_gga0b0aff31f415be24679d4ab703674619aa5f6adbd98bc6599221d12ecfeb1cbc6"><div class="ttname"><a href="group__EPhysics__World.html#gga0b0aff31f415be24679d4ab703674619aa5f6adbd98bc6599221d12ecfeb1cbc6">EPHYSICS_CALLBACK_WORLD_CAMERA_MOVED</a></div><div class="ttdeci">@ EPHYSICS_CALLBACK_WORLD_CAMERA_MOVED</div><div class="ttdoc">camera position changed</div><div class="ttdef"><b>Definition:</b> EPhysics.h:919</div></div>
</div><!-- fragment --><p> In the function, we just get the cameras position to know how much the camera moved and move the same value to the floor passing it as delta_x to the function, note that we use an old_x variable to do this calculation. </p>
<div class="fragment"><div class="line">_camera_moved_cb(<span class="keywordtype">void</span> *data, <a class="code" href="group__EPhysics__World.html#ga83c0d22744748525aa2dac11726c58e6">EPhysics_World</a> *world __UNUSED__, <span class="keywordtype">void</span> *event_info)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group__EPhysics__Camera.html#ga945948dcbf4d98beb457c77b6537116f">EPhysics_Camera</a> *camera = event_info;</div>
<div class="line">   Camera_Data *camera_data = data;</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *floor_obj;</div>
<div class="line">   <span class="keywordtype">int</span> x;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__File__Group.html#gae8924623ca601364965e3d88fb7f40fa">DBG</a>(<span class="stringliteral">&quot;Camera moved&quot;</span>);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__EPhysics__Camera.html#ga5e549e85d0d98a878dc636b6463645d6">ephysics_camera_position_get</a>(camera, &amp;x, NULL);</div>
<div class="line"> </div>
<div class="line">   floor_obj = <a class="code" href="group__Evas__Object__Group__Extras.html#ga2c207e9b215bc73f16c70b5387b3385b">evas_object_data_get</a>(camera_data-&gt;base.layout, <span class="stringliteral">&quot;floor&quot;</span>);</div>
<div class="line">   _update_floor(floor_obj, camera_data-&gt;old_x - x);</div>
<div class="line"> </div>
<div class="line">   floor_obj = <a class="code" href="group__Evas__Object__Group__Extras.html#ga2c207e9b215bc73f16c70b5387b3385b">evas_object_data_get</a>(camera_data-&gt;base.layout, <span class="stringliteral">&quot;floor2&quot;</span>);</div>
<div class="line">   _update_floor(floor_obj, camera_data-&gt;old_x - x);</div>
<div class="line"> </div>
<div class="line">   camera_data-&gt;old_x = x;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__EPhysics__World_html_ga83c0d22744748525aa2dac11726c58e6"><div class="ttname"><a href="group__EPhysics__World.html#ga83c0d22744748525aa2dac11726c58e6">EPhysics_World</a></div><div class="ttdeci">struct _EPhysics_World EPhysics_World</div><div class="ttdoc">World handle, most basic type of EPhysics.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:901</div></div>
<div class="ttc" id="agroup__Eina__File__Group_html_gae8924623ca601364965e3d88fb7f40fa"><div class="ttname"><a href="group__Eina__File__Group.html#gae8924623ca601364965e3d88fb7f40fa">DBG</a></div><div class="ttdeci">#define DBG(...)</div><div class="ttdoc">Macro for logging Eina debug messages.</div><div class="ttdef"><b>Definition:</b> eina_file_common.h:179</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Extras_html_ga2c207e9b215bc73f16c70b5387b3385b"><div class="ttname"><a href="group__Evas__Object__Group__Extras.html#ga2c207e9b215bc73f16c70b5387b3385b">evas_object_data_get</a></div><div class="ttdeci">EVAS_API void * evas_object_data_get(const Evas_Object *obj, const char *key)</div><div class="ttdoc">Return an attached data pointer on an Evas object by its given string key.</div><div class="ttdef"><b>Definition:</b> evas_data.c:12</div></div>
<div class="ttc" id="agroup__Evas__Object__Group_html_ga9e19e6dd1f517a0ba437c0114d3e7c97"><div class="ttname"><a href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a></div><div class="ttdeci">Efl_Canvas_Object Evas_Object</div><div class="ttdoc">An Evas Object handle.</div><div class="ttdef"><b>Definition:</b> Evas_Common.h:185</div></div>
</div><!-- fragment --><p> Here we get the floors position and plus the delta_x value to move the floor in the same "velocity".</p>
<p></p>
<div class="fragment"><div class="line">_update_floor(<a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *floor_obj, <a class="code" href="Evas__Common_8h.html#a2453e92182bad3b0e0d84e5aff433b07">Evas_Coord</a> delta)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">int</span> fx, x, y;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Basic.html#ga6e8e78e110392480dd612df86a16b630">evas_object_geometry_get</a>(floor_obj, &amp;x, &amp;y, NULL, NULL);</div>
<div class="line">   fx = x + delta;</div>
<div class="ttc" id="aEvas__Common_8h_html_a2453e92182bad3b0e0d84e5aff433b07"><div class="ttname"><a href="Evas__Common_8h.html#a2453e92182bad3b0e0d84e5aff433b07">Evas_Coord</a></div><div class="ttdeci">int Evas_Coord</div><div class="ttdoc">Type used for coordinates (in pixels, int).</div><div class="ttdef"><b>Definition:</b> Evas_Common.h:116</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Basic_html_ga6e8e78e110392480dd612df86a16b630"><div class="ttname"><a href="group__Evas__Object__Group__Basic.html#ga6e8e78e110392480dd612df86a16b630">evas_object_geometry_get</a></div><div class="ttdeci">EVAS_API void evas_object_geometry_get(const Evas_Object *eo_obj, Evas_Coord *x, Evas_Coord *y, Evas_Coord *w, Evas_Coord *h)</div><div class="ttdoc">Retrieves the position and (rectangular) size of the given Evas object.</div><div class="ttdef"><b>Definition:</b> evas_object_main.c:1335</div></div>
</div><!-- fragment --><p> We use 2 floor images because whenever one exits the screen by the left side, another is being shown, when it happens the one which exit the screen is sent to the right side, entering into an infinite loop, giving the impression of an infinite ground image. Its important to note that we need to use the fx to don't gap the images.</p>
<div class="fragment"><div class="line">   <span class="keywordflow">if</span> (fx &lt; -FLOOR_WIDTH)</div>
<div class="line">     fx += 2 * FLOOR_WIDTH;</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#ga335c8ee6eaeaac9710656af4f8b0db91">evas_object_move</a>(floor_obj, fx, y);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Evas__Object__Group_html_ga335c8ee6eaeaac9710656af4f8b0db91"><div class="ttname"><a href="group__Evas__Object__Group.html#ga335c8ee6eaeaac9710656af4f8b0db91">evas_object_move</a></div><div class="ttdeci">EVAS_API void evas_object_move(Evas_Object *obj, Evas_Coord x, Evas_Coord y)</div><div class="ttdoc">Move the given Evas object to the given location inside its canvas' viewport.</div><div class="ttdef"><b>Definition:</b> evas_object_main.c:1171</div></div>
</div><!-- fragment --><p> Here we finish the example. The full source code can be found at <a class="el" href="test_camera_c.html">test_camera.c</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:39</span>
  </p>
</div>
</body>
</html>
