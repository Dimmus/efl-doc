<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>EPhysics - Velocity</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EPhysics - Velocity </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this example is to demonstrate the EPhysics Velocity usage - The code adds a small bouncing ball on the ground and responding to users events by making it jump - applying a central impulse on it and showing its velocity and acceleration.</p>
<p>We'll see in this example how to get EPhysics_Body Linear and Angular velocity and acceleration.</p>
<p>For this example we'll have an EPhysics_World and one basic EPhysics_Body, we'll apply impulses that follows user events, it were already covered in <a class="el" href="tutorial_ephysics_bouncing_ball.html">EPhysics - Bouncing Ball</a></p>
<h1><a class="anchor" id="add-velstruct"></a>
Velocity Data Struct</h1>
<p></p>
<p>While in this example we'll be working with a struct to hold some objects in our code. For clarity sake we present you the struct declaration in the following block.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>_Velocity_Data {</div>
<div class="line">     Test_Data base;</div>
<div class="line">     <a class="code" href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a> *body;</div>
<div class="line">     <span class="keywordtype">double</span> old_vx;</div>
<div class="line">     <span class="keywordtype">double</span> old_vy;</div>
<div class="line">     <span class="keywordtype">double</span> old_vaz;</div>
<div class="line">     <span class="keywordtype">double</span> last_time;</div>
<div class="line">};</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gaf39ad724f8a2f81f9139c63263900bf1"><div class="ttname"><a href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a></div><div class="ttdeci">struct _EPhysics_Body EPhysics_Body</div><div class="ttdoc">Body handle, represents an object on EPhysics world.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:655</div></div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md22"></a>
Adding the Callbacks</h1>
<p>Calling <a class="el" href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067" title="Register a callback to a type of physics body event.">ephysics_body_event_callback_add()</a> will register a callback to a type of physics body event.</p>
<p><a class="el" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277cacb2363cd59bc8642e74ad916c6658e0a">EPHYSICS_CALLBACK_BODY_UPDATE</a> : called after every physics iteration. In other words, will be called after each world tick.</p>
<div class="fragment"><div class="line">   <a class="code" href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067">ephysics_body_event_callback_add</a>(sphere_body, <a class="code" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277cacb2363cd59bc8642e74ad916c6658e0a">EPHYSICS_CALLBACK_BODY_UPDATE</a>,</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gada176f4748a4c2fc4ba2042021ea7067"><div class="ttname"><a href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067">ephysics_body_event_callback_add</a></div><div class="ttdeci">EAPI void ephysics_body_event_callback_add(EPhysics_Body *body, EPhysics_Callback_Body_Type type, EPhysics_Body_Event_Cb func, const void *data)</div><div class="ttdoc">Register a callback to a type of physics body event.</div></div>
<div class="ttc" id="agroup__EPhysics__Body_html_gga904d0d1462e71c1f32cb27f540b5277cacb2363cd59bc8642e74ad916c6658e0a"><div class="ttname"><a href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277cacb2363cd59bc8642e74ad916c6658e0a">EPHYSICS_CALLBACK_BODY_UPDATE</a></div><div class="ttdeci">@ EPHYSICS_CALLBACK_BODY_UPDATE</div><div class="ttdoc">Body being updated.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:2263</div></div>
<div class="line">                                    _update_vel_cb, velocity_data);</div>
</div><!-- fragment --><p> <a class="el" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277cae88f6dfe5c24a67f5f074fb818edfa72">EPHYSICS_CALLBACK_BODY_STOPPED</a> : called when a body is found to be stopped. In other words, when the body is not moving anymore.</p>
<div class="fragment"><div class="line">   <a class="code" href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067">ephysics_body_event_callback_add</a>(sphere_body, <a class="code" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277cae88f6dfe5c24a67f5f074fb818edfa72">EPHYSICS_CALLBACK_BODY_STOPPED</a>,</div>
<div class="line">                                    _update_vel_cb, velocity_data);</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gga904d0d1462e71c1f32cb27f540b5277cae88f6dfe5c24a67f5f074fb818edfa72"><div class="ttname"><a href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277cae88f6dfe5c24a67f5f074fb818edfa72">EPHYSICS_CALLBACK_BODY_STOPPED</a></div><div class="ttdeci">@ EPHYSICS_CALLBACK_BODY_STOPPED</div><div class="ttdoc">Body is not moving any more.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:2266</div></div>
</div><!-- fragment --><p> See <a class="el" href="group__EPhysics__Body.html#ga904d0d1462e71c1f32cb27f540b5277c">_EPhysics_Callback_Body_Type</a> for more event types.</p>
<h1><a class="anchor" id="add-velcb"></a>
Velocity Function</h1>
<p>The callback function will be called on every physics iteration to show the linear and angular velocity and acceleration.</p>
<p>Here we're declaring the necessary variables to calculate acelerations and delta time. And checking if its the first time to return before shows informations about the velocity.</p>
<p></p>
<div class="fragment"><div class="line">_update_vel_cb(<span class="keywordtype">void</span> *data, <a class="code" href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a> *body, <span class="keywordtype">void</span> *event_info __UNUSED__)</div>
<div class="line">{</div>
<div class="line">   Velocity_Data *velocity_data = data;</div>
<div class="line">   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a> first_call = <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;</div>
<div class="line">   <span class="keywordtype">double</span> vx, vy, ax, ay, vaz, aaz;</div>
<div class="line">   <span class="keywordtype">double</span> time_now, delta_time;</div>
<div class="line">   <span class="keywordtype">char</span> buff[64];</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (!velocity_data-&gt;last_time)</div>
<div class="line">     first_call = <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;</div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga05c12dacc8b4058994df842b41be85fc"><div class="ttname"><a href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a></div><div class="ttdeci">#define EINA_TRUE</div><div class="ttdoc">boolean value TRUE (numerical value 1)</div><div class="ttdef"><b>Definition:</b> eina_types.h:539</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga1feb115f8e9913e806e090d9bd5a7301"><div class="ttname"><a href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a></div><div class="ttdeci">#define EINA_FALSE</div><div class="ttdoc">boolean value FALSE (numerical value 0)</div><div class="ttdef"><b>Definition:</b> eina_types.h:533</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga3fe0caf72e93b1bab1ca8ee3ccf3f226"><div class="ttname"><a href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div><div class="ttdeci">unsigned char Eina_Bool</div><div class="ttdoc">Type to mimic a boolean.</div><div class="ttdef"><b>Definition:</b> eina_types.h:527</div></div>
</div><!-- fragment --><p> Get the delta time to use it soon to calculate the acceleration on every physics iteration.</p>
<div class="fragment"><div class="line">   time_now = <a class="code" href="group__Ecore__Time__Group.html#ga98f2439b5d3e7114a75bfe2f0c22c4e9">ecore_time_get</a>();</div>
<div class="line">   delta_time = time_now - velocity_data-&gt;last_time;</div>
<div class="line">   velocity_data-&gt;last_time = time_now;</div>
<div class="ttc" id="agroup__Ecore__Time__Group_html_ga98f2439b5d3e7114a75bfe2f0c22c4e9"><div class="ttname"><a href="group__Ecore__Time__Group.html#ga98f2439b5d3e7114a75bfe2f0c22c4e9">ecore_time_get</a></div><div class="ttdeci">double ecore_time_get(void)</div><div class="ttdoc">Retrieves the current system time as a floating point value in seconds.</div><div class="ttdef"><b>Definition:</b> ecore_time.c:33</div></div>
</div><!-- fragment --><p> Note in this part we get the angular and linear velocities.</p>
<div class="fragment"><div class="line">   <a class="code" href="group__EPhysics__Body.html#ga4aa2211390aefa191a13639a672f21e8">ephysics_body_angular_velocity_get</a>(body, NULL, NULL, &amp;vaz);</div>
<div class="line">   <a class="code" href="group__EPhysics__Body.html#ga45dadf9123da25dd007b6c458f86d589">ephysics_body_linear_velocity_get</a>(body, &amp;vx, &amp;vy, NULL);</div>
<div class="ttc" id="agroup__EPhysics__Body_html_ga45dadf9123da25dd007b6c458f86d589"><div class="ttname"><a href="group__EPhysics__Body.html#ga45dadf9123da25dd007b6c458f86d589">ephysics_body_linear_velocity_get</a></div><div class="ttdeci">EAPI void ephysics_body_linear_velocity_get(const EPhysics_Body *body, double *x, double *y, double *z)</div><div class="ttdoc">Get body's linear velocity on x, y and z axes.</div></div>
<div class="ttc" id="agroup__EPhysics__Body_html_ga4aa2211390aefa191a13639a672f21e8"><div class="ttname"><a href="group__EPhysics__Body.html#ga4aa2211390aefa191a13639a672f21e8">ephysics_body_angular_velocity_get</a></div><div class="ttdeci">EAPI void ephysics_body_angular_velocity_get(const EPhysics_Body *body, double *x, double *y, double *z)</div><div class="ttdoc">Get body's angular velocity on x, y and z axes.</div></div>
</div><!-- fragment --><p> We need to handle the velocity using delta time to have the acceleration on every tick. Check if its the first time to return before shows informations about the velocity because we don't have the old aceletations and then the calculation of this informations will be wrong.</p>
<p>Here we calculate the aceletarions using this formula:</p>
<p>(velocity - old_velocity) / delta_time;</p>
<div class="fragment"><div class="line">   aaz = (vaz - velocity_data-&gt;old_vaz) / delta_time;</div>
<div class="line">   velocity_data-&gt;old_vaz = vaz;</div>
<div class="line">   ax = (vx - velocity_data-&gt;old_vx) / delta_time;</div>
<div class="line">   velocity_data-&gt;old_vx = vx;</div>
<div class="line">   ay = (vy - velocity_data-&gt;old_vy) / delta_time;</div>
<div class="line">   velocity_data-&gt;old_vy = vy;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (first_call) <span class="keywordflow">return</span>;</div>
</div><!-- fragment --><p> Turning data into text, to pass it to edje shows on screen.</p>
<div class="fragment"><div class="line">   snprintf(buff, <span class="keyword">sizeof</span>(buff), <span class="stringliteral">&quot;Linear velocity: %.2f, %.2f&quot;</span>, vx, vy);</div>
<div class="line">   <a class="code" href="group__Elm__Layout.html#ga08d021fce14ac123d0b81d2c8dcb8ae9">elm_layout_text_set</a>(velocity_data-&gt;base.layout, <span class="stringliteral">&quot;linear_vel&quot;</span>, buff);</div>
<div class="line">   snprintf(buff, <span class="keyword">sizeof</span>(buff), <span class="stringliteral">&quot;Linear acceleration: %.2f, %.2f&quot;</span>, ax, ay);</div>
<div class="line">   <a class="code" href="group__Elm__Layout.html#ga08d021fce14ac123d0b81d2c8dcb8ae9">elm_layout_text_set</a>(velocity_data-&gt;base.layout, <span class="stringliteral">&quot;linear_acc&quot;</span>, buff);</div>
<div class="ttc" id="agroup__Elm__Layout_html_ga08d021fce14ac123d0b81d2c8dcb8ae9"><div class="ttname"><a href="group__Elm__Layout.html#ga08d021fce14ac123d0b81d2c8dcb8ae9">elm_layout_text_set</a></div><div class="ttdeci">Eina_Bool elm_layout_text_set(Eo *obj, const char *part, const char *text)</div><div class="ttdoc">Set the text of the given part.</div><div class="ttdef"><b>Definition:</b> efl_ui_layout.c:3162</div></div>
<div class="line">   snprintf(buff, <span class="keyword">sizeof</span>(buff), <span class="stringliteral">&quot;Angular velocity: %.2f&quot;</span>, vaz);</div>
<div class="line">   <a class="code" href="group__Elm__Layout.html#ga08d021fce14ac123d0b81d2c8dcb8ae9">elm_layout_text_set</a>(velocity_data-&gt;base.layout, <span class="stringliteral">&quot;angular_vel&quot;</span>, buff);</div>
<div class="line">   snprintf(buff, <span class="keyword">sizeof</span>(buff), <span class="stringliteral">&quot;Angular acceleration: %.2f&quot;</span>, aaz);</div>
<div class="line">   <a class="code" href="group__Elm__Layout.html#ga08d021fce14ac123d0b81d2c8dcb8ae9">elm_layout_text_set</a>(velocity_data-&gt;base.layout, <span class="stringliteral">&quot;angular_acc&quot;</span>, buff);</div>
<div class="line">}</div>
</div><!-- fragment --><p> Here we finish the example. The full source code can be found at <a class="el" href="test_velocity_c.html">test_velocity.c</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:40</span>
  </p>
</div>
</body>
</html>
