<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>Eina value custom type example</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Eina value custom type example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p></p>
<p>For this example we'll be creating our own custom type of eina value. Eina value can already store struct timeval(man gettimeofday for more information) but it has no type to store struct timezone, so that's what this example will do. </p><dl class="section note"><dt>Note</dt><dd>Struct timezone is actually obsolete, so using it in real world programs is probably not a good idea, but this is an example so, bear with us.</dd></dl>
<p>To create our own custom eina value type we need to define functions to do the following operations on it: </p><ul>
<li>Setup </li>
<li>Flush </li>
<li>Copy </li>
<li>Compare </li>
<li>Set </li>
<li>Get </li>
<li>Conversion</li>
</ul>
<p>Most of this functions are very simple, so let's look at them, starting with setup which only clear the memory so that we can be certain we won't be using stale data: </p><div class="fragment"><div class="line"><span class="comment">//Compile with:</span></div>
<div class="line"><span class="comment">//gcc eina_value_03.c -o eina_value_03 `pkg-config --cflags --libs eina`</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Eina_8h.html">Eina.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_tz_setup(<span class="keyword">const</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> *type, <span class="keywordtype">void</span> *mem)</div>
<div class="line">{</div>
<div class="line">   memset(mem, 0, type-&gt;value_size);</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;</div>
<div class="line">}</div>
<div class="ttc" id="aEina_8h_html"><div class="ttname"><a href="Eina_8h.html">Eina.h</a></div><div class="ttdoc">Eina Utility library.</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga05c12dacc8b4058994df842b41be85fc"><div class="ttname"><a href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a></div><div class="ttdeci">#define EINA_TRUE</div><div class="ttdoc">boolean value TRUE (numerical value 1)</div><div class="ttdef"><b>Definition:</b> eina_types.h:539</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga3fe0caf72e93b1bab1ca8ee3ccf3f226"><div class="ttname"><a href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div><div class="ttdeci">unsigned char Eina_Bool</div><div class="ttdoc">Type to mimic a boolean.</div><div class="ttdef"><b>Definition:</b> eina_types.h:527</div></div>
<div class="ttc" id="astruct__Eina__Value__Type_html"><div class="ttname"><a href="struct__Eina__Value__Type.html">_Eina_Value_Type</a></div><div class="ttdoc">API to access values.</div><div class="ttdef"><b>Definition:</b> eina_value.h:3678</div></div>
</div><!-- fragment --><p> Now the flush function, which is even simpler, it does nothing, that's because there is nothing we need to do, all the necessary steps are taken by eina value itself: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_tz_flush(<span class="keyword">const</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> *type <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keywordtype">void</span> *mem <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga82d751be730f849719ca292f9558be87"><div class="ttname"><a href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a></div><div class="ttdeci">#define EINA_UNUSED</div><div class="ttdoc">Used to indicate that a function parameter is purposely unused.</div><div class="ttdef"><b>Definition:</b> eina_types.h:339</div></div>
</div><!-- fragment --><p> Our next function, copy, is a bit more interesting, but not much, it just casts our void pointers to struct timezone pointers and does the copy: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_tz_copy(<span class="keyword">const</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> *type <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *src, <span class="keywordtype">void</span> * dst)</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">struct </span>timezone *tzsrc = (<span class="keyword">struct </span>timezone *)src;</div>
<div class="line">   <span class="keyword">struct </span>timezone *tzdst = dst;</div>
<div class="line">   *tzdst = *tzsrc;</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>By now you might be wondering why our functions receive void pointers instead of pointers to struct timezone, and this is a good point. The reason for this is that eina value doesn't know anything about our type so it must use a generic void pointer, casting that pointer into a proper value is the job of the implementer of the new type.</dd></dl>
<p>Next we have the comparison function, which compares the <code>tz_minuteswest</code> field of struct timezone, we don't compare <code>tz_dsttime</code> because that field is not used in linux: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">_tz_compare(<span class="keyword">const</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> *type <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b)</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">struct </span>timezone tza = *(<span class="keyword">struct </span>timezone*)a;</div>
<div class="line">   <span class="keyword">struct </span>timezone tzb = *(<span class="keyword">struct </span>timezone*)b;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (tza.tz_minuteswest &lt; tzb.tz_minuteswest)</div>
<div class="line">     <span class="keywordflow">return</span> -1;</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tza.tz_minuteswest &gt; tzb.tz_minuteswest)</div>
<div class="line">     <span class="keywordflow">return</span> 1;</div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Next we have setting, this however requires not one but rather two functions, the reason for this is because to be able to receive arguments of any type eina value uses <a href="https://wikipedia.org/wiki/Variadic_functions">variadic functions</a>, so we need a function to get the argument from a va_list and another to actually to the setting.</p>
<p>Lets first look at the pset function which sets the received value to a pointer: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_tz_pset(<span class="keyword">const</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> *type <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keywordtype">void</span> *mem, <span class="keyword">const</span> <span class="keywordtype">void</span> *ptr)</div>
<div class="line">{</div>
<div class="line">   *(<span class="keyword">struct </span>timezone*)mem = *(<span class="keyword">struct</span> timezone*)ptr;</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Next we have the vset function which get the argument from the va_list and passes it to the pset function: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_tz_vset(<span class="keyword">const</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> *type, <span class="keywordtype">void</span> *mem, va_list args)</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">const</span> <span class="keyword">struct </span>timezone tz = va_arg(args, <span class="keyword">struct</span> timezone);</div>
<div class="line">   <span class="keywordflow">return</span> _tz_pset(type, mem, &amp;tz);</div>
<div class="line">}</div>
</div><!-- fragment --><p> And now the function to get the value, a very simple copying of the value to the given pointer: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_tz_pget(<span class="keyword">const</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> *type, <span class="keyword">const</span> <span class="keywordtype">void</span> *mem, <span class="keywordtype">void</span> *ptr)</div>
<div class="line">{</div>
<div class="line">   memcpy(ptr, mem, type-&gt;value_size);</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p> And finally our conversion function, this is our longest and most interesting one. For numeric type we simply assign the value of <code>tz_minuteswest</code> to the new type and call a set function using it: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_tz_convert_to(<span class="keyword">const</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> *type <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keyword">const</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> *convert, <span class="keyword">const</span> <span class="keywordtype">void</span> *type_mem, <span class="keywordtype">void</span> *convert_mem)</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">struct </span>timezone v = *(<span class="keyword">struct </span>timezone*)type_mem;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#ga798f7b7886e75d016d782c13332c9f7d">EINA_VALUE_TYPE_UCHAR</a>)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#ga50bc262dd61c71bac1024b07c7cb1143">EINA_VALUE_TYPE_USHORT</a>)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#ga2067ec9d7a8b415f78aaa9a0f5f53348">EINA_VALUE_TYPE_UINT</a>)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((convert == <a class="code" href="group__Eina__Value__Group.html#gaba83e2d960a53456d059f1aca2f3d7d1">EINA_VALUE_TYPE_ULONG</a>) || (convert == <a class="code" href="group__Eina__Value__Group.html#ga4406e1fba3da9b1dcb52e4b175370b78">EINA_VALUE_TYPE_TIMESTAMP</a>))</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#gac700d404e013551f960489cc49df7849">EINA_VALUE_TYPE_UINT64</a>)</div>
<div class="line">     {</div>
<div class="line">        uint64_t other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#ga0d54e0b952b44b7ac4f2fd573f7839c0">EINA_VALUE_TYPE_CHAR</a>)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">char</span> other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#ga85845b9a6328ff7bfc202f38fe7cbd4c">EINA_VALUE_TYPE_SHORT</a>)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">short</span> other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#ga17974fd9ab773a3efefd591ffde58f77">EINA_VALUE_TYPE_INT</a>)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">int</span> other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#gaf8b9c1de294c0287cf28f514c59204a1">EINA_VALUE_TYPE_LONG</a>)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordtype">long</span> other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#ga127af77aa29eca66320f21145304ba64">EINA_VALUE_TYPE_INT64</a>)</div>
<div class="line">     {</div>
<div class="line">        int64_t other_mem = v.tz_minuteswest;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#gaa9881efc130366d176e617c8f0f98cf8">EINA_VALUE_TYPE_FLOAT</a>)</div>
<div class="line">     <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;v.tz_minuteswest);</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#ga959961fb03cd94a84ab469245c543732">EINA_VALUE_TYPE_DOUBLE</a>)</div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga0d54e0b952b44b7ac4f2fd573f7839c0"><div class="ttname"><a href="group__Eina__Value__Group.html#ga0d54e0b952b44b7ac4f2fd573f7839c0">EINA_VALUE_TYPE_CHAR</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_CHAR</div><div class="ttdoc">manages char type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5600</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga127af77aa29eca66320f21145304ba64"><div class="ttname"><a href="group__Eina__Value__Group.html#ga127af77aa29eca66320f21145304ba64">EINA_VALUE_TYPE_INT64</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_INT64</div><div class="ttdoc">manages integer of 64 bits type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5604</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga17974fd9ab773a3efefd591ffde58f77"><div class="ttname"><a href="group__Eina__Value__Group.html#ga17974fd9ab773a3efefd591ffde58f77">EINA_VALUE_TYPE_INT</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_INT</div><div class="ttdoc">manages int type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5602</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga2067ec9d7a8b415f78aaa9a0f5f53348"><div class="ttname"><a href="group__Eina__Value__Group.html#ga2067ec9d7a8b415f78aaa9a0f5f53348">EINA_VALUE_TYPE_UINT</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_UINT</div><div class="ttdoc">manages unsigned int type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5596</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga4406e1fba3da9b1dcb52e4b175370b78"><div class="ttname"><a href="group__Eina__Value__Group.html#ga4406e1fba3da9b1dcb52e4b175370b78">EINA_VALUE_TYPE_TIMESTAMP</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_TIMESTAMP</div><div class="ttdoc">manages unsigned long type used for timestamps.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5598</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga50bc262dd61c71bac1024b07c7cb1143"><div class="ttname"><a href="group__Eina__Value__Group.html#ga50bc262dd61c71bac1024b07c7cb1143">EINA_VALUE_TYPE_USHORT</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_USHORT</div><div class="ttdoc">manages unsigned short type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5595</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga798f7b7886e75d016d782c13332c9f7d"><div class="ttname"><a href="group__Eina__Value__Group.html#ga798f7b7886e75d016d782c13332c9f7d">EINA_VALUE_TYPE_UCHAR</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_UCHAR</div><div class="ttdoc">manages unsigned char type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5593</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga85845b9a6328ff7bfc202f38fe7cbd4c"><div class="ttname"><a href="group__Eina__Value__Group.html#ga85845b9a6328ff7bfc202f38fe7cbd4c">EINA_VALUE_TYPE_SHORT</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_SHORT</div><div class="ttdoc">manages short type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5601</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga959961fb03cd94a84ab469245c543732"><div class="ttname"><a href="group__Eina__Value__Group.html#ga959961fb03cd94a84ab469245c543732">EINA_VALUE_TYPE_DOUBLE</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_DOUBLE</div><div class="ttdoc">manages double type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5606</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_gaa9881efc130366d176e617c8f0f98cf8"><div class="ttname"><a href="group__Eina__Value__Group.html#gaa9881efc130366d176e617c8f0f98cf8">EINA_VALUE_TYPE_FLOAT</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_FLOAT</div><div class="ttdoc">manages float type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5605</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_gaba83e2d960a53456d059f1aca2f3d7d1"><div class="ttname"><a href="group__Eina__Value__Group.html#gaba83e2d960a53456d059f1aca2f3d7d1">EINA_VALUE_TYPE_ULONG</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_ULONG</div><div class="ttdoc">manages unsigned long type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5597</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_gac700d404e013551f960489cc49df7849"><div class="ttname"><a href="group__Eina__Value__Group.html#gac700d404e013551f960489cc49df7849">EINA_VALUE_TYPE_UINT64</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_UINT64</div><div class="ttdoc">manages unsigned integer of 64 bits type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5599</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_gaf8b9c1de294c0287cf28f514c59204a1"><div class="ttname"><a href="group__Eina__Value__Group.html#gaf8b9c1de294c0287cf28f514c59204a1">EINA_VALUE_TYPE_LONG</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_LONG</div><div class="ttdoc">manages long type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5603</div></div>
<div class="ttc" id="agroup__Eina__Value__Type__Group_html_gaa1db66cf99d88b020f41763cd171a98d"><div class="ttname"><a href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a></div><div class="ttdeci">static Eina_Bool eina_value_type_pset(const Eina_Value_Type *type, void *mem, const void *ptr)</div><div class="ttdoc">Sets memory using type descriptor and pointer.</div></div>
<div class="line">     <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;v.tz_minuteswest);</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It would be a good idea to add checks for over and underflow for these types and return <a class="el" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301" title="boolean value FALSE (numerical value 0)">EINA_FALSE</a> in those cases, we omit this here for brevity.</dd></dl>
<p>For string types we use <code>snprintf()</code> to format our <code>tz_minuteswest</code> field and put it in a string(again <code>tz_dsttime</code> is ignored because it's not used): </p><div class="fragment"><div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (convert == <a class="code" href="group__Eina__Value__Group.html#ga9edaffb2d45ab4d820223289def3e888">EINA_VALUE_TYPE_STRINGSHARE</a> ||</div>
<div class="line">            convert == <a class="code" href="group__Eina__Value__Group.html#ga916f76c8d5ffd4c3ee3c322a54efd0b7">EINA_VALUE_TYPE_STRING</a>)</div>
<div class="line">     {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> *other_mem;</div>
<div class="line">        <span class="keywordtype">char</span> buf[64];</div>
<div class="line">        snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, v.tz_minuteswest);</div>
<div class="line">        other_mem = buf; <span class="comment">/* required due &amp;buf == buf */</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="group__Eina__Value__Type__Group.html#gaa1db66cf99d88b020f41763cd171a98d">eina_value_type_pset</a>(convert, convert_mem, &amp;other_mem);</div>
<div class="line">     }</div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga916f76c8d5ffd4c3ee3c322a54efd0b7"><div class="ttname"><a href="group__Eina__Value__Group.html#ga916f76c8d5ffd4c3ee3c322a54efd0b7">EINA_VALUE_TYPE_STRING</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_STRING</div><div class="ttdoc">manages string type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5608</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga9edaffb2d45ab4d820223289def3e888"><div class="ttname"><a href="group__Eina__Value__Group.html#ga9edaffb2d45ab4d820223289def3e888">EINA_VALUE_TYPE_STRINGSHARE</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_STRINGSHARE</div><div class="ttdoc">manages stringshared string type.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5607</div></div>
</div><!-- fragment --><p> Finally we handle any other types by returning an error in that case: </p><div class="fragment"><div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga1feb115f8e9913e806e090d9bd5a7301"><div class="ttname"><a href="group__Eina__Types__Group.html#ga1feb115f8e9913e806e090d9bd5a7301">EINA_FALSE</a></div><div class="ttdeci">#define EINA_FALSE</div><div class="ttdoc">boolean value FALSE (numerical value 0)</div><div class="ttdef"><b>Definition:</b> eina_types.h:533</div></div>
</div><!-- fragment --><p> Now that we have all the functions, we can populate an <code>Eina_Value_Type</code> to later use it with <code><a class="el" href="group__Eina__Value__Value__Group.html#gab5c6558b1b8be2ad597d71a765cbf5f6" title="Initializes generic value storage.">eina_value_setup()</a></code>: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code" href="struct__Eina__Value__Type.html">Eina_Value_Type</a> TZ_TYPE = {</div>
<div class="line">   <a class="code" href="group__Eina__Value__Type__Group.html#ga16a703617b8fc48e3ee95663db7becb2">EINA_VALUE_TYPE_VERSION</a>,</div>
<div class="line">   <span class="keyword">sizeof</span>(<span class="keyword">struct </span>timezone),</div>
<div class="line">   &quot;struct timezone&quot;,</div>
<div class="line">   _tz_setup,</div>
<div class="line">   _tz_flush,</div>
<div class="line">   _tz_copy,</div>
<div class="line">   _tz_compare,</div>
<div class="line">   _tz_convert_to,</div>
<div class="line">   NULL, <span class="comment">//No convert from</span></div>
<div class="line">   _tz_vset,</div>
<div class="line">   _tz_pset,</div>
<div class="line">   _tz_pget</div>
<div class="line">};</div>
<div class="ttc" id="agroup__Eina__Value__Type__Group_html_ga16a703617b8fc48e3ee95663db7becb2"><div class="ttname"><a href="group__Eina__Value__Type__Group.html#ga16a703617b8fc48e3ee95663db7becb2">EINA_VALUE_TYPE_VERSION</a></div><div class="ttdeci">#define EINA_VALUE_TYPE_VERSION</div><div class="ttdoc">Current API version, used to validate type.</div><div class="ttdef"><b>Definition:</b> eina_value.h:3669</div></div>
</div><!-- fragment --><p> We can now finally use our new TZ_TYPE with eina value, so lets conclude our example by practicing that by setting its value and printing it: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keywordtype">char</span> **argv <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="struct__Eina__Value.html">Eina_Value</a> vtv, vtz;</div>
<div class="line">   <span class="keyword">struct </span>timeval tv;</div>
<div class="line">   <span class="keyword">struct </span>timezone tz;</div>
<div class="line">   <span class="keywordtype">char</span> *s;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Main__Group.html#ga81b8137665b8a4d2cb38ca50017d4c74">eina_init</a>();</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Value__Value__Group.html#gab5c6558b1b8be2ad597d71a765cbf5f6">eina_value_setup</a>(&amp;vtv, <a class="code" href="group__Eina__Value__Group.html#ga0dc75915976bd83b0d15f72a5ba34412">EINA_VALUE_TYPE_TIMEVAL</a>);</div>
<div class="line">   <a class="code" href="group__Eina__Value__Value__Group.html#gab5c6558b1b8be2ad597d71a765cbf5f6">eina_value_setup</a>(&amp;vtz, &amp;TZ_TYPE);</div>
<div class="line"> </div>
<div class="line">   gettimeofday(&amp;tv, &amp;tz);</div>
<div class="line">   <a class="code" href="group__Eina__Value__Value__Group.html#ga9a1407c953694c3d6f40ab01ebe9a294">eina_value_set</a>(&amp;vtv, tv);</div>
<div class="line">   <a class="code" href="group__Eina__Value__Value__Group.html#ga9a1407c953694c3d6f40ab01ebe9a294">eina_value_set</a>(&amp;vtz, tz);</div>
<div class="line"> </div>
<div class="line">   s = <a class="code" href="group__Eina__Value__Value__Group.html#ga689c82e03cd1ac7f0918f673d5b17bb8">eina_value_to_string</a>(&amp;vtv);</div>
<div class="line">   printf(<span class="stringliteral">&quot;time: %s\n&quot;</span>, s);</div>
<div class="line">   free(s);</div>
<div class="line">   s = <a class="code" href="group__Eina__Value__Value__Group.html#ga689c82e03cd1ac7f0918f673d5b17bb8">eina_value_to_string</a>(&amp;vtz);</div>
<div class="line">   printf(<span class="stringliteral">&quot;timezone: %s\n&quot;</span>, s);</div>
<div class="line">   free(s);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Value__Value__Group.html#ga27a121e20a7109d5eae7203fc0f54850">eina_value_free</a>(&amp;vtz);</div>
<div class="line">   <a class="code" href="group__Eina__Value__Value__Group.html#ga27a121e20a7109d5eae7203fc0f54850">eina_value_free</a>(&amp;vtv);</div>
<div class="line">   <a class="code" href="group__Eina__Main__Group.html#ga5bf35513199d5220341437c05696285d">eina_shutdown</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Eina__Main__Group_html_ga5bf35513199d5220341437c05696285d"><div class="ttname"><a href="group__Eina__Main__Group.html#ga5bf35513199d5220341437c05696285d">eina_shutdown</a></div><div class="ttdeci">EINA_API int eina_shutdown(void)</div><div class="ttdoc">Shuts down the Eina library.</div><div class="ttdef"><b>Definition:</b> eina_main.c:379</div></div>
<div class="ttc" id="agroup__Eina__Main__Group_html_ga81b8137665b8a4d2cb38ca50017d4c74"><div class="ttname"><a href="group__Eina__Main__Group.html#ga81b8137665b8a4d2cb38ca50017d4c74">eina_init</a></div><div class="ttdeci">EINA_API int eina_init(void)</div><div class="ttdoc">Initializes the Eina library.</div><div class="ttdef"><b>Definition:</b> eina_main.c:291</div></div>
<div class="ttc" id="agroup__Eina__Value__Group_html_ga0dc75915976bd83b0d15f72a5ba34412"><div class="ttname"><a href="group__Eina__Value__Group.html#ga0dc75915976bd83b0d15f72a5ba34412">EINA_VALUE_TYPE_TIMEVAL</a></div><div class="ttdeci">EINA_API const Eina_Value_Type * EINA_VALUE_TYPE_TIMEVAL</div><div class="ttdoc">manages 'struct timeval' type</div><div class="ttdef"><b>Definition:</b> eina_value.c:5612</div></div>
<div class="ttc" id="agroup__Eina__Value__Value__Group_html_ga27a121e20a7109d5eae7203fc0f54850"><div class="ttname"><a href="group__Eina__Value__Value__Group.html#ga27a121e20a7109d5eae7203fc0f54850">eina_value_free</a></div><div class="ttdeci">EINA_API void eina_value_free(Eina_Value *value)</div><div class="ttdoc">Frees value and its data.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5645</div></div>
<div class="ttc" id="agroup__Eina__Value__Value__Group_html_ga689c82e03cd1ac7f0918f673d5b17bb8"><div class="ttname"><a href="group__Eina__Value__Value__Group.html#ga689c82e03cd1ac7f0918f673d5b17bb8">eina_value_to_string</a></div><div class="ttdeci">EINA_API char * eina_value_to_string(const Eina_Value *value)</div><div class="ttdoc">Converts value to string.</div><div class="ttdef"><b>Definition:</b> eina_value.c:5719</div></div>
<div class="ttc" id="agroup__Eina__Value__Value__Group_html_ga9a1407c953694c3d6f40ab01ebe9a294"><div class="ttname"><a href="group__Eina__Value__Value__Group.html#ga9a1407c953694c3d6f40ab01ebe9a294">eina_value_set</a></div><div class="ttdeci">static Eina_Bool eina_value_set(Eina_Value *value,...)</div><div class="ttdoc">Sets the generic value.</div></div>
<div class="ttc" id="agroup__Eina__Value__Value__Group_html_gab5c6558b1b8be2ad597d71a765cbf5f6"><div class="ttname"><a href="group__Eina__Value__Value__Group.html#gab5c6558b1b8be2ad597d71a765cbf5f6">eina_value_setup</a></div><div class="ttdeci">static Eina_Bool eina_value_setup(Eina_Value *value, const Eina_Value_Type *type)</div><div class="ttdoc">Initializes generic value storage.</div></div>
<div class="ttc" id="astruct__Eina__Value_html"><div class="ttname"><a href="struct__Eina__Value.html">_Eina_Value</a></div><div class="ttdoc">defines the contents of a value</div><div class="ttdef"><b>Definition:</b> eina_value.h:662</div></div>
</div><!-- fragment --><p> For the full source code see <a class="el" href="eina_value_03_c.html">eina_value_03.c</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:33</span>
  </p>
</div>
</body>
</html>
