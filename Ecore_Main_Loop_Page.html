<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>The Ecore Main Loop</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The Ecore Main Loop </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Ecore_Main_Loop_Page_intro"></a>
What is Ecore?</h1>
<p>Ecore is a clean and tiny event loop library with many modules to do lots of convenient things for a programmer to save time and effort. It's small and lean, designed to work from embedded systems all the way up to large and powerful multi-cpu workstations. The main loop has a number of primitives to be used with its main loop. It serializes all the primitives and allows for great responsiveness without the need for threads(or any other concurrency).</p>
<h2><a class="anchor" id="timers"></a>
Timers</h2>
<p>Timers serve two main purposes: doing something at a specified time and repeatedly doing something with a set interval.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Ecore__Timer__Group.html" title="Ecore provides very flexible timer functionality.">Ecore Timer functions</a></dd></dl>
<h2><a class="anchor" id="pollers"></a>
Pollers</h2>
<p>Pollers allow for polling to be centralized into a single place therefore alleviating the need for different parts of the program to wake up at different times to do polling, thereby making the code simpler and more efficient.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Ecore__Poller__Group.html" title="Ecore poller provides infrastructure for the creation of pollers.">Ecore Poll functions</a></dd></dl>
<h2><a class="anchor" id="idler"></a>
Idlers</h2>
<p>There are three types of idlers: enterers, idlers(proper) and exiters. They are called, respectively, when the program is about to enter an idle state, when the program is idle, and when the program is leaving an idle state. Idler enterers are usually a good place to update the program state. Proper idlers are the appropriate place to do heavy computational tasks thereby using what would otherwise be wasted CPU cycles. Exiters are the perfect place to do anything your program should do just before processing events (also timers, pollers, file descriptor handlers and animators)</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Ecore__Idle__Group.html" title="The idler functionality in Ecore allows for callbacks to be called when the program isn&#39;t handling ev...">Ecore Idle functions</a></dd></dl>
<h2><a class="anchor" id="fd_handler"></a>
File descriptor handlers</h2>
<p>File descriptor handlers allow you to monitor when there is data available to read on file descriptors, when writing will not block, or if there was an error. Any valid file descriptor can be used with this API, regardless of if was gotten with an OS specific API or from ecore.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Ecore__FD__Handler__Group.html" title="Definition for functions that deal with file descriptor handlers.">File Descriptor Handling Functions</a></dd></dl>
<h2><a class="anchor" id="animators"></a>
Animators</h2>
<p>Ecore provides a facility called animators, so named since the intended use was in animations, that facilitates knowing what percentage of a given interval has elapsed. This is perfect for performing animations, but is not limited to that use, it can, for example, also be used to create a progress bar.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Ecore__Animator__Group.html" title="Ecore animators are a helper to simplify creating animations.">Ecore Animator functions</a></dd></dl>
<h2><a class="anchor" id="ev_handlers"></a>
Event handlers</h2>
<p>Event handlers are, arguably, the most important feature of the ecore main loop, they are what allows the programmer to easily handle user interaction. Events however are not only things the user does, events can represent anything for which a type is created.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__Ecore__Event__Group.html" title="Ecore events provide two main features that are of use to those using ecore: creating events and bein...">Ecore Event functions</a> All of these primitives are discussed in more detail in their respective pages linked above.</dd></dl>
<p>Here is a diagram of the main loop flow of a simple program:</p>
<div class="image">
<img src="prog_flow.png" alt=""/>
</div>
 <h1><a class="anchor" id="Ecore_Main_Loop_Page_work"></a>
How does Ecore work?</h1>
<p>Ecore is very easy to learn and use. All the function calls are designed to be easy to remember, explicit in describing what they do, and heavily name-spaced. Ecore programs can start and be very simple.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Ecore.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();</div>
<div class="line">   <a class="code" href="group__Ecore__Application__Group.html#ga70bce8ffb6e2dc2c0fdab005d566532e">ecore_app_args_set</a>(argc, argv);</div>
<div class="line">   <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();</div>
<div class="line">   <a class="code" href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a>();</div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Ecore__Application__Group_html_ga70bce8ffb6e2dc2c0fdab005d566532e"><div class="ttname"><a href="group__Ecore__Application__Group.html#ga70bce8ffb6e2dc2c0fdab005d566532e">ecore_app_args_set</a></div><div class="ttdeci">void ecore_app_args_set(int argc, const char **argv)</div><div class="ttdoc">Sets up the programs command-line arguments.</div><div class="ttdef"><b>Definition:</b> ecore_app.c:15</div></div>
<div class="ttc" id="agroup__Ecore__Init__Group_html_ga768298b932f18d7e7593a447493e5cde"><div class="ttname"><a href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a></div><div class="ttdeci">EAPI int ecore_shutdown(void)</div><div class="ttdoc">Shuts down connections, signal handlers sockets etc.</div><div class="ttdef"><b>Definition:</b> ecore.c:371</div></div>
<div class="ttc" id="agroup__Ecore__Init__Group_html_ga77757609684a2c922dc5ec398274751b"><div class="ttname"><a href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a></div><div class="ttdeci">EAPI int ecore_init(void)</div><div class="ttdoc">Sets up connections, signal handlers, sockets etc.</div><div class="ttdef"><b>Definition:</b> ecore.c:230</div></div>
<div class="ttc" id="agroup__Ecore__Main__Loop__Group_html_gaf103b9f668bb3e4fed12e52c6180132d"><div class="ttname"><a href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a></div><div class="ttdeci">void ecore_main_loop_begin(void)</div><div class="ttdoc">Runs the application main loop.</div><div class="ttdef"><b>Definition:</b> ecore_main.c:1311</div></div>
</div><!-- fragment --><p>This program is very simple and doesn't check for errors, but it does start up and begin a main loop waiting for events or timers to tick off. This program doesn't set up any, but now we can expand on this simple program a little more by adding some event handlers and timers.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;Ecore.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__Ecore__Timer__Group.html#gaf96ffb609956658ec038e54bd39f46f0">Ecore_Timer</a>         *timer1     = NULL;</div>
<div class="line"><a class="code" href="group__Ecore__Event__Group.html#ga252a2566c9c7c9094964ab8e157f0521">Ecore_Event_Handler</a> *handler1   = NULL;</div>
<div class="line"><span class="keywordtype">double</span>               start_time = 0.0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">timer_func(<span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">   printf(<span class="stringliteral">&quot;Tick timer. Sec: %3.2f\n&quot;</span>, <a class="code" href="group__Ecore__Time__Group.html#ga98f2439b5d3e7114a75bfe2f0c22c4e9">ecore_time_get</a>() - start_time);</div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">exit_func(<span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> ev_type, <span class="keywordtype">void</span> *ev)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="struct__Ecore__Event__Signal__Exit.html">Ecore_Event_Signal_Exit</a> *e;</div>
<div class="line"> </div>
<div class="line">   e = (<a class="code" href="struct__Ecore__Event__Signal__Exit.html">Ecore_Event_Signal_Exit</a> *)ev;</div>
<div class="line">   <span class="keywordflow">if</span> (e-&gt;<a class="code" href="struct__Ecore__Event__Signal__Exit.html#a75a11bba7c7e80245220a80085ad9b25">interrupt</a>)      printf(<span class="stringliteral">&quot;Exit: interrupt\n&quot;</span>);</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="struct__Ecore__Event__Signal__Exit.html#a9859b9dfe71ede48069c219cdaff9e3c">quit</a>)      printf(<span class="stringliteral">&quot;Exit: quit\n&quot;</span>);</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="struct__Ecore__Event__Signal__Exit.html#ac5e1afacd480efe389e699c52f6dd4d6">terminate</a>) printf(<span class="stringliteral">&quot;Exit: terminate\n&quot;</span>);</div>
<div class="line">   <a class="code" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a>();</div>
<div class="line">   <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();</div>
<div class="line">   <a class="code" href="group__Ecore__Application__Group.html#ga70bce8ffb6e2dc2c0fdab005d566532e">ecore_app_args_set</a>(argc, argv);</div>
<div class="line">   start_time = <a class="code" href="group__Ecore__Time__Group.html#ga98f2439b5d3e7114a75bfe2f0c22c4e9">ecore_time_get</a>();</div>
<div class="line">   handler1 = <a class="code" href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62">ecore_event_handler_add</a>(<a class="code" href="group__Ecore__Event__Group.html#ga0dd1e36930ae8fa8decc97564d57f310">ECORE_EVENT_SIGNAL_EXIT</a>, exit_func, NULL);</div>
<div class="line">   timer1 = <a class="code" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a>(0.5, timer_func, NULL);</div>
<div class="line">   <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();</div>
<div class="line">   <a class="code" href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a>();</div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Ecore__Event__Group_html_ga0dd1e36930ae8fa8decc97564d57f310"><div class="ttname"><a href="group__Ecore__Event__Group.html#ga0dd1e36930ae8fa8decc97564d57f310">ECORE_EVENT_SIGNAL_EXIT</a></div><div class="ttdeci">#define ECORE_EVENT_SIGNAL_EXIT</div><div class="ttdoc">Exit signal event.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:565</div></div>
<div class="ttc" id="agroup__Ecore__Event__Group_html_ga252a2566c9c7c9094964ab8e157f0521"><div class="ttname"><a href="group__Ecore__Event__Group.html#ga252a2566c9c7c9094964ab8e157f0521">Ecore_Event_Handler</a></div><div class="ttdeci">struct _Ecore_Event_Handler Ecore_Event_Handler</div><div class="ttdoc">A handle for an event handler.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:576</div></div>
<div class="ttc" id="agroup__Ecore__Event__Group_html_gae75b0b1b2c50e73b8e42afc628b00a62"><div class="ttname"><a href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62">ecore_event_handler_add</a></div><div class="ttdeci">Ecore_Event_Handler * ecore_event_handler_add(int type, Ecore_Event_Handler_Cb func, const void *data)</div><div class="ttdoc">Adds an event handler.</div><div class="ttdef"><b>Definition:</b> ecore_events.c:13</div></div>
<div class="ttc" id="agroup__Ecore__Main__Loop__Group_html_ga1ee9db07f9a46a8b20fb83e1c6dbed09"><div class="ttname"><a href="group__Ecore__Main__Loop__Group.html#ga1ee9db07f9a46a8b20fb83e1c6dbed09">ECORE_CALLBACK_RENEW</a></div><div class="ttdeci">#define ECORE_CALLBACK_RENEW</div><div class="ttdoc">Return value to keep a callback.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:153</div></div>
<div class="ttc" id="agroup__Ecore__Main__Loop__Group_html_ga95cf8e97dff0716433c2c5474d606a98"><div class="ttname"><a href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a></div><div class="ttdeci">void ecore_main_loop_quit(void)</div><div class="ttdoc">Quits the main loop once all the events currently on the queue have been processed.</div><div class="ttdef"><b>Definition:</b> ecore_main.c:1321</div></div>
<div class="ttc" id="agroup__Ecore__Time__Group_html_ga98f2439b5d3e7114a75bfe2f0c22c4e9"><div class="ttname"><a href="group__Ecore__Time__Group.html#ga98f2439b5d3e7114a75bfe2f0c22c4e9">ecore_time_get</a></div><div class="ttdeci">double ecore_time_get(void)</div><div class="ttdoc">Retrieves the current system time as a floating point value in seconds.</div><div class="ttdef"><b>Definition:</b> ecore_time.c:33</div></div>
<div class="ttc" id="agroup__Ecore__Timer__Group_html_ga7b9cb9d24ecebfdbb957436e2e669402"><div class="ttname"><a href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402">ecore_timer_add</a></div><div class="ttdeci">Ecore_Timer * ecore_timer_add(double in, Ecore_Task_Cb func, const void *data)</div><div class="ttdoc">Creates a timer to call the given function in the given period of time.</div><div class="ttdef"><b>Definition:</b> ecore_timer.c:189</div></div>
<div class="ttc" id="agroup__Ecore__Timer__Group_html_gaf96ffb609956658ec038e54bd39f46f0"><div class="ttname"><a href="group__Ecore__Timer__Group.html#gaf96ffb609956658ec038e54bd39f46f0">Ecore_Timer</a></div><div class="ttdeci">Eo Ecore_Timer</div><div class="ttdoc">A handle for timers.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:3079</div></div>
<div class="ttc" id="astruct__Ecore__Event__Signal__Exit_html"><div class="ttname"><a href="struct__Ecore__Event__Signal__Exit.html">_Ecore_Event_Signal_Exit</a></div><div class="ttdoc">A structure that stores information of an Exit request event.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:637</div></div>
<div class="ttc" id="astruct__Ecore__Event__Signal__Exit_html_a75a11bba7c7e80245220a80085ad9b25"><div class="ttname"><a href="struct__Ecore__Event__Signal__Exit.html#a75a11bba7c7e80245220a80085ad9b25">_Ecore_Event_Signal_Exit::interrupt</a></div><div class="ttdeci">Eina_Bool interrupt</div><div class="ttdoc">Set if the exit request was an interrupt signal.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:638</div></div>
<div class="ttc" id="astruct__Ecore__Event__Signal__Exit_html_a9859b9dfe71ede48069c219cdaff9e3c"><div class="ttname"><a href="struct__Ecore__Event__Signal__Exit.html#a9859b9dfe71ede48069c219cdaff9e3c">_Ecore_Event_Signal_Exit::quit</a></div><div class="ttdeci">Eina_Bool quit</div><div class="ttdoc">set if the exit request was a quit signal</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:639</div></div>
<div class="ttc" id="astruct__Ecore__Event__Signal__Exit_html_ac5e1afacd480efe389e699c52f6dd4d6"><div class="ttname"><a href="struct__Ecore__Event__Signal__Exit.html#ac5e1afacd480efe389e699c52f6dd4d6">_Ecore_Event_Signal_Exit::terminate</a></div><div class="ttdeci">Eina_Bool terminate</div><div class="ttdoc">Set if the exit request was a terminate signal.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:640</div></div>
</div><!-- fragment --><p>In the previous example, we initialize our application and get the time at which our program has started so we can calculate an offset. We set up a timer to tick off in 0.5 seconds, and since it returns 1, will keep ticking off every 0.5 seconds until it returns 0, or is deleted by hand. An event handler is set up to call a function - exit_func(), whenever an event of type ECORE_EVENT_SIGNAL_EXIT is received (CTRL-C on the command line will cause such an event to happen). If this event occurs it tells you what kind of exit signal was received, and asks the main loop to quit when it is finished by calling <a class="el" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98" title="Quits the main loop once all the events currently on the queue have been processed.">ecore_main_loop_quit()</a>.</p>
<p>The handles returned by <a class="el" href="group__Ecore__Timer__Group.html#ga7b9cb9d24ecebfdbb957436e2e669402" title="Creates a timer to call the given function in the given period of time.">ecore_timer_add()</a> and <a class="el" href="group__Ecore__Event__Group.html#gae75b0b1b2c50e73b8e42afc628b00a62" title="Adds an event handler.">ecore_event_handler_add()</a> are only stored here as an example. If you don't need to address the timer or event handler again you don't need to store the result, so just call the function, and don't assign the result to any variable.</p>
<p>This program looks slightly more complex than needed to do these simple things, but in principle, programs don't get any more complex. You add more event handlers, for more events, will have more timers and such, BUT it all follows the same principles as shown in this example. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:31</span>
  </p>
</div>
</body>
</html>
