<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>Eina_Inlist advanced usage - multi-inlists</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Eina_Inlist advanced usage - multi-inlists </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p></p>
<p>This example describes the usage of multiple inlists storing the same data. It means that some data may appear in more than one inlist at the same time. We will demonstrate this by creating an inlist with 100 numbers, and adding the odd numbers to the second inlist, then remove the numbers divisible by 3 from the second list.</p>
<p>To accomplish this, it is necessary to have two inlist pointers in the struct that is going to be stored. We are using the default inlist member <a class="el" href="group__Eina__Inline__List__Group.html#gab30a76fcfa50307c797491705d60136a">EINA_INLIST</a>, and adding another member <code>even</code> that is of type <a class="el" href="group__Eina__Inline__List__Group.html#gad93973c87f867f249482e936797096ad">Eina_Inlist</a> too:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>my_struct {</div>
<div class="line">     <a class="code" href="group__Eina__Inline__List__Group.html#gab30a76fcfa50307c797491705d60136a">EINA_INLIST</a>;</div>
<div class="line">     <a class="code" href="struct__Eina__Inlist.html">Eina_Inlist</a> even;</div>
<div class="line">     <span class="keywordtype">int</span> a, b;</div>
<div class="line">};</div>
<div class="ttc" id="agroup__Eina__Inline__List__Group_html_gab30a76fcfa50307c797491705d60136a"><div class="ttname"><a href="group__Eina__Inline__List__Group.html#gab30a76fcfa50307c797491705d60136a">EINA_INLIST</a></div><div class="ttdeci">#define EINA_INLIST</div><div class="ttdoc">Used for declaring an inlist member in a struct.</div><div class="ttdef"><b>Definition:</b> eina_inlist.h:411</div></div>
<div class="ttc" id="astruct__Eina__Inlist_html"><div class="ttname"><a href="struct__Eina__Inlist.html">_Eina_Inlist</a></div><div class="ttdoc">Inlined list type.</div><div class="ttdef"><b>Definition:</b> eina_inlist.h:405</div></div>
</div><!-- fragment --><p> The representation for this struct is:</p>
<div class="image">
<img src="eina_inlist-node_eg3-my-struct.png" alt=""/>
</div>
  <p>And we will define some convenience macros that are equivalent to <a class="el" href="group__Eina__Inline__List__Group.html#ga5bc991428e75557c6195f6b9e38321fb">EINA_INLIST_GET</a> and <a class="el" href="group__Eina__Inline__List__Group.html#ga8c4e6011e7caa9ec5c22b003c4950338">EINA_INLIST_CONTAINER_GET</a> :</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define EVEN_INLIST_GET(Inlist) (&amp; ((Inlist)-&gt;even))</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define EVEN_INLIST_CONTAINER_GET(ptr, type) \</span></div>
<div class="line"><span class="preprocessor">   ((type *)((char *)ptr - offsetof(type, even)))</span></div>
</div><!-- fragment --><p> We need two pointers, one for each list, and a pointer that will be used as an iterator:</p>
<div class="fragment"><div class="line">   <a class="code" href="struct__Eina__Inlist.html">Eina_Inlist</a> *list = NULL, *list_even = NULL, *itr;</div>
</div><!-- fragment --><p> Now we allocate and add to the first list every number from 0 to 99. These nodes data also have the <a class="el" href="group__Eina__Inline__List__Group.html#gad93973c87f867f249482e936797096ad">Eina_Inlist</a> node info for the second list (<code>even</code>). We will use them to add just the even numbers to the second list, the <code>list_even</code>. Also notice that we are using our macro <code>EVEN_INLIST_GET</code> to get the pointer to the even list node info:</p>
<div class="fragment"><div class="line">   <span class="keywordflow">for</span> (i = 0; i &lt; 100; i++)</div>
<div class="line">     {</div>
<div class="line">        d = malloc(<span class="keyword">sizeof</span>(*d));</div>
<div class="line">        d-&gt;a = i;</div>
<div class="line">        d-&gt;b = i * 10;</div>
<div class="line">        list = <a class="code" href="group__Eina__Inline__List__Group.html#gaa33903d0ce018142df33b1e66b8f63d5">eina_inlist_append</a>(list, <a class="code" href="group__Eina__Inline__List__Group.html#ga5bc991428e75557c6195f6b9e38321fb">EINA_INLIST_GET</a>(d));</div>
<div class="line">        <span class="keywordflow">if</span> ((i % 2) == 0)</div>
<div class="line">          list_even = <a class="code" href="group__Eina__Inline__List__Group.html#gae916292b38116e58753c289e3e21a8a0">eina_inlist_prepend</a>(list_even, EVEN_INLIST_GET(d));</div>
<div class="line">     }</div>
<div class="ttc" id="agroup__Eina__Inline__List__Group_html_ga5bc991428e75557c6195f6b9e38321fb"><div class="ttname"><a href="group__Eina__Inline__List__Group.html#ga5bc991428e75557c6195f6b9e38321fb">EINA_INLIST_GET</a></div><div class="ttdeci">#define EINA_INLIST_GET(Inlist)</div><div class="ttdoc">Utility macro to get the inlist object of a struct.</div><div class="ttdef"><b>Definition:</b> eina_inlist.h:413</div></div>
<div class="ttc" id="agroup__Eina__Inline__List__Group_html_gaa33903d0ce018142df33b1e66b8f63d5"><div class="ttname"><a href="group__Eina__Inline__List__Group.html#gaa33903d0ce018142df33b1e66b8f63d5">eina_inlist_append</a></div><div class="ttdeci">EINA_API Eina_Inlist * eina_inlist_append(Eina_Inlist *list, Eina_Inlist *new_l)</div><div class="ttdoc">Adds a new node to end of a list.</div><div class="ttdef"><b>Definition:</b> eina_inlist.c:227</div></div>
<div class="ttc" id="agroup__Eina__Inline__List__Group_html_gae916292b38116e58753c289e3e21a8a0"><div class="ttname"><a href="group__Eina__Inline__List__Group.html#gae916292b38116e58753c289e3e21a8a0">eina_inlist_prepend</a></div><div class="ttdeci">EINA_API Eina_Inlist * eina_inlist_prepend(Eina_Inlist *list, Eina_Inlist *new_l)</div><div class="ttdoc">Adds a new node to beginning of list.</div><div class="ttdef"><b>Definition:</b> eina_inlist.c:254</div></div>
</div><!-- fragment --><p> And the resulting lists will be as follow:</p>
 <div class="image">
<img src="eina_inlist-node_eg3-two-inlists.png" alt=""/>
</div>
 <p>For the first list, we can use the macro <a class="el" href="group__Eina__Inline__List__Group.html#ga65e496b9b16d527d23c1d735652b4e62">EINA_INLIST_FOREACH</a> to iterate over its elements:</p>
<div class="fragment"><div class="line">   <a class="code" href="group__Eina__Inline__List__Group.html#ga65e496b9b16d527d23c1d735652b4e62">EINA_INLIST_FOREACH</a>(list, cur)</div>
<div class="line">     printf(<span class="stringliteral">&quot;\ta=%d, b=%d\n&quot;</span>, cur-&gt;a, cur-&gt;b);</div>
<div class="ttc" id="agroup__Eina__Inline__List__Group_html_ga65e496b9b16d527d23c1d735652b4e62"><div class="ttname"><a href="group__Eina__Inline__List__Group.html#ga65e496b9b16d527d23c1d735652b4e62">EINA_INLIST_FOREACH</a></div><div class="ttdeci">#define EINA_INLIST_FOREACH(list, it)</div><div class="ttdef"><b>Definition:</b> eina_inlist.h:832</div></div>
</div><!-- fragment --><p> But for the second list, we have to do it manually. Of course we could create a similar macro to <a class="el" href="group__Eina__Inline__List__Group.html#ga65e496b9b16d527d23c1d735652b4e62">EINA_INLIST_FOREACH</a>, but since this macro is more complex than the other two and we are using it only once, it's better to just do it manually:</p>
<div class="fragment"><div class="line">   <span class="keywordflow">for</span> (itr = list_even; itr != NULL; itr = itr-&gt;next)</div>
<div class="line">     {</div>
<div class="line">        cur = EVEN_INLIST_CONTAINER_GET(itr, <span class="keyword">struct</span> my_struct);</div>
<div class="line">        printf(<span class="stringliteral">&quot;\ta=%d, b=%d\n&quot;</span>, cur-&gt;a, cur-&gt;b);</div>
<div class="line">     }</div>
</div><!-- fragment --><p> Let's just check that the two lists have the expected number of elements:</p>
<div class="fragment"><div class="line">   printf(<span class="stringliteral">&quot;list count=%d\n&quot;</span>, <a class="code" href="group__Eina__Inline__List__Group.html#ga3039bdea008dcb10d52f648d154690f8">eina_inlist_count</a>(list));</div>
<div class="line">   printf(<span class="stringliteral">&quot;list_even count=%d\n\n&quot;</span>, <a class="code" href="group__Eina__Inline__List__Group.html#ga3039bdea008dcb10d52f648d154690f8">eina_inlist_count</a>(list_even));</div>
<div class="ttc" id="agroup__Eina__Inline__List__Group_html_ga3039bdea008dcb10d52f648d154690f8"><div class="ttname"><a href="group__Eina__Inline__List__Group.html#ga3039bdea008dcb10d52f648d154690f8">eina_inlist_count</a></div><div class="ttdeci">EINA_API unsigned int eina_inlist_count(const Eina_Inlist *list)</div><div class="ttdoc">Gets the count of the number of items in a list.</div><div class="ttdef"><b>Definition:</b> eina_inlist.c:448</div></div>
</div><!-- fragment --><p> And removing the numbers divisible by 3 only from the second list:</p>
<div class="fragment"><div class="line">   itr = list_even;</div>
<div class="line">   <span class="keywordflow">while</span> (itr)</div>
<div class="line">     {</div>
<div class="line">        <a class="code" href="struct__Eina__Inlist.html">Eina_Inlist</a> *next = itr-&gt;<a class="code" href="struct__Eina__Inlist.html#ae95deba8e271f94f8ad8aecf7fdb5dde">next</a>;</div>
<div class="line">        cur = EVEN_INLIST_CONTAINER_GET(itr, <span class="keyword">struct</span> my_struct);</div>
<div class="line">        <span class="keywordflow">if</span> ((cur-&gt;a % 3) == 0)</div>
<div class="line">          list_even = <a class="code" href="group__Eina__Inline__List__Group.html#gac63799dc44bd71c21cb17bd951d7490b">eina_inlist_remove</a>(list_even, itr);</div>
<div class="line">        itr = next;</div>
<div class="line">     }</div>
<div class="line">   printf(<span class="stringliteral">&quot;list count=%d\n&quot;</span>, <a class="code" href="group__Eina__Inline__List__Group.html#ga3039bdea008dcb10d52f648d154690f8">eina_inlist_count</a>(list));</div>
<div class="line">   printf(<span class="stringliteral">&quot;list_even count=%d\n\n&quot;</span>, <a class="code" href="group__Eina__Inline__List__Group.html#ga3039bdea008dcb10d52f648d154690f8">eina_inlist_count</a>(list_even));</div>
<div class="ttc" id="agroup__Eina__Inline__List__Group_html_gac63799dc44bd71c21cb17bd951d7490b"><div class="ttname"><a href="group__Eina__Inline__List__Group.html#gac63799dc44bd71c21cb17bd951d7490b">eina_inlist_remove</a></div><div class="ttdeci">EINA_API Eina_Inlist * eina_inlist_remove(Eina_Inlist *list, Eina_Inlist *item)</div><div class="ttdoc">Removes node from list.</div><div class="ttdef"><b>Definition:</b> eina_inlist.c:335</div></div>
<div class="ttc" id="astruct__Eina__Inlist_html_ae95deba8e271f94f8ad8aecf7fdb5dde"><div class="ttname"><a href="struct__Eina__Inlist.html#ae95deba8e271f94f8ad8aecf7fdb5dde">_Eina_Inlist::next</a></div><div class="ttdeci">Eina_Inlist * next</div><div class="ttdoc">next node</div><div class="ttdef"><b>Definition:</b> eina_inlist.h:406</div></div>
</div><!-- fragment --><p> Now that we don't need the two lists anymore, we can just free all the items. Since all of the allocated data was put into the first list, and both lists are made of pointers to inside the data structures, we can free only the first list (that contains all the elements) and the second list will be gone with it:</p>
<div class="fragment"><div class="line">   <span class="keywordflow">while</span> (list)</div>
<div class="line">     {</div>
<div class="line">        <span class="keyword">struct </span>my_struct *aux = <a class="code" href="group__Eina__Inline__List__Group.html#ga8c4e6011e7caa9ec5c22b003c4950338">EINA_INLIST_CONTAINER_GET</a>(list,</div>
<div class="line">                                                          <span class="keyword">struct</span> my_struct);</div>
<div class="line">        list = <a class="code" href="group__Eina__Inline__List__Group.html#gac63799dc44bd71c21cb17bd951d7490b">eina_inlist_remove</a>(list, list);</div>
<div class="line">        free(aux);</div>
<div class="ttc" id="agroup__Eina__Inline__List__Group_html_ga8c4e6011e7caa9ec5c22b003c4950338"><div class="ttname"><a href="group__Eina__Inline__List__Group.html#ga8c4e6011e7caa9ec5c22b003c4950338">EINA_INLIST_CONTAINER_GET</a></div><div class="ttdeci">#define EINA_INLIST_CONTAINER_GET(ptr, type)</div><div class="ttdoc">Utility macro to get the container object of an inlist.</div><div class="ttdef"><b>Definition:</b> eina_inlist.h:415</div></div>
</div><!-- fragment --><p> To see the full source code for this example, click here: <a class="el" href="eina_inlist_03_c.html">eina_inlist_03.c Eina_Inlist advanced usage - multi-inlists source</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:32</span>
  </p>
</div>
</body>
</html>
