<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>Eina inline array usage</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Eina inline array usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p></p>
<p>This example creates an inline array of chars, adds some elements, prints them, re-purposes the array to store ints, adds some elements and prints that.</p>
<p>We are going to start with a function to compare ints. We need this because the '&gt;' operator is not a function and can't be used where Eina_Compare_Cb is needed. </p><div class="fragment"><div class="line"><span class="keywordtype">int</span></div>
<div class="line">cmp(<span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordflow">return</span> *(<span class="keywordtype">int</span>*)a &gt; *(<span class="keywordtype">int</span>*)b;</div>
<div class="line">}</div>
</div><!-- fragment --><p> And then move on to the code we actually care about, starting with variable declarations and eina initialization: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keywordtype">char</span> **argv <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="struct__Eina__Inarray.html">Eina_Inarray</a> *iarr;</div>
<div class="line">   <span class="keywordtype">char</span> ch, *ch2;</div>
<div class="line">   <span class="keywordtype">int</span> a, *b;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Main__Group.html#ga81b8137665b8a4d2cb38ca50017d4c74">eina_init</a>();</div>
<div class="ttc" id="agroup__Eina__Main__Group_html_ga81b8137665b8a4d2cb38ca50017d4c74"><div class="ttname"><a href="group__Eina__Main__Group.html#ga81b8137665b8a4d2cb38ca50017d4c74">eina_init</a></div><div class="ttdeci">EINA_API int eina_init(void)</div><div class="ttdoc">Initializes the Eina library.</div><div class="ttdef"><b>Definition:</b> eina_main.c:291</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga82d751be730f849719ca292f9558be87"><div class="ttname"><a href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a></div><div class="ttdeci">#define EINA_UNUSED</div><div class="ttdoc">Used to indicate that a function parameter is purposely unused.</div><div class="ttdef"><b>Definition:</b> eina_types.h:339</div></div>
<div class="ttc" id="astruct__Eina__Inarray_html"><div class="ttname"><a href="struct__Eina__Inarray.html">_Eina_Inarray</a></div><div class="ttdoc">Inline array structure.</div><div class="ttdef"><b>Definition:</b> eina_inarray.h:225</div></div>
</div><!-- fragment --><p> Creating an inline array is very simple, we just need to know what type we want to store: </p><div class="fragment"><div class="line">   iarr = <a class="code" href="group__Eina__Inline__Array__Group.html#gae9383254fe2f418afd786483ea33681d">eina_inarray_new</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), 0);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_gae9383254fe2f418afd786483ea33681d"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#gae9383254fe2f418afd786483ea33681d">eina_inarray_new</a></div><div class="ttdeci">EINA_API Eina_Inarray * eina_inarray_new(unsigned int member_size, unsigned int step)</div><div class="ttdoc">Creates a new inline array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:342</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The second parameter(the step) is left at zero which means that eina chooses an appropriate value, this should <b>only</b> be changed if it's known, beforehand, that how many elements the array has.</dd></dl>
<p>Once we have an array we can start adding elements to it. Because the insertion function expects a memory address we have to put the value we want to store in a variable (this should be no problem since in the real world usage that's usually where the value is anyways): </p><div class="fragment"><div class="line"> </div>
<div class="line">   ch = <span class="charliteral">&#39;a&#39;</span>;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga1546c690e7e63307af20f7ac3db1b095">eina_inarray_push</a>(iarr, &amp;ch);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga1546c690e7e63307af20f7ac3db1b095"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga1546c690e7e63307af20f7ac3db1b095">eina_inarray_push</a></div><div class="ttdeci">EINA_API int eina_inarray_push(Eina_Inarray *array, const void *data)</div><div class="ttdoc">Copies the data as the last member of the array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:411</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Because the inline array copies the value given to it we can later change <code>ch</code>, which we do, without affecting the contents of the array.</dd></dl>
<p>So let's add some more elements: </p><div class="fragment"><div class="line">   ch = <span class="charliteral">&#39;b&#39;</span>;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga1546c690e7e63307af20f7ac3db1b095">eina_inarray_push</a>(iarr, &amp;ch);</div>
<div class="line">   ch = <span class="charliteral">&#39;c&#39;</span>;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga1546c690e7e63307af20f7ac3db1b095">eina_inarray_push</a>(iarr, &amp;ch);</div>
<div class="line">   ch = <span class="charliteral">&#39;d&#39;</span>;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga1546c690e7e63307af20f7ac3db1b095">eina_inarray_push</a>(iarr, &amp;ch);</div>
</div><!-- fragment --><p> We then iterate over our array and print every position of it. The thing to note here is not so much the values, which are the expected 'a', 'b', 'c', and 'd', but rather the memory address of these values, they are sequential: </p><div class="fragment"><div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Inline array of chars:\n&quot;</span>);</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#gab6ffcad27b5099aa34af9ecd5e2b22f9">EINA_INARRAY_FOREACH</a>(iarr, ch2)</div>
<div class="line">     printf(<span class="stringliteral">&quot;char: %c(pointer: %p)\n&quot;</span>, *ch2, ch2);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_gab6ffcad27b5099aa34af9ecd5e2b22f9"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#gab6ffcad27b5099aa34af9ecd5e2b22f9">EINA_INARRAY_FOREACH</a></div><div class="ttdeci">#define EINA_INARRAY_FOREACH(array, itr)</div><div class="ttdoc">Walks through an array linearly from head to tail.</div><div class="ttdef"><b>Definition:</b> eina_inarray.h:724</div></div>
</div><!-- fragment --><p> We are now going to use our array to store ints, so we need to first erase every member currently on the array: </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga3adeb0e441f32ab67ec498964826aaf0">eina_inarray_flush</a>(iarr);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga3adeb0e441f32ab67ec498964826aaf0"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga3adeb0e441f32ab67ec498964826aaf0">eina_inarray_flush</a></div><div class="ttdeci">EINA_API void eina_inarray_flush(Eina_Inarray *array)</div><div class="ttdoc">Removes every member from the array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:388</div></div>
</div><!-- fragment --><p> And then to be able to store a different type on the same array, we use the <a class="el" href="group__Eina__Inline__Array__Group.html#gaf21d934d2af2fd7872187db4f4dd52cf" title="Initializes an inline array.">eina_inarray_step_set()</a> function, which is just like the <a class="el" href="group__Eina__Inline__Array__Group.html#gae9383254fe2f418afd786483ea33681d" title="Creates a new inline array.">eina_inarray_new()</a> function except it receives an already allocated memory. This time we're going to ask eina to use a step of size 4 because that's how many elements we are going to put in the array: </p><div class="fragment"><div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#gaf21d934d2af2fd7872187db4f4dd52cf">eina_inarray_step_set</a>(iarr, <span class="keyword">sizeof</span>(<a class="code" href="struct__Eina__Inarray.html">Eina_Inarray</a>), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 4);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_gaf21d934d2af2fd7872187db4f4dd52cf"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#gaf21d934d2af2fd7872187db4f4dd52cf">eina_inarray_step_set</a></div><div class="ttdeci">EINA_API void eina_inarray_step_set(Eina_Inarray *array, unsigned int sizeof_eina_inarray, unsigned int member_size, unsigned int step)</div><div class="ttdoc">Initializes an inline array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:366</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Strictly speaking the reason to call <a class="el" href="group__Eina__Inline__Array__Group.html#gaf21d934d2af2fd7872187db4f4dd52cf" title="Initializes an inline array.">eina_inarray_step_set()</a> is not because we're storing a different type, but because our types have different sizes. Eina inline arrays don't actually know anything about types, they only deal with blocks of memory of a given size. </dd>
<dd>
Since <a class="el" href="group__Eina__Inline__Array__Group.html#gaf21d934d2af2fd7872187db4f4dd52cf" title="Initializes an inline array.">eina_inarray_step_set()</a> receives already allocated memory, you can (and it is in fact a good practice) use inline arrays that are not declared as pointers: <div class="fragment"><div class="line"><a class="code" href="struct__Eina__Inarray.html">Eina_Inarray</a> arr;</div>
<div class="line"><a class="code" href="group__Eina__Inline__Array__Group.html#gaf21d934d2af2fd7872187db4f4dd52cf">eina_inarray_step_set</a>(&amp;arr, <span class="keyword">sizeof</span>(arr), <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), 4);</div>
</div><!-- fragment --></dd></dl>
<p>And now to add our integer values to the array: </p><div class="fragment"><div class="line"> </div>
<div class="line">   a = 97;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga1546c690e7e63307af20f7ac3db1b095">eina_inarray_push</a>(iarr, &amp;a);</div>
<div class="line">   a = 98;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga1546c690e7e63307af20f7ac3db1b095">eina_inarray_push</a>(iarr, &amp;a);</div>
<div class="line">   a = 100;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga1546c690e7e63307af20f7ac3db1b095">eina_inarray_push</a>(iarr, &amp;a);</div>
</div><!-- fragment --><p> Just to change things up a bit we've left out the 99 value, but we still add it in such a way that it keeps the array ordered. There are many ways to do this, we could use <a class="el" href="group__Eina__Inline__Array__Group.html#ga81ce838167d5a77d727ff8530371c445" title="Copies the data at the given position in the array.">eina_inarray_insert_at()</a>, or we could change the value of the last member using <a class="el" href="group__Eina__Inline__Array__Group.html#ga8bd6697888c2fe29b25414663e8d1890" title="Copies the data to the given position.">eina_inarray_replace_at()</a> and then append the values in the right order, but for no particular reason we're going to use <a class="el" href="group__Eina__Inline__Array__Group.html#ga8fb844f63ddda56260624756942d3e6e" title="Copies the data to the array at a position found by the comparison function.">eina_inarray_insert_sorted()</a> instead: </p><div class="fragment"><div class="line">   a = 99;</div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga8fb844f63ddda56260624756942d3e6e">eina_inarray_insert_sorted</a>(iarr, &amp;a, cmp);</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga8fb844f63ddda56260624756942d3e6e"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga8fb844f63ddda56260624756942d3e6e">eina_inarray_insert_sorted</a></div><div class="ttdeci">EINA_API int eina_inarray_insert_sorted(Eina_Inarray *array, const void *data, Eina_Compare_Cb compare)</div><div class="ttdoc">Copies the data to the array at a position found by the comparison function.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:475</div></div>
</div><!-- fragment --><p> We then print the size of our array, and the array itself, much like last time the values are not surprising, and neither should it be that the memory addresses are contiguous: </p><div class="fragment"><div class="line"> </div>
<div class="line">   printf(<span class="stringliteral">&quot;Inline array of integers with %d elements:\n&quot;</span>, <a class="code" href="group__Eina__Inline__Array__Group.html#ga63333e28eaa59cf00bc748b3df55bad7">eina_inarray_count</a>(iarr));</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga63333e28eaa59cf00bc748b3df55bad7"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga63333e28eaa59cf00bc748b3df55bad7">eina_inarray_count</a></div><div class="ttdeci">EINA_API unsigned int eina_inarray_count(const Eina_Inarray *array)</div><div class="ttdoc">Counts the number of members in an array.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:732</div></div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#gab6ffcad27b5099aa34af9ecd5e2b22f9">EINA_INARRAY_FOREACH</a>(iarr, b)</div>
<div class="line">     printf(<span class="stringliteral">&quot;int: %d(pointer: %p)\n&quot;</span>, *b, b);</div>
</div><!-- fragment --><p> Once done we free our array and shutdown eina: </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Eina__Inline__Array__Group.html#ga030924ac7ef1ce357b328e4a40e5f77f">eina_inarray_free</a>(iarr);</div>
<div class="line">   <a class="code" href="group__Eina__Main__Group.html#ga5bf35513199d5220341437c05696285d">eina_shutdown</a>();</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Eina__Inline__Array__Group_html_ga030924ac7ef1ce357b328e4a40e5f77f"><div class="ttname"><a href="group__Eina__Inline__Array__Group.html#ga030924ac7ef1ce357b328e4a40e5f77f">eina_inarray_free</a></div><div class="ttdeci">EINA_API void eina_inarray_free(Eina_Inarray *array)</div><div class="ttdoc">Frees an array and its members.</div><div class="ttdef"><b>Definition:</b> eina_inarray.c:355</div></div>
<div class="ttc" id="agroup__Eina__Main__Group_html_ga5bf35513199d5220341437c05696285d"><div class="ttname"><a href="group__Eina__Main__Group.html#ga5bf35513199d5220341437c05696285d">eina_shutdown</a></div><div class="ttdeci">EINA_API int eina_shutdown(void)</div><div class="ttdoc">Shuts down the Eina library.</div><div class="ttdef"><b>Definition:</b> eina_main.c:379</div></div>
</div><!-- fragment --><p> The source for this example: <a class="el" href="eina_inarray_01_c.html">eina_inarray_01.c</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:31</span>
  </p>
</div>
</body>
</html>
