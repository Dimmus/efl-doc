<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>$title</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="contents">
<div class="textblock"><p></p>
<p>This example shows some simple usage of ecore_pipe. We are going to create a pipe, fork our process, and then the child is going to communicate to the parent the result of its processing through the pipe.</p>
<p>As always we start with our includes, nothing special: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Ecore.h&gt;</span></div>
</div><!-- fragment --><p> The first thing we are going to define in our example is the function we are going to run on the child process, which, as mentioned, will do some processing and then will write the result to the pipe: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">do_lengthy_task(<a class="code" href="group__Ecore__Pipe__Group.html#ga0092a6b764881362d1a051d7af215b3f">Ecore_Pipe</a> *pipe)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">int</span> i, j;</div>
<div class="line">   <span class="keywordtype">char</span> *buffer;</div>
<div class="line">   <span class="keywordflow">for</span> (i = 0; i &lt; 20; i++)</div>
<div class="line">     {</div>
<div class="line">        sleep(1);</div>
<div class="line">        buffer = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * i);</div>
<div class="line">        <span class="keywordflow">for</span> (j = 0; j &lt; i; j++)</div>
<div class="line">          buffer[j] = <span class="charliteral">&#39;a&#39;</span> + j;</div>
<div class="line">        <a class="code" href="group__Ecore__Pipe__Group.html#ga5336bc71e829c391926c26750ae0f407">ecore_pipe_write</a>(pipe, buffer, i);</div>
<div class="line">        free(buffer);</div>
<div class="line">     }</div>
<div class="ttc" id="agroup__Ecore__Pipe__Group_html_ga0092a6b764881362d1a051d7af215b3f"><div class="ttname"><a href="group__Ecore__Pipe__Group.html#ga0092a6b764881362d1a051d7af215b3f">Ecore_Pipe</a></div><div class="ttdeci">struct _Ecore_Pipe Ecore_Pipe</div><div class="ttdoc">A handle for pipes.</div><div class="ttdef"><b>Definition:</b> Ecore_Common.h:2416</div></div>
<div class="ttc" id="agroup__Ecore__Pipe__Group_html_ga5336bc71e829c391926c26750ae0f407"><div class="ttname"><a href="group__Ecore__Pipe__Group.html#ga5336bc71e829c391926c26750ae0f407">ecore_pipe_write</a></div><div class="ttdeci">Eina_Bool ecore_pipe_write(Ecore_Pipe *p, const void *buffer, unsigned int nbytes)</div><div class="ttdoc">Writes on the file descriptor the data passed as parameter.</div><div class="ttdef"><b>Definition:</b> ecore_pipe.c:199</div></div>
<div class="line">   <a class="code" href="group__Ecore__Pipe__Group.html#ga5336bc71e829c391926c26750ae0f407">ecore_pipe_write</a>(pipe, <span class="stringliteral">&quot;close&quot;</span>, 5);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>The sleep was added so the parent process would think the child process was doing something interesting...</dd></dl>
<p>Next up is our function for handling data arriving in the pipe. It copies the data to another buffer, adds a terminating NULL and prints it. Also if it receives a certain string it stops the main loop(effectively ending the program): </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">handler(<span class="keywordtype">void</span> *data <a class="code" href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a>, <span class="keywordtype">void</span> *buf, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> len)</div>
<div class="line">{</div>
<div class="line">   <span class="keywordtype">char</span> *str = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * len + 1);</div>
<div class="line">   memcpy(str, buf, len);</div>
<div class="line">   str[len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">   printf(<span class="stringliteral">&quot;received %u bytes\n&quot;</span>, len);</div>
<div class="line">   printf(<span class="stringliteral">&quot;content: %s\n&quot;</span>, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)str);</div>
<div class="line">   free(str);</div>
<div class="line">   <span class="keywordflow">if</span> (len &amp;&amp; !strncmp(buf, <span class="stringliteral">&quot;close&quot;</span>, len &lt; 5 ? len : 5))</div>
<div class="line">     {</div>
<div class="line">        printf(<span class="stringliteral">&quot;close requested\n&quot;</span>);</div>
<div class="line">        <a class="code" href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a>();</div>
<div class="line">     }</div>
<div class="ttc" id="agroup__Ecore__Main__Loop__Group_html_ga95cf8e97dff0716433c2c5474d606a98"><div class="ttname"><a href="group__Ecore__Main__Loop__Group.html#ga95cf8e97dff0716433c2c5474d606a98">ecore_main_loop_quit</a></div><div class="ttdeci">void ecore_main_loop_quit(void)</div><div class="ttdoc">Quits the main loop once all the events currently on the queue have been processed.</div><div class="ttdef"><b>Definition:</b> ecore_main.c:1321</div></div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga82d751be730f849719ca292f9558be87"><div class="ttname"><a href="group__Eina__Types__Group.html#ga82d751be730f849719ca292f9558be87">EINA_UNUSED</a></div><div class="ttdeci">#define EINA_UNUSED</div><div class="ttdoc">Used to indicate that a function parameter is purposely unused.</div><div class="ttdef"><b>Definition:</b> eina_types.h:339</div></div>
<div class="line">}</div>
</div><!-- fragment --><p> And now on to our main function, we start by declaring some variables and initializing ecore: </p><div class="fragment"><div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group__Ecore__Pipe__Group.html#ga0092a6b764881362d1a051d7af215b3f">Ecore_Pipe</a> *pipe;</div>
<div class="line">   pid_t child_pid;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a>();</div>
<div class="ttc" id="agroup__Ecore__Init__Group_html_ga77757609684a2c922dc5ec398274751b"><div class="ttname"><a href="group__Ecore__Init__Group.html#ga77757609684a2c922dc5ec398274751b">ecore_init</a></div><div class="ttdeci">EAPI int ecore_init(void)</div><div class="ttdoc">Sets up connections, signal handlers, sockets etc.</div><div class="ttdef"><b>Definition:</b> ecore.c:230</div></div>
</div><!-- fragment --><p> And since we are talking about pipes let's create one: </p><div class="fragment"><div class="line"> </div>
<div class="line">   pipe = <a class="code" href="group__Ecore__Pipe__Group.html#ga3d584a8f962644f748dfd84d39d3421a">ecore_pipe_add</a>(handler, NULL);</div>
<div class="ttc" id="agroup__Ecore__Pipe__Group_html_ga3d584a8f962644f748dfd84d39d3421a"><div class="ttname"><a href="group__Ecore__Pipe__Group.html#ga3d584a8f962644f748dfd84d39d3421a">ecore_pipe_add</a></div><div class="ttdeci">Ecore_Pipe * ecore_pipe_add(Ecore_Pipe_Cb handler, const void *data)</div><div class="ttdoc">Creates two file descriptors (sockets on Windows).</div><div class="ttdef"><b>Definition:</b> ecore_pipe.c:93</div></div>
</div><!-- fragment --><p> Now we are going to fork: </p><div class="fragment"><div class="line"> </div>
<div class="line">   child_pid = fork();</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>duh...</dd></dl>
<p>The child process is going to do the our fancy processing: </p><div class="fragment"><div class="line">   <span class="keywordflow">if</span> (!child_pid)</div>
<div class="line">     {</div>
<div class="line">        <a class="code" href="group__Ecore__Pipe__Group.html#gab9df469d955d67dbcd95fd6f2dabdc79">ecore_pipe_read_close</a>(pipe);</div>
<div class="line">        do_lengthy_task(pipe);</div>
<div class="line">     }</div>
<div class="ttc" id="agroup__Ecore__Pipe__Group_html_gab9df469d955d67dbcd95fd6f2dabdc79"><div class="ttname"><a href="group__Ecore__Pipe__Group.html#gab9df469d955d67dbcd95fd6f2dabdc79">ecore_pipe_read_close</a></div><div class="ttdeci">void ecore_pipe_read_close(Ecore_Pipe *p)</div><div class="ttdoc">Closes the read end of an Ecore_Pipe object created with ecore_pipe_add().</div><div class="ttdef"><b>Definition:</b> ecore_pipe.c:108</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>It's very important to call <a class="el" href="group__Ecore__Pipe__Group.html#gab9df469d955d67dbcd95fd6f2dabdc79" title="Closes the read end of an Ecore_Pipe object created with ecore_pipe_add().">ecore_pipe_read_close()</a> here so that the child process won't read what it is writing to the pipe itself.</dd></dl>
<p>And the parent is going to run ecore's main loop waiting for some data: </p><div class="fragment"><div class="line">   <span class="keywordflow">else</span></div>
<div class="line">     {</div>
<div class="line">        <a class="code" href="group__Ecore__Pipe__Group.html#ga60099202e0880dd3de617ca14fa0c58b">ecore_pipe_write_close</a>(pipe);</div>
<div class="line">        <a class="code" href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a>();</div>
<div class="line">     }</div>
<div class="ttc" id="agroup__Ecore__Main__Loop__Group_html_gaf103b9f668bb3e4fed12e52c6180132d"><div class="ttname"><a href="group__Ecore__Main__Loop__Group.html#gaf103b9f668bb3e4fed12e52c6180132d">ecore_main_loop_begin</a></div><div class="ttdeci">void ecore_main_loop_begin(void)</div><div class="ttdoc">Runs the application main loop.</div><div class="ttdef"><b>Definition:</b> ecore_main.c:1311</div></div>
<div class="ttc" id="agroup__Ecore__Pipe__Group_html_ga60099202e0880dd3de617ca14fa0c58b"><div class="ttname"><a href="group__Ecore__Pipe__Group.html#ga60099202e0880dd3de617ca14fa0c58b">ecore_pipe_write_close</a></div><div class="ttdeci">void ecore_pipe_write_close(Ecore_Pipe *p)</div><div class="ttdoc">Closes the write end of an Ecore_Pipe object created with ecore_pipe_add().</div><div class="ttdef"><b>Definition:</b> ecore_pipe.c:176</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>Calling <a class="el" href="group__Ecore__Pipe__Group.html#ga60099202e0880dd3de617ca14fa0c58b" title="Closes the write end of an Ecore_Pipe object created with ecore_pipe_add().">ecore_pipe_write_close()</a> here isn't important but since we aren't going to write in the pipe it is good practice.</dd></dl>
<p>And finally when done processing(the child) or done receiving(the parent) we delete the pipe and shutdown ecore: </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Ecore__Pipe__Group.html#ga7ed5669e83a3119d2023c64288f9af60">ecore_pipe_del</a>(pipe);</div>
<div class="line">   <a class="code" href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a>();</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__Ecore__Init__Group_html_ga768298b932f18d7e7593a447493e5cde"><div class="ttname"><a href="group__Ecore__Init__Group.html#ga768298b932f18d7e7593a447493e5cde">ecore_shutdown</a></div><div class="ttdeci">EAPI int ecore_shutdown(void)</div><div class="ttdoc">Shuts down connections, signal handlers sockets etc.</div><div class="ttdef"><b>Definition:</b> ecore.c:371</div></div>
<div class="ttc" id="agroup__Ecore__Pipe__Group_html_ga7ed5669e83a3119d2023c64288f9af60"><div class="ttname"><a href="group__Ecore__Pipe__Group.html#ga7ed5669e83a3119d2023c64288f9af60">ecore_pipe_del</a></div><div class="ttdeci">void * ecore_pipe_del(Ecore_Pipe *p)</div><div class="ttdoc">Frees an Ecore_Pipe object created with ecore_pipe_add().</div><div class="ttdef"><b>Definition:</b> ecore_pipe.c:100</div></div>
</div><!-- fragment --></div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:35</span>
  </p>
</div>
</body>
</html>
