<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>EPhysics - Collision Detection</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">EPhysics - Collision Detection </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The purpose of this example is to demonstrate the EPhysics Collision Detection usage - The code adds two balls, one with impulse and the second with a collision detection callback, to show an effect.</p>
<div class="image">
<img src="collision_detection.png" alt=""/>
</div>
 <p>For this example we'll have an EPhysics_World, and two basic EPhysics_Bodys, we'll apply an impulse in one of then and the other will be stopped "waiting" for a collision.</p>
<p>The basic concepts like - initializing an EPhysics_World, render geometry, physics limiting boundaries, add an Ephysics_Body, associate it to evas objects, change restitution, friction and impulse properties, were already covered in <a class="el" href="tutorial_ephysics_bouncing_ball.html">EPhysics - Bouncing Ball</a></p>
<h1><a class="anchor" id="add-collstruct"></a>
Collision Data Struct</h1>
<p></p>
<p>While in this example we'll be working with a struct to hold some objects in our code. For clarity sake we present you the struct declaration in the following block.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>_Collision_Data {</div>
<div class="line">     Test_Data base;</div>
<div class="line">     <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *impact;</div>
<div class="line">     <a class="code" href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a> *sphere;</div>
<div class="line">     <a class="code" href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a> *sphere2;</div>
<div class="line">};</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gaf39ad724f8a2f81f9139c63263900bf1"><div class="ttname"><a href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a></div><div class="ttdeci">struct _EPhysics_Body EPhysics_Body</div><div class="ttdoc">Body handle, represents an object on EPhysics world.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:655</div></div>
<div class="ttc" id="agroup__Evas__Object__Group_html_ga9e19e6dd1f517a0ba437c0114d3e7c97"><div class="ttname"><a href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a></div><div class="ttdeci">Efl_Canvas_Object Evas_Object</div><div class="ttdoc">An Evas Object handle.</div><div class="ttdef"><b>Definition:</b> Evas_Common.h:185</div></div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md11"></a>
Adding the Callback</h1>
<p>Calling <a class="el" href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067" title="Register a callback to a type of physics body event.">ephysics_body_event_callback_add()</a> will register a callback to a type of physics body event.</p>
<p><a class="el" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277caa002e2d26e86261221dc643f19071754">EPHYSICS_CALLBACK_BODY_COLLISION</a> : called just after the collision has been actually processed by the physics engine. In other words, to be notified about a collision between two physical bodies.</p>
<div class="fragment"><div class="line">   <a class="code" href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067">ephysics_body_event_callback_add</a>(collision_data-&gt;sphere,</div>
<div class="line">                                    <a class="code" href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277caa002e2d26e86261221dc643f19071754">EPHYSICS_CALLBACK_BODY_COLLISION</a>,</div>
<div class="line">                                    _collision_cb, collision_data);</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gada176f4748a4c2fc4ba2042021ea7067"><div class="ttname"><a href="group__EPhysics__Body.html#gada176f4748a4c2fc4ba2042021ea7067">ephysics_body_event_callback_add</a></div><div class="ttdeci">EAPI void ephysics_body_event_callback_add(EPhysics_Body *body, EPhysics_Callback_Body_Type type, EPhysics_Body_Event_Cb func, const void *data)</div><div class="ttdoc">Register a callback to a type of physics body event.</div></div>
<div class="ttc" id="agroup__EPhysics__Body_html_gga904d0d1462e71c1f32cb27f540b5277caa002e2d26e86261221dc643f19071754"><div class="ttname"><a href="group__EPhysics__Body.html#gga904d0d1462e71c1f32cb27f540b5277caa002e2d26e86261221dc643f19071754">EPHYSICS_CALLBACK_BODY_COLLISION</a></div><div class="ttdeci">@ EPHYSICS_CALLBACK_BODY_COLLISION</div><div class="ttdoc">Body collided with other body.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:2264</div></div>
</div><!-- fragment --><p> See <a class="el" href="group__EPhysics__Body.html#ga904d0d1462e71c1f32cb27f540b5277c">_EPhysics_Callback_Body_Type</a> for more event types.</p>
<h1><a class="anchor" id="add-collcb"></a>
Collision Function</h1>
<p>The callback function will filter the collision to be sure if that body is which we want and then show the effect.</p>
<p>First we need to create a specific variable type to get collision infos: <a class="el" href="group__EPhysics__Body.html#ga454052288e957641ff40f79ca3c72792">EPhysics_Body_Collision</a></p>
<p></p>
<div class="fragment"><div class="line">_collision_cb(<span class="keywordtype">void</span> *data, <a class="code" href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a> *body __UNUSED__, <span class="keywordtype">void</span> *event_info)</div>
<div class="line">{</div>
<div class="line">   <a class="code" href="group__EPhysics__Body.html#gaf39ad724f8a2f81f9139c63263900bf1">EPhysics_Body</a> *contact_body;</div>
<div class="line">   Collision_Data *collision_data = data;</div>
<div class="line">   <a class="code" href="group__EPhysics__Body.html#ga454052288e957641ff40f79ca3c72792">EPhysics_Body_Collision</a> *collision = event_info;</div>
<div class="line">   <span class="keywordtype">int</span> x, y, z;</div>
<div class="ttc" id="agroup__EPhysics__Body_html_ga454052288e957641ff40f79ca3c72792"><div class="ttname"><a href="group__EPhysics__Body.html#ga454052288e957641ff40f79ca3c72792">EPhysics_Body_Collision</a></div><div class="ttdeci">struct _EPhysics_Body_Collision EPhysics_Body_Collision</div><div class="ttdoc">Body collision wraps collision informations.</div><div class="ttdef"><b>Definition:</b> EPhysics.h:2247</div></div>
</div><!-- fragment --><p> Now we want to know which body collides with and filter it.</p>
<div class="fragment"><div class="line">   contact_body = <a class="code" href="group__EPhysics__Body.html#gae94b1bd402657e11208cc90c5c3bbba4">ephysics_body_collision_contact_body_get</a>(collision);</div>
<div class="line">   <span class="keywordflow">if</span> (contact_body != collision_data-&gt;sphere2) <span class="keywordflow">return</span>;</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gae94b1bd402657e11208cc90c5c3bbba4"><div class="ttname"><a href="group__EPhysics__Body.html#gae94b1bd402657e11208cc90c5c3bbba4">ephysics_body_collision_contact_body_get</a></div><div class="ttdeci">EAPI EPhysics_Body * ephysics_body_collision_contact_body_get(const EPhysics_Body_Collision *collision)</div><div class="ttdoc">Get the body's collision contact body.</div></div>
</div><!-- fragment --><p> We just get the collision position, move the impact effect to this coordinate and send a signal to edje to show it.</p>
<div class="fragment"><div class="line">   <a class="code" href="group__EPhysics__Body.html#gabcbb3bd68d47bb0fdf071bb022763d58">ephysics_body_collision_position_get</a>(collision, &amp;x, &amp;y, &amp;z);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#ga335c8ee6eaeaac9710656af4f8b0db91">evas_object_move</a>(collision_data-&gt;impact, x - 10, y - 40);</div>
<div class="line">   <a class="code" href="group__Elm__General.html#ga1beada7edf5d714c0dba5459bcc993fc">elm_object_signal_emit</a>(collision_data-&gt;impact, <span class="stringliteral">&quot;impact,show&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;ephysics_test&quot;</span>);</div>
<div class="ttc" id="agroup__EPhysics__Body_html_gabcbb3bd68d47bb0fdf071bb022763d58"><div class="ttname"><a href="group__EPhysics__Body.html#gabcbb3bd68d47bb0fdf071bb022763d58">ephysics_body_collision_position_get</a></div><div class="ttdeci">EAPI void ephysics_body_collision_position_get(const EPhysics_Body_Collision *collision, Evas_Coord *x, Evas_Coord *y, Evas_Coord *z)</div><div class="ttdoc">Get the position(x, y) of a body's collision.</div></div>
<div class="ttc" id="agroup__Elm__General_html_ga1beada7edf5d714c0dba5459bcc993fc"><div class="ttname"><a href="group__Elm__General.html#ga1beada7edf5d714c0dba5459bcc993fc">elm_object_signal_emit</a></div><div class="ttdeci">void elm_object_signal_emit(Evas_Object *obj, const char *emission, const char *source)</div><div class="ttdoc">Send a signal to the widget edje object.</div><div class="ttdef"><b>Definition:</b> elm_main.c:1854</div></div>
<div class="ttc" id="agroup__Evas__Object__Group_html_ga335c8ee6eaeaac9710656af4f8b0db91"><div class="ttname"><a href="group__Evas__Object__Group.html#ga335c8ee6eaeaac9710656af4f8b0db91">evas_object_move</a></div><div class="ttdeci">EVAS_API void evas_object_move(Evas_Object *obj, Evas_Coord x, Evas_Coord y)</div><div class="ttdoc">Move the given Evas object to the given location inside its canvas' viewport.</div><div class="ttdef"><b>Definition:</b> evas_object_main.c:1171</div></div>
<div class="line">}</div>
</div><!-- fragment --><p> Here we finish the example. The full source code can be found at <a class="el" href="test_collision_detection_c.html">test_collision_detection.c</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:39</span>
  </p>
</div>
</body>
</html>
