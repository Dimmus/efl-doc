<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>Evas Map - Overview</title>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110876574-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-110876574-1');
  </script>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel="icon" href="favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.png" type="image/x-icon">
  <link rel="icon" href="favicon.png" type="image/ico">
  <link rel="shortcut icon" href="favicon.png" type="image/ico">
  <link rel="stylesheet" type="text/css" href="e.css">
</head>
<body>
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Evas Map - Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p></p>
<p>Down to the very bottom, Map is simple: it takes an object and transforms the way it will be shown on screen. But using it properly can be a bit troublesome.</p>
<p>For the most common operations there are utility functions that help in setting up the map to achieve the desired effects. Now we'll go through an overview of the map API and some of the things that can be done with it.</p>
<p>The full code can be found <a class="el" href="evas-map-utils_8c-example.html">here</a>.</p>
<p>To show how some functions work, this example listens to keys pressed to toggle several options. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line">{</div>
<div class="line">   Ecore_Evas *ee;</div>
<div class="line">   <a class="code" href="group__Evas__Canvas.html#ga5ff87cc4ce6bc43e3b640a6d37f73043">Evas</a>       *canvas;</div>
<div class="line">   <span class="keyword">struct </span>{</div>
<div class="line">        <span class="keywordtype">int</span> r, g, b, a;</div>
<div class="line">   } colors[6];</div>
<div class="line">   <span class="keywordtype">int</span> colors_index;</div>
<div class="line">   <span class="keywordtype">int</span> frame;</div>
<div class="line">   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>   alpha : 1;</div>
<div class="line">   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>   smooth : 1;</div>
<div class="line">   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>   backface_culling : 1;</div>
<div class="line">   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>   apply_perspective : 1;</div>
<div class="line">   <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a>   apply_lighting : 1;</div>
<div class="line">} App_Data;</div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga3fe0caf72e93b1bab1ca8ee3ccf3f226"><div class="ttname"><a href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div><div class="ttdeci">unsigned char Eina_Bool</div><div class="ttdoc">Type to mimic a boolean.</div><div class="ttdef"><b>Definition:</b> eina_types.h:527</div></div>
<div class="ttc" id="agroup__Evas__Canvas_html_ga5ff87cc4ce6bc43e3b640a6d37f73043"><div class="ttname"><a href="group__Evas__Canvas.html#ga5ff87cc4ce6bc43e3b640a6d37f73043">Evas</a></div><div class="ttdeci">Eo Evas</div><div class="ttdoc">An opaque handle to an Evas canvas.</div><div class="ttdef"><b>Definition:</b> Evas_Common.h:163</div></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *img1_path = PACKAGE_EXAMPLES_DIR EVAS_IMAGE_FOLDER <span class="stringliteral">&quot;/cube1.png&quot;</span>;</div>
</div><!-- fragment --><p> In this program, we divide the window in four quadrants, each holding an object that will have different map configurations applied to them in each call to an animator function. </p><div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code" href="group__Eina__Types__Group.html#ga3fe0caf72e93b1bab1ca8ee3ccf3f226">Eina_Bool</a></div>
<div class="line">_anim_cb(<span class="keywordtype">void</span> *data)</div>
<div class="line">{</div>
<div class="line">   App_Data *ad = data;</div>
<div class="line">   Evas_Map *m;</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a> *o;</div>
<div class="line">   <span class="keywordtype">int</span> r, g, b, a;</div>
<div class="line">   <span class="keywordtype">int</span> win_w, win_h, img_w, img_h;</div>
<div class="line">   <a class="code" href="Evas__Common_8h.html#a2453e92182bad3b0e0d84e5aff433b07">Evas_Coord</a> x, y, w, h;</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Evas__Canvas.html#ga9db9974a647850d7bd49afb506c9717a">evas_output_size_get</a>(ad-&gt;canvas, &amp;win_w, &amp;win_h);</div>
<div class="ttc" id="aEvas__Common_8h_html_a2453e92182bad3b0e0d84e5aff433b07"><div class="ttname"><a href="Evas__Common_8h.html#a2453e92182bad3b0e0d84e5aff433b07">Evas_Coord</a></div><div class="ttdeci">int Evas_Coord</div><div class="ttdoc">Type used for coordinates (in pixels, int).</div><div class="ttdef"><b>Definition:</b> Evas_Common.h:116</div></div>
<div class="ttc" id="agroup__Evas__Canvas_html_ga9db9974a647850d7bd49afb506c9717a"><div class="ttname"><a href="group__Evas__Canvas.html#ga9db9974a647850d7bd49afb506c9717a">evas_output_size_get</a></div><div class="ttdeci">EVAS_API void evas_output_size_get(const Evas *eo_e, int *w, int *h)</div><div class="ttdoc">Retrieve the output size of the render engine of the given evas.</div><div class="ttdef"><b>Definition:</b> evas_main.c:1402</div></div>
<div class="ttc" id="agroup__Evas__Object__Group_html_ga9e19e6dd1f517a0ba437c0114d3e7c97"><div class="ttname"><a href="group__Evas__Object__Group.html#ga9e19e6dd1f517a0ba437c0114d3e7c97">Evas_Object</a></div><div class="ttdeci">Efl_Canvas_Object Evas_Object</div><div class="ttdoc">An Evas Object handle.</div><div class="ttdef"><b>Definition:</b> Evas_Common.h:185</div></div>
</div><!-- fragment --><p> Let's first create a map and set some of our options to it. Only four points maps are supported, so we'll stick to that magic number. We can set a color for each vertex or apply one for all of them at once </p><div class="fragment"><div class="line"> </div>
<div class="line">   m = <a class="code" href="group__Evas__Object__Group__Map.html#gaac896c35c20ac4e41c9cab08256df880">evas_map_new</a>(4);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga7899c76876aff4594596df069d68b637">evas_map_smooth_set</a>(m, ad-&gt;smooth);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga1be766cd6c3f6f637973c93da5b834f3">evas_map_alpha_set</a>(m, ad-&gt;alpha);</div>
<div class="line"> </div>
<div class="line">   r = ad-&gt;colors[ad-&gt;colors_index].r;</div>
<div class="line">   g = ad-&gt;colors[ad-&gt;colors_index].g;</div>
<div class="line">   b = ad-&gt;colors[ad-&gt;colors_index].b;</div>
<div class="line">   a = ad-&gt;colors[ad-&gt;colors_index].a;</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac722b2b4b2673c8b6cfac99512105275">evas_map_util_points_color_set</a>(m, r, g, b, a);</div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga1be766cd6c3f6f637973c93da5b834f3"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga1be766cd6c3f6f637973c93da5b834f3">evas_map_alpha_set</a></div><div class="ttdeci">EVAS_API void evas_map_alpha_set(Evas_Map *m, Eina_Bool enabled)</div><div class="ttdoc">Set the alpha flag for map rendering.</div><div class="ttdef"><b>Definition:</b> evas_map.c:690</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga7899c76876aff4594596df069d68b637"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga7899c76876aff4594596df069d68b637">evas_map_smooth_set</a></div><div class="ttdeci">EVAS_API void evas_map_smooth_set(Evas_Map *m, Eina_Bool enabled)</div><div class="ttdoc">Set the smoothing for map rendering.</div><div class="ttdef"><b>Definition:</b> evas_map.c:670</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_gaac896c35c20ac4e41c9cab08256df880"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#gaac896c35c20ac4e41c9cab08256df880">evas_map_new</a></div><div class="ttdeci">EVAS_API Evas_Map * evas_map_new(int count)</div><div class="ttdoc">Create map of transformation points to be later used with an Evas object.</div><div class="ttdef"><b>Definition:</b> evas_map.c:658</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_gac722b2b4b2673c8b6cfac99512105275"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#gac722b2b4b2673c8b6cfac99512105275">evas_map_util_points_color_set</a></div><div class="ttdeci">EVAS_API void evas_map_util_points_color_set(Evas_Map *m, int r, int g, int b, int a)</div><div class="ttdoc">Set color of all points to given color.</div><div class="ttdef"><b>Definition:</b> evas_map.c:922</div></div>
</div><!-- fragment --><p> For the first object, we'll have a plain rectangle. At its creation, this rectangle was set to be semi-transparent, but whether its own alpha is used will be defined by the map's alpha setting. If the map's alpha is disabled, then the object will be completely opaque. The map's own color, however, will use any alpha set to it.</p>
<p>So we get our object, initialize our map geometry to match the rectangle and make it rotate around its own center, then apply the map to the object so it takes effect. </p><div class="fragment"><div class="line"> </div>
<div class="line">   o = <a class="code" href="group__Evas__Canvas.html#ga4947f6e27a25f31ba3a5dbf84cecf2a8">evas_object_name_find</a>(ad-&gt;canvas, <span class="stringliteral">&quot;obj1&quot;</span>);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Basic.html#ga6e8e78e110392480dd612df86a16b630">evas_object_geometry_get</a>(o, &amp;x, &amp;y, &amp;w, &amp;h);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gaa7f9acff0a474fbd529f3ecbc2727a6b">evas_map_util_points_populate_from_object</a>(m, o);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga1833b01762fdfd6be0d356aa94a3aa1c">evas_map_util_rotate</a>(m, 3 * ad-&gt;frame, x + (w / 2), y + (h / 2));</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#gadbb970a1e0da91183bab3af1eb276953">evas_object_map_set</a>(o, m);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#gafca4ed9f6cb6063ff7e8d9193418129e">evas_object_map_enable_set</a>(o, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);</div>
<div class="ttc" id="agroup__Eina__Types__Group_html_ga05c12dacc8b4058994df842b41be85fc"><div class="ttname"><a href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a></div><div class="ttdeci">#define EINA_TRUE</div><div class="ttdoc">boolean value TRUE (numerical value 1)</div><div class="ttdef"><b>Definition:</b> eina_types.h:539</div></div>
<div class="ttc" id="agroup__Evas__Canvas_html_ga4947f6e27a25f31ba3a5dbf84cecf2a8"><div class="ttname"><a href="group__Evas__Canvas.html#ga4947f6e27a25f31ba3a5dbf84cecf2a8">evas_object_name_find</a></div><div class="ttdeci">EVAS_API Efl_Canvas_Object * evas_object_name_find(const Evas_Canvas *obj, const char *name)</div><div class="ttdoc">Retrieves the object on the given evas with the given name.</div><div class="ttdef"><b>Definition:</b> evas_canvas_eo.legacy.c:243</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Basic_html_ga6e8e78e110392480dd612df86a16b630"><div class="ttname"><a href="group__Evas__Object__Group__Basic.html#ga6e8e78e110392480dd612df86a16b630">evas_object_geometry_get</a></div><div class="ttdeci">EVAS_API void evas_object_geometry_get(const Evas_Object *eo_obj, Evas_Coord *x, Evas_Coord *y, Evas_Coord *w, Evas_Coord *h)</div><div class="ttdoc">Retrieves the position and (rectangular) size of the given Evas object.</div><div class="ttdef"><b>Definition:</b> evas_object_main.c:1335</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga1833b01762fdfd6be0d356aa94a3aa1c"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga1833b01762fdfd6be0d356aa94a3aa1c">evas_map_util_rotate</a></div><div class="ttdeci">EVAS_API void evas_map_util_rotate(Evas_Map *m, double degrees, Evas_Coord cx, Evas_Coord cy)</div><div class="ttdoc">Change the map to apply the given rotation.</div><div class="ttdef"><b>Definition:</b> evas_map.c:968</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_gaa7f9acff0a474fbd529f3ecbc2727a6b"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#gaa7f9acff0a474fbd529f3ecbc2727a6b">evas_map_util_points_populate_from_object</a></div><div class="ttdeci">EVAS_API void evas_map_util_points_populate_from_object(Evas_Map *m, const Evas_Object *eo_obj)</div><div class="ttdoc">Populate source and destination map points to match exactly object.</div><div class="ttdef"><b>Definition:</b> evas_map.c:885</div></div>
<div class="ttc" id="agroup__Evas__Object__Group_html_gadbb970a1e0da91183bab3af1eb276953"><div class="ttname"><a href="group__Evas__Object__Group.html#gadbb970a1e0da91183bab3af1eb276953">evas_object_map_set</a></div><div class="ttdeci">EVAS_API void evas_object_map_set(Evas_Object *eo_obj, const Evas_Map *map)</div><div class="ttdoc">Set current object transformation map.</div><div class="ttdef"><b>Definition:</b> evas_map.c:532</div></div>
<div class="ttc" id="agroup__Evas__Object__Group_html_gafca4ed9f6cb6063ff7e8d9193418129e"><div class="ttname"><a href="group__Evas__Object__Group.html#gafca4ed9f6cb6063ff7e8d9193418129e">evas_object_map_enable_set</a></div><div class="ttdeci">EVAS_API void evas_object_map_enable_set(Eo *eo_obj, Eina_Bool enabled)</div><div class="ttdoc">Enable or disable the map that is set.</div><div class="ttdef"><b>Definition:</b> evas_map.c:516</div></div>
</div><!-- fragment --><p> The second object is an image. Here we don't have any color set for the object, but the image itself contains an alpha channel that will not be affected by the map settings, so even with alpha set to be off, the image will still be transparent. Color applied to the map will tint it though. Since setting a map copies it into the object, we can reuse the same one we created before. We initialize it to the new object while all other options are kept the same. Notice that no rotation will be done here, as that's just an utility function that takes the coordinates set for each point of the map and transforms it accordingly. </p><div class="fragment"><div class="line"> </div>
<div class="line">   o = <a class="code" href="group__Evas__Canvas.html#ga4947f6e27a25f31ba3a5dbf84cecf2a8">evas_object_name_find</a>(ad-&gt;canvas, <span class="stringliteral">&quot;obj2&quot;</span>);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Basic.html#ga6e8e78e110392480dd612df86a16b630">evas_object_geometry_get</a>(o, &amp;x, &amp;y, &amp;w, &amp;h);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Image.html#ga29401fb02f1d51ddf09d195f10a004e7">evas_object_image_size_get</a>(o, &amp;img_w, &amp;img_h);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gadb6af35fdb37ea54ff6d79faddbd2c19">evas_map_util_points_populate_from_object_full</a>(m, o, 100);</div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_gadb6af35fdb37ea54ff6d79faddbd2c19"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#gadb6af35fdb37ea54ff6d79faddbd2c19">evas_map_util_points_populate_from_object_full</a></div><div class="ttdeci">EVAS_API void evas_map_util_points_populate_from_object_full(Evas_Map *m, const Evas_Object *eo_obj, Evas_Coord z)</div><div class="ttdoc">Populate source and destination map points to match exactly object.</div><div class="ttdef"><b>Definition:</b> evas_map.c:863</div></div>
<div class="ttc" id="agroup__Evas__Object__Image_html_ga29401fb02f1d51ddf09d195f10a004e7"><div class="ttname"><a href="group__Evas__Object__Image.html#ga29401fb02f1d51ddf09d195f10a004e7">evas_object_image_size_get</a></div><div class="ttdeci">EVAS_API void evas_object_image_size_get(const Evas_Object *obj, int *w, int *h)</div><div class="ttdoc">Retrieves the size of the given image object.</div><div class="ttdef"><b>Definition:</b> evas_image_legacy.c:159</div></div>
</div><!-- fragment --><p> This time the object is a bit farther into the screen, by using a <code>z</code> value higher than 0 to init the map. We also need to map the image used by the object, so Evas knows how to transform it properly. For this we use the <a class="el" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6" title="Change the map point&#39;s U and V texture source point.">evas_map_point_image_uv_set()</a> to tell the map what coordinate within the image corresponds to each point of the map. </p><div class="fragment"><div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 0, 0, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 1, img_w, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 2, img_w, img_h);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 3, 0, img_h);</div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_gac20df50c88ca79bc8ffaefb6a2265dd6"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a></div><div class="ttdeci">EVAS_API void evas_map_point_image_uv_set(Evas_Map *m, int idx, double u, double v)</div><div class="ttdoc">Change the map point's U and V texture source point.</div><div class="ttdef"><b>Definition:</b> evas_map.c:787</div></div>
</div><!-- fragment --><p> This object will also be rotated, but in all three axis and around some other point, not its center, chosen mostly at random. If enabled, lighting will be applied to, from a light source at the center of the window. </p><div class="fragment"><div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga7fc91b978232af55383baa7eb5ff7037">evas_map_util_3d_rotate</a>(m, ad-&gt;frame * 6, ad-&gt;frame * 6, ad-&gt;frame * 6,</div>
<div class="line">                           x + (w / 3), y + 10, 0);</div>
<div class="line">   <span class="keywordflow">if</span> (ad-&gt;apply_lighting)</div>
<div class="line">     <a class="code" href="group__Evas__Object__Group__Map.html#ga27cc3c160ce2273889026ce58e32e503">evas_map_util_3d_lighting</a>(m, win_w / 2, win_h / 2, -100,</div>
<div class="line">                               255, 255, 255, 0, 0, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#gadbb970a1e0da91183bab3af1eb276953">evas_object_map_set</a>(o, m);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#gafca4ed9f6cb6063ff7e8d9193418129e">evas_object_map_enable_set</a>(o, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);</div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga27cc3c160ce2273889026ce58e32e503"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga27cc3c160ce2273889026ce58e32e503">evas_map_util_3d_lighting</a></div><div class="ttdeci">EVAS_API void evas_map_util_3d_lighting(Evas_Map *m, Evas_Coord lx, Evas_Coord ly, Evas_Coord lz, int lr, int lg, int lb, int ar, int ag, int ab)</div><div class="ttdoc">Perform lighting calculations on the given Map.</div><div class="ttdef"><b>Definition:</b> evas_map.c:1215</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga7fc91b978232af55383baa7eb5ff7037"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga7fc91b978232af55383baa7eb5ff7037">evas_map_util_3d_rotate</a></div><div class="ttdeci">EVAS_API void evas_map_util_3d_rotate(Evas_Map *m, double dx, double dy, double dz, Evas_Coord cx, Evas_Coord cy, Evas_Coord cz)</div><div class="ttdoc">Rotate the map around 3 axes in 3D.</div><div class="ttdef"><b>Definition:</b> evas_map.c:1077</div></div>
</div><!-- fragment --><p> For the third object we are doing, once more, a 3D rotation, but this time perspective will be applied to our map to make it look more realistic. The lighting source also follows the mouse cursor and it's possible to toggle backface culling, so that the object is hidden whenever we are not seeing its front face. </p><div class="fragment"><div class="line"> </div>
<div class="line">   o = <a class="code" href="group__Evas__Canvas.html#ga4947f6e27a25f31ba3a5dbf84cecf2a8">evas_object_name_find</a>(ad-&gt;canvas, <span class="stringliteral">&quot;obj3&quot;</span>);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Basic.html#ga6e8e78e110392480dd612df86a16b630">evas_object_geometry_get</a>(o, &amp;x, &amp;y, &amp;w, &amp;h);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Image.html#ga29401fb02f1d51ddf09d195f10a004e7">evas_object_image_size_get</a>(o, &amp;img_w, &amp;img_h);</div>
<div class="line"> </div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga769e1ce26efed137c96bc6983f318439">evas_map_util_points_populate_from_geometry</a>(m, x, y + (h / 2), w, h, -20);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 0, 0, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 1, img_w, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 2, img_w, img_h);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 3, 0, img_h);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga7fc91b978232af55383baa7eb5ff7037">evas_map_util_3d_rotate</a>(m, 20, ad-&gt;frame * 6, 0,</div>
<div class="line">                           x + (w / 2), y + (w / 2), w / 2);</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">if</span> (ad-&gt;apply_perspective)</div>
<div class="line">     <a class="code" href="group__Evas__Object__Group__Map.html#gaeaab7b6cc857d5b3e3a99b8c0efbab11">evas_map_util_3d_perspective</a>(m, x + (w / 2), y + (h / 2), 0, 256);</div>
<div class="line">   <span class="keywordflow">if</span> (ad-&gt;apply_lighting)</div>
<div class="line">     {</div>
<div class="line">        <a class="code" href="Evas__Common_8h.html#a2453e92182bad3b0e0d84e5aff433b07">Evas_Coord</a> mx, my;</div>
<div class="line">        <a class="code" href="group__Evas__Canvas.html#ga78be2fedcc19c00c61ad8df95f2496f8">evas_pointer_canvas_xy_get</a>(ad-&gt;canvas, &amp;mx, &amp;my);</div>
<div class="line">        <a class="code" href="group__Evas__Object__Group__Map.html#ga27cc3c160ce2273889026ce58e32e503">evas_map_util_3d_lighting</a>(m, mx, my, -256,</div>
<div class="line">                                  255, 255, 255, 0, 0, 0);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">if</span> (ad-&gt;backface_culling)</div>
<div class="line">     {</div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="group__Evas__Object__Group__Map.html#ga2fbfe112be2246ec4e0cb49f4e38088a">evas_map_util_clockwise_get</a>(m))</div>
<div class="line">          <a class="code" href="group__Evas__Object__Group__Basic.html#ga07208fcafd4739de606bc35fff684bf5">evas_object_show</a>(o);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">          <a class="code" href="group__Evas__Object__Group__Basic.html#gae66f71e09a0dc71675f15ebff6765c64">evas_object_hide</a>(o);</div>
<div class="line">     }</div>
<div class="line">   <span class="keywordflow">else</span></div>
<div class="line">     <a class="code" href="group__Evas__Object__Group__Basic.html#ga07208fcafd4739de606bc35fff684bf5">evas_object_show</a>(o);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#gadbb970a1e0da91183bab3af1eb276953">evas_object_map_set</a>(o, m);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#gafca4ed9f6cb6063ff7e8d9193418129e">evas_object_map_enable_set</a>(o, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);</div>
<div class="ttc" id="agroup__Evas__Canvas_html_ga78be2fedcc19c00c61ad8df95f2496f8"><div class="ttname"><a href="group__Evas__Canvas.html#ga78be2fedcc19c00c61ad8df95f2496f8">evas_pointer_canvas_xy_get</a></div><div class="ttdeci">EVAS_API void evas_pointer_canvas_xy_get(const Evas_Canvas *obj, int *x, int *y)</div><div class="ttdoc">This function returns the current known default pointer coordinates.</div><div class="ttdef"><b>Definition:</b> evas_canvas_eo.legacy.c:75</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Basic_html_ga07208fcafd4739de606bc35fff684bf5"><div class="ttname"><a href="group__Evas__Object__Group__Basic.html#ga07208fcafd4739de606bc35fff684bf5">evas_object_show</a></div><div class="ttdeci">EVAS_API void evas_object_show(Evas_Object *eo_obj)</div><div class="ttdoc">Makes the given Evas object visible.</div><div class="ttdef"><b>Definition:</b> evas_object_main.c:1814</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Basic_html_gae66f71e09a0dc71675f15ebff6765c64"><div class="ttname"><a href="group__Evas__Object__Group__Basic.html#gae66f71e09a0dc71675f15ebff6765c64">evas_object_hide</a></div><div class="ttdeci">EVAS_API void evas_object_hide(Evas_Object *eo_obj)</div><div class="ttdoc">Makes the given Evas object invisible.</div><div class="ttdef"><b>Definition:</b> evas_object_main.c:1823</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga2fbfe112be2246ec4e0cb49f4e38088a"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga2fbfe112be2246ec4e0cb49f4e38088a">evas_map_util_clockwise_get</a></div><div class="ttdeci">EVAS_API Eina_Bool evas_map_util_clockwise_get(Evas_Map *m)</div><div class="ttdoc">Get the clockwise state of a map.</div><div class="ttdef"><b>Definition:</b> evas_map.c:1275</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga769e1ce26efed137c96bc6983f318439"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga769e1ce26efed137c96bc6983f318439">evas_map_util_points_populate_from_geometry</a></div><div class="ttdeci">EVAS_API void evas_map_util_points_populate_from_geometry(Evas_Map *m, Evas_Coord x, Evas_Coord y, Evas_Coord w, Evas_Coord h, Evas_Coord z)</div><div class="ttdoc">Populate source and destination map points to match given geometry.</div><div class="ttdef"><b>Definition:</b> evas_map.c:907</div></div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_gaeaab7b6cc857d5b3e3a99b8c0efbab11"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#gaeaab7b6cc857d5b3e3a99b8c0efbab11">evas_map_util_3d_perspective</a></div><div class="ttdeci">EVAS_API void evas_map_util_3d_perspective(Evas_Map *m, Evas_Coord px, Evas_Coord py, Evas_Coord z0, Evas_Coord foc)</div><div class="ttdoc">Apply a perspective transform to the map.</div><div class="ttdef"><b>Definition:</b> evas_map.c:1263</div></div>
</div><!-- fragment --><p> And we free this map, since we messed too much with it and for the last object we want something cleaner. </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga219c74ba8e2a4ae4525d2f331b8b5e0a">evas_map_free</a>(m);</div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga219c74ba8e2a4ae4525d2f331b8b5e0a"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga219c74ba8e2a4ae4525d2f331b8b5e0a">evas_map_free</a></div><div class="ttdeci">EVAS_API void evas_map_free(Evas_Map *m)</div><div class="ttdoc">Free a previously allocated map.</div><div class="ttdef"><b>Definition:</b> evas_map.c:745</div></div>
</div><!-- fragment --><p> The last object is actually two. One image, with an image set to it, and one image proxying the first one with <a class="el" href="group__Evas__Object__Image.html#ga58b0ba36355fe0cfb49a6aaa819e2aa4" title="Set the source object on an image object to used as a proxy.">evas_object_image_source_set()</a>. This way, the second object will show whatever content its source has. This time we'll be using a map more manually to simulate a simple reflection of the original image.</p>
<p>We know that the reflection object is placed just like the original, so we take a shortcut by just getting the geometry of our to-be-mapped object. We also need to get the image size of the source. </p><div class="fragment"><div class="line"> </div>
<div class="line">   o = <a class="code" href="group__Evas__Canvas.html#ga4947f6e27a25f31ba3a5dbf84cecf2a8">evas_object_name_find</a>(ad-&gt;canvas, <span class="stringliteral">&quot;obj4&quot;</span>);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Basic.html#ga6e8e78e110392480dd612df86a16b630">evas_object_geometry_get</a>(o, &amp;x, &amp;y, &amp;w, &amp;h);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Image.html#ga29401fb02f1d51ddf09d195f10a004e7">evas_object_image_size_get</a>(o, &amp;img_w, &amp;img_h);</div>
</div><!-- fragment --><p> For this we'll create a map shaped so that it begins at the base of our image and it expands horizontally as it grows (downwards) in height. </p><div class="fragment"><div class="line"> </div>
<div class="line">   m = <a class="code" href="group__Evas__Object__Group__Map.html#gaac896c35c20ac4e41c9cab08256df880">evas_map_new</a>(4);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga82d2bac6f3accd23c869f704696d0d53">evas_map_point_coord_set</a>(m, 0, x, y + h, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga82d2bac6f3accd23c869f704696d0d53">evas_map_point_coord_set</a>(m, 1, x + w, y + h, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga82d2bac6f3accd23c869f704696d0d53">evas_map_point_coord_set</a>(m, 2, win_w - 10, win_h - 30, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga82d2bac6f3accd23c869f704696d0d53">evas_map_point_coord_set</a>(m, 3, (win_w / 2) + 10, win_h - 30, 0);</div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga82d2bac6f3accd23c869f704696d0d53"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga82d2bac6f3accd23c869f704696d0d53">evas_map_point_coord_set</a></div><div class="ttdeci">EVAS_API void evas_map_point_coord_set(Evas_Map *m, int idx, Evas_Coord x, Evas_Coord y, Evas_Coord z)</div><div class="ttdoc">Change the map point's coordinate.</div><div class="ttdef"><b>Definition:</b> evas_map.c:766</div></div>
</div><!-- fragment --><p> Since the reflection should show the image inverted, we need to map it this way. The first point of the map (top-left) will be mapped to the mapped to the first pixel of the last row. There's no horizontal reflection and we want the full width of the image, but as we map its upper side ww will only take two thirds of the image. </p><div class="fragment"><div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 0, 0, img_h);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 1, img_w, img_h);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 2, img_w, 2 * (img_h / 3));</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#gac20df50c88ca79bc8ffaefb6a2265dd6">evas_map_point_image_uv_set</a>(m, 3, 0, 2 * (img_h / 3));</div>
</div><!-- fragment --><p> Finally, to fade out our reflection we set the colors for each point in the map. The two at the top need to be visible, but we'll tone them down a bit and make them a bit translucent. The other two will go straight to full transparency. Evas interpolates the colors from one point to the next, so this will make them fade out. </p><div class="fragment"><div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga02bf5546d997dafe611cb62eccec6f74">evas_map_point_color_set</a>(m, 0, 200, 200, 200, 150);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga02bf5546d997dafe611cb62eccec6f74">evas_map_point_color_set</a>(m, 1, 200, 200, 200, 150);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga02bf5546d997dafe611cb62eccec6f74">evas_map_point_color_set</a>(m, 2, 0, 0, 0, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga02bf5546d997dafe611cb62eccec6f74">evas_map_point_color_set</a>(m, 3, 0, 0, 0, 0);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#gadbb970a1e0da91183bab3af1eb276953">evas_object_map_set</a>(o, m);</div>
<div class="line">   <a class="code" href="group__Evas__Object__Group.html#gafca4ed9f6cb6063ff7e8d9193418129e">evas_object_map_enable_set</a>(o, <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>);</div>
<div class="ttc" id="agroup__Evas__Object__Group__Map_html_ga02bf5546d997dafe611cb62eccec6f74"><div class="ttname"><a href="group__Evas__Object__Group__Map.html#ga02bf5546d997dafe611cb62eccec6f74">evas_map_point_color_set</a></div><div class="ttdeci">EVAS_API void evas_map_point_color_set(Evas_Map *m, int idx, int r, int g, int b, int a)</div><div class="ttdoc">Set the color of a vertex in the map.</div><div class="ttdef"><b>Definition:</b> evas_map.c:822</div></div>
</div><!-- fragment --><p> Close up by freeing the map and do some other things needed to keep stuff moving in our animations and we are done. </p><div class="fragment"><div class="line"> </div>
<div class="line">   <a class="code" href="group__Evas__Object__Group__Map.html#ga219c74ba8e2a4ae4525d2f331b8b5e0a">evas_map_free</a>(m);</div>
<div class="line"> </div>
<div class="line">   ad-&gt;frame = (ad-&gt;frame + 1) % 60;</div>
<div class="line"> </div>
<div class="line">   <span class="keywordflow">return</span> <a class="code" href="group__Eina__Types__Group.html#ga05c12dacc8b4058994df842b41be85fc">EINA_TRUE</a>;</div>
<div class="line">}</div>
</div><!-- fragment --><p> The rest of the program is setup and listening to key events. Nothing that matters within the scope of this example, so we are going to skip it. Refer to it <a class="el" href="evas-map-utils_8c-example.html">here</a> however to see how everything fits together. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="footer">
  <p>
    <span class="version">EFL 1.26.99</span>
    <span class="copyright">Copyright &copy;2000-2022 <a href="http://www.enlightenment.org">enlightenment.org</a></span>
    <span class="generated">Generated @ Sat Oct 29 2022 18:10:38</span>
  </p>
</div>
</body>
</html>
